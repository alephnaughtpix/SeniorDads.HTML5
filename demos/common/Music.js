SeniorDads.CreateNameSpace("SeniorDads.Music");SeniorDads.Music=function(g,p,r){g=new music(g);g.stereo(r);g.Load(p);this.Load=g.Load;this.Play=g.Play;this.Stop=g.Stop;this.loaded=g.loaded;this.stereo=g.stereo};var CODEF_AUDIO_CONTEXT=null,CODEF_AUDIO_NODE=null;
// The following code is by Antoine Santo, and is a modified version of his code for the CODEF project. ( http://codef.santo.fr )
function music(g){var p=!1,r;window.AudioContext=window.AudioContext||window.webkitAudioContext||window.mozAudioContext||window.oAudioContext||window.msAudioContext;if("undefined"!=typeof AudioContext)switch(g){case "YM":CODEF_AUDIO_CONTEXT=new AudioContext;CODEF_AUDIO_NODE=CODEF_AUDIO_CONTEXT.createScriptProcessor(8192);this.loader={};this.loader.player=new YmProcessor;this.stereo_value=!1;break;default:this.stereo_value=!1}"YM"==g?this.LoadAndRun=function(g){var p=this;if("undefined"!=typeof AudioContext){var r=
new XMLHttpRequest;r.open("GET",g);r.overrideMimeType("text/plain; charset=x-user-defined");r.onreadystatechange=function(){if(4==this.readyState&&200==this.status){for(var g=this.responseText||"",r=[],u=g.length,w=String.fromCharCode,G=0;G<u;G++)r[G]=w(g.charCodeAt(G)&255);g=new dataType;g.data=r.join("");YmConst_PLAYER_FREQ=CODEF_AUDIO_CONTEXT.sampleRate;p.loader.player.stereo=p.stereo_value;p.loader.player.load(g)}};r.send()}}:(this.LoadAndRun=function(g){var p=this;this.loader=window.neoart.FileLoader;
if("undefined"!=typeof AudioContext){var r=new XMLHttpRequest;r.open("GET",g);r.overrideMimeType("text/plain; charset=x-user-defined");r.responseType="arraybuffer";r.onreadystatechange=function(){4==this.readyState&&200==this.status&&(p.loader.player=null,p.loader.load(this.response),p.loader.player.reset(),p.loader.player.stereo=p.stereo_value,p.loader.player.play())};r.send()}},this.Load=function(g){var x=this;this.loader=window.neoart.FileLoader;if("undefined"!=typeof AudioContext){var w=new XMLHttpRequest;
w.open("GET",g);w.overrideMimeType("text/plain; charset=x-user-defined");w.responseType="arraybuffer";w.onreadystatechange=function(){4==this.readyState&&200==this.status&&(x.loader.player=null,x.loader.load(this.response),x.loader.player.reset(),x.loader.player.stereo=x.stereo_value,r=x.loader.player,p=!0)};w.send()}},this.Play=function(){null!=r&&r.play()},this.Stop=function(){null!=r&&r.stop()},this.loaded=function(){return p});this.stereo=function(g){this.stereo_value=g};return this}
var YmConst_BUFFER_SIZE=8192,YmConst_PLAYER_FREQ=48E3,YmConst_DRUM_PREC=15,YmConst_AMSTRAD_FREQ=1E6,YmConst_ATARI_FREQ=2E6,YmConst_SPECTRUM_FREQ=1773400,YmConst_INTERLEAVED=1,YmConst_DRUM_SIGNED=2,YmConst_DRUM_4BITS=4,YmConst_TIME_CONTROL=8,YmConst_LOOP_MODE=16,YmConst_MFP_PREDIV=[0,4,10,16,50,64,100,200],YmConst_MONO=[6.3071586250394E-4,0.00163782667521185,0.00269580167037975,0.00383515935748365,0.00590024516535946,0.00787377544480728,0.01174962614825892,0.01602221747489853,0.02299061047191789,0.03141371908729311,
0.04648986276843572,0.06340728985463016,0.09491256447035126,0.13414919481999166,0.21586759036022013,0.3333333333333333],YmConst_STEREO=[9.4607379375591E-4,0.00245674001281777,0.00404370250556963,0.00575273903622547,0.00885036774803918,0.01181066316721091,0.01762443922238838,0.02403332621234779,0.03448591570787683,0.04712057863093966,0.06973479415265357,0.09511093478194525,0.1423688467055269,0.20122379222998749,0.3238013855403302,0.5],YmConst_ENVELOPES=[15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,
5,6,7,8,9,10,11,12,13,14,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,
0,0,0,0,0,0,0,0,0,0,0,0,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0,15,
15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,15,0,1,2,3,4,5,6,7,8,9,10,11,
12,13,14,15,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0,15,14,13,12,11,10,9,8,7,6,5,4,3,2,1,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];
function YmSong(g){this.title;this.author;this.comment;this.attribs;this.clock;this.digidrums;this.drums;this.frames=[];this.frameSize;this.length;this.rate;this.restart;this.supported=!0;this.data=new dataType;this.data.data=g;this.init=function(){this.decode();this.attribs&YmConst_INTERLEAVED&&this.deinterleave();for(i=0;i<this.length;++i)this.frames[i]=this.data.readBytes(0,this.frameSize)};this.decode=function(){var g;g=this.data.readMultiByte(4,"txt");switch(g){case "YM2!":case "YM3!":case "YM3b":this.frameSize=
14;this.length=(this.data.data.length-4)/this.frameSize;this.clock=YmConst_ATARI_FREQ;this.rate=50;this.restart="YM3b"!=g?0:this.data.readByte();this.attribs=YmConst_INTERLEAVED|YmConst_TIME_CONTROL;break;case "YM4!":this.supported=!1;break;case "YM5!":case "YM6!":g=this.data.readMultiByte(8,"txt");if("LeOnArD!"!=g){this.supported=!1;break}this.length=this.data.readInt();this.attribs=this.data.readInt();this.drums=this.data.readShort();this.clock=this.data.readInt();this.rate=this.data.readShort();
this.restart=this.data.readInt();this.data.readShort();if(this.drums){this.digidrums=[];for(g=0;g<this.drums;++g)this.digidrum=new Digidrum(this.data.readInt()),0!=this.digidrum.size&&(this.digidrum.wave.data=this.data.readBytes(0,this.digidrum.size),this.digidrum.convert(this.attribs),this.digidrums[g]=this.digidrum);this.attribs&=~YmConst_DRUM_4BITS}this.title=this.data.readString();this.author=this.data.readString();this.comment=this.data.readString();this.frameSize=16;this.attribs=YmConst_INTERLEAVED|
YmConst_TIME_CONTROL;break;case "MIX1":supported=!1;break;case "YMT1":case "YMT2":supported=!1;break;default:supported=!1}};this.deinterleave=function(){var g,r,u=0,x=[],w=[];for(g=0;g<this.frameSize;++g)x[g]=this.data.pos+this.length*g;for(g=0;g<this.length;++g){for(r=0;r<this.frameSize;++r)w[r+u]=this.data.data[g+x[r]];u+=this.frameSize}this.data.data="";this.data.data=w;this.data.pos=0;this.attribs&=~YmConst_INTERLEAVED};this.init()}
function YmProcessor(){this.counter;this.sound;this.soundChannel;this.soundChannelPos;this.song;this.loop=1;this.stereo=0;this.audioFreq;this.clock;this.registers=[];this.volumeEnv;this.buffer;this.bufferSize;this.voiceA=new YmChannel(this);this.voiceB=new YmChannel(this);this.voiceC=new YmChannel(this);this.samplesTick;this.samplesLeft;this.frame;this.envData;this.envPhase;this.envPos;this.envShape;this.envStep;this.noiseOutput;this.noisePos;this.noiseStep;this.rng;this.syncBuzzer;this.syncBuzzerPhase;
this.syncBuzzerStep;__self=this;this.init=function(){var g;this.bufferSize=YmConst_BUFFER_SIZE;this.buffer=[];for(g=0;g<this.bufferSize;++g)this.buffer[g]=new Sample;this.envData=YmConst_ENVELOPES};this.load=function(g){var p=new LHa;this.song=new YmSong(p.unpack(g));this.audioFreq=YmConst_PLAYER_FREQ;this.clock=this.song.clock;this.samplesTick=this.audioFreq/this.song.rate;CODEF_AUDIO_NODE.onaudioprocess=function(g){__self.mixer(g)};return this.song.supported};this.mixer=function(g){for(var p=0,
r=0,u=0,x=0,w=0,v=0,w=0;u<this.bufferSize;){if(0==this.samplesLeft){if(this.frame>=this.song.length)if(this.loop)this.frame=this.song.restart;else{this.stop();return}this.syncBuzzerStop();for(r=0;r<this.song.frameSize;r++)this.registers[r]=this.song.frames[this.frame][r].charCodeAt(0);this.frame++;this.updateEffects(1,6,14);this.updateEffects(3,8,15);this.writeRegisters();this.samplesLeft=this.samplesTick}v=this.samplesLeft;u+v>this.bufferSize&&(v=this.bufferSize-u);w=x+v;for(r=x;r<w;++r)x=this.buffer[r],
this.noisePos&65536&&(p=this.rng&1^this.rng>>2&1,this.rng=this.rng>>1|p<<16,this.noiseOutput^=p?0:65535,this.noisePos&=65535),this.volumeEnv=this.envData[Math.floor((this.envShape<<6)+(this.envPhase<<5)+(this.envPos>>26))],this.voiceA.computeVolume(),this.voiceB.computeVolume(),this.voiceC.computeVolume(),p=this.voiceA.enabled()&(this.noiseOutput|this.voiceA.mixNoise),this.voiceA.getvolume(),x.voiceA=p?this.voiceA.getvolume():-1,p=this.voiceB.enabled()&(this.noiseOutput|this.voiceB.mixNoise),x.voiceB=
p?this.voiceB.getvolume():-1,p=this.voiceC.enabled()&(this.noiseOutput|this.voiceC.mixNoise),x.voiceC=p?this.voiceC.getvolume():-1,this.voiceA.next(),this.voiceB.next(),this.voiceC.next(),this.noisePos+=this.noiseStep,this.envPos+=this.envStep,2147483647<this.envPos&&(this.envPos-=2147483647),0==this.envPhase&&this.envPos<this.envStep&&(envPhase=1),this.syncBuzzer&&(this.syncBuzzerPhase+=this.syncBuzzerStep,this.syncBuzzerPhase&1073741824&&(this.envPhase=this.envPos=0,this.syncBuzzerPhase&=1073741823));
u+=v;x=w;this.samplesLeft-=v}u=g.outputBuffer.getChannelData(0);g=g.outputBuffer.getChannelData(1);if(this.stereo)for(r=0;r<this.bufferSize;++r)x=this.buffer[r],u[r]=x.left(),g[r]=x.right();else for(r=0;r<this.bufferSize;++r)w=this.buffer[r].mono(),u[r]=w,g[r]=w};this.writeRegisters=function(){var g;this.registers[0]&=255;this.registers[1]&=15;this.voiceA.computeTone(this.registers[1],this.registers[0]);this.registers[2]&=255;this.registers[3]&=15;this.voiceB.computeTone(this.registers[3],this.registers[2]);
this.registers[4]&=255;this.registers[5]&=15;this.voiceC.computeTone(this.registers[5],this.registers[4]);this.registers[6]&=31;3>this.registers[6]?(this.noisePos=0,this.noiseOutput=65535,this.noiseStep=0):(g=this.clock/((this.registers[6]<<3)*this.audioFreq),this.noiseStep=Math.floor(32768*g));this.registers[7]&=255;this.voiceA.mixTone=this.registers[7]&1?65535:0;this.voiceB.mixTone=this.registers[7]&2?65535:0;this.voiceC.mixTone=this.registers[7]&4?65535:0;this.voiceA.mixNoise=this.registers[7]&
8?65535:0;this.voiceB.mixNoise=this.registers[7]&16?65535:0;this.voiceC.mixNoise=this.registers[7]&32?65535:0;this.registers[8]&=31;this.voiceA.setvolume(this.registers[8]);this.registers[9]&=31;this.voiceB.setvolume(this.registers[9]);this.registers[10]&=31;this.voiceC.setvolume(this.registers[10]);this.registers[11]&=255;this.registers[12]&=255;g=this.registers[12]<<8|this.registers[11];3>g?this.envStep=0:(g=this.clock/((g<<8)*this.audioFreq),this.envStep=Math.floor(1073741824*g));255==this.registers[13]?
this.registers[13]=0:(this.registers[13]&=15,this.envPos=this.envPhase=0,this.envShape=this.registers[13])};this.updateEffects=function(g,p,r){var u=0,x=0,w=0;g=this.registers[g]&240;p=this.registers[p]>>5&7;r=this.registers[r];if(g&48)switch(w=((g&48)>>4)-1,g&192){case 64:u=this.registers[w+8]&31,0<=u&&u<this.song.drums&&(p=YmConst_MFP_PREDIV[p]*r,0<p&&(x=2457600/p,0==w?(this.voiceA.drum=this.song.digidrums[u],this.voiceA.drumStart(x)):1==w?(this.voiceB.drum=this.song.digidrums[u],this.voiceB.drumStart(x)):
2==w&&(this.voiceC.drum=this.song.digidrums[u],this.voiceC.drumStart(x))))}};this.syncBuzzerStart=function(g,p){this.envShape=this.shapeEnv&15;this.syncBuzzerStep=1073741824*this.timerFreq/this.audioFreq;this.syncBuzzerPhase=0;this.syncBuzzer=!0};this.syncBuzzerStop=function(){this.syncBuzzer=!1;this.syncBuzzerStep=this.syncBuzzerPhase=0};this.stop=function(){this.reset();return!0};this.reset=function(){var g;this.voiceA=new YmChannel(this);this.voiceB=new YmChannel(this);this.voiceC=new YmChannel(this);
this.frame=this.samplesLeft=0;this.registers=[];for(g=0;16>g;++g)this.registers[g]=0;this.registers[7]=255;this.writeRegisters();this.volumeEnv=0;this.noiseOutput=65535;this.noiseStep=this.noisePos=0;this.rng=1;this.envStep=this.envShape=this.envPos=this.envPhase=0;this.syncBuzzerStop()};this.init();this.reset();CODEF_AUDIO_NODE.connect(CODEF_AUDIO_CONTEXT.destination)}
function Sample(){this.voiceC=this.voiceB=this.voiceA=-1;this.mono=function(){var g=YmConst_MONO,p=0;-1<this.voiceA&&(p+=g[this.voiceA]);-1<this.voiceB&&(p+=g[this.voiceB]);-1<this.voiceC&&(p+=g[this.voiceC]);return p};this.left=function(){var g=YmConst_STEREO,p=0;-1<this.voiceA&&(p+=g[this.voiceA]);-1<this.voiceB&&(p+=g[this.voiceB]);return p};this.right=function(){var g=YmConst_STEREO,p=0;-1<this.voiceB&&(p+=g[this.voiceB]);-1<this.voiceC&&(p+=g[this.voiceC]);return p}}
function YmChannel(g){this.drumStep=this.drumPos=this.drum=this.digidrum=this.step=this.position=this.mode=this.mixTone=this.mixNoise=0;this.processor=g;this.vol=0;this.enabled=function(){return this.position>>30|this.mixTone};this.getvolume=function(){return this.mode?this.processor.volumeEnv:this.vol};this.setvolume=function(g){this.mode=g&16?!0:!1;this.vol=g};this.next=function(){this.position+=this.step;2147483647<this.position&&(this.position-=2147483647)};this.computeTone=function(g,r){var u=
g<<8|r;5>u?(this.position=1073741824,this.step=0):(u=this.processor.clock/((u<<3)*this.processor.audioFreq),this.step=Math.floor(1073741824*u))};this.computeVolume=function(){var g;this.digidrum&&(g=this.drumPos>>YmConst_DRUM_PREC,this.vol=this.drum.data[g]/16,this.mixTone=this.mixNoise=65535,this.drumPos+=this.drumStep,g=this.drumPos>>YmConst_DRUM_PREC,g>=this.drum.size&&(this.digidrum=!1))};this.drumStart=function(g){this.digidrum=!0;this.drumPos=0;this.drumStep=(this.drumFreq<<15)/this.processor.audioFreq};
this.drumStop=function(){this.digidrum=!1}}function Digidrum(g){this.data;this.repeatLen;this.size;this.wave=null;this.size=g;this.wave=new dataType;this.convert=function(g){var r;this.data=[];if(g&YmConst_DRUM_4BITS)for(r=0;r<this.size;++r)g=(this.wave.readByte()&15)>>7,this.data[r]=YmConst_MONO[g];else for(r=0;r<this.size;++r)this.data[r]=this.wave.readByte();this.wave=null}}
function dataType(){this.data;this.pos=0;this.endian="BIG";this.readBytes=function(g,p){for(var r="",u=0;u<p;u++)r+=this.data[g+this.pos++];return r};this.readMultiByte=function(g,p){if("txt"==p){for(var r="",u=0;u<g;u++)r+=this.data[this.pos++];return r}};this.readInt=function(){var g=parseInt(this.data[this.pos+0].charCodeAt(0).toString(16),16),p=parseInt(this.data[this.pos+1].charCodeAt(0).toString(16),16),r=parseInt(this.data[this.pos+2].charCodeAt(0).toString(16),16),u=parseInt(this.data[this.pos+
3].charCodeAt(0).toString(16),16),g="BIG"==this.endian?g<<24|p<<16|r<<8|u:u<<24|r<<16|p<<8|g;this.pos+=4;return g};this.readShort=function(){var g=parseInt(this.data[this.pos+0].charCodeAt(0).toString(16),16),p=parseInt(this.data[this.pos+1].charCodeAt(0).toString(16),16);this.pos+=2;return g<<8|p};this.readByte=function(){var g=parseInt(this.data[this.pos].charCodeAt(0).toString(16),16);this.pos+=1;return g};this.readString=function(){for(var g="";;)if(0!=this.data[this.pos++].charCodeAt(0))g+=this.data[this.pos-
1];else return g};this.substr=function(g,p){return this.data.substr(g,p)};this.bytesAvailable=function(){return this.length-this.pos}}
function LHa(){this.data;this.source;this.buffer;this.output;this.srcSize;this.dstSize;this.srcPos;this.dstPos;this.c_Table;this.p_Table;this.c_Len;this.p_Len;this.l_Tree;this.r_Tree;this.bitBuffer;this.bitCount;this.subBuffer;this.blockSize;this.fillBufferSize;this.fillIndex;this.decodei;this.decodej;this.data="";this.buffer=[];this.output=[];this.c_Table=[];this.p_Table=[];this.c_Len=[];this.p_Len=[];this.l_Tree=[];this.r_Tree=[];this.unpack=function(g){this.header=new LHaHeader(g);if(0==this.header.size||
"-lh5-"!=this.header.method||0!=this.header.level)return g.data;this.source=g;this.srcSize=this.header.packed;this.srcPos=this.source.pos;this.dstSize=this.header.original;this.subBuffer=this.bitCount=this.bitBuffer=this.fillBufferSize=0;this.fillBuffer(16);this.decodej=this.blockSize=0;g=this.dstSize;for(var p,r;0!=g;){p=8192<g?8192:g;this.decode(p);r=p>this.dstSize?this.dstSize:p;if(0<r){for(var u=this.output.pos=0;u<r;u++)this.data+=String.fromCharCode(this.output[u]);this.dstPos+=r;this.dstSize-=
r}g-=p}this.buffer="";this.output=[];return this.data};this.decode=function(g){for(var p,r=0;0<=--this.decodej;)if(this.output[r]=this.output[this.decodei],this.decodei=++this.decodei&8191,++r==g)return;for(;;)if(p=this.decode_c(),255>=p){if(this.output[r]=p,++r==g)break}else for(this.decodej=p-253,this.decodei=r-this.decode_p()-1&8191;0<=--this.decodej;)if(this.output[r]=this.output[this.decodei],this.decodei=++this.decodei&8191,++r==g)return};this.decode_c=function(){var g,p=0;0==this.blockSize&&
(this.blockSize=this.getBits(16),this.read_p(19,5,3),this.read_c(),this.read_p(14,4,-1));this.blockSize--;g=this.c_Table[this.bitBuffer>>4];if(510<=g){p=8;do g=this.bitBuffer&p?this.r_Tree[g]:this.l_Tree[g],p>>=1;while(510<=g)}this.fillBuffer(this.c_Len[g]);return g&65535};this.decode_p=function(){var g=this.p_Table[this.bitBuffer>>8],p=0;if(14<=g){p=128;do g=this.bitBuffer&p?this.r_Tree[g]:this.l_Tree[g],p>>=1;while(14<=g)}this.fillBuffer(this.p_Len[g]);0!=g&&(g=(1<<g-1)+this.getBits(g-1));return g&
65535};this.read_c=function(){var g,p=0,r=0,u=this.getBits(9);if(0==u){g=this.getBits(9);for(p=0;510>p;++p)this.c_Len[p]=0;for(p=0;4096>p;++p)this.c_Table[p]=g}else{for(;p<u;){g=this.p_Table[this.bitBuffer>>8];if(19<=g){r=128;do g=this.bitBuffer&r?this.r_Tree[g]:this.l_Tree[g],r>>=1;while(19<=g)}this.fillBuffer(this.p_Len[g]);if(2>=g)for(g=0==g?1:1==g?this.getBits(4)+3:this.getBits(9)+20;0<=--g;)this.c_Len[p++]=0;else this.c_Len[p++]=g-2}for(;510>p;)this.c_Len[p++]=0;this.makeTable(510,this.c_Len,
12,this.c_Table)}};this.read_p=function(g,p,r){var u=0,x=0,w=this.getBits(p);if(0==w){p=this.getBits(p);for(u=0;u<g;++u)this.p_Len[u]=0;for(u=0;256>u;++u)this.p_Table[u]=p}else{for(;u<w;){p=this.bitBuffer>>13;if(7==p)for(x=4096;x&this.bitBuffer;)x>>=1,p++;this.fillBuffer(7>p?3:p-3);this.p_Len[u++]=p;if(u==r)for(p=this.getBits(2);0<=--p;)this.p_Len[u++]=0}for(;u<g;)this.p_Len[u++]=0;this.makeTable(g,this.p_Len,8,this.p_Table)}};this.getBits=function(g){var p=this.bitBuffer>>16-g;this.fillBuffer(g);
return p&65535};this.fillBuffer=function(g){var p;for(this.bitBuffer=this.bitBuffer<<g&65535;g>this.bitCount;)this.bitBuffer|=this.subBuffer<<(g-=this.bitCount),this.bitBuffer&=65535,0==this.fillBufferSize&&(this.fillIndex=0,p=4064<this.srcSize?4064:this.srcSize,0<p&&(this.source.pos=this.srcPos,this.buffer=this.source.readBytes(0,p),this.srcPos+=p,this.srcSize-=p),this.fillBufferSize=p),0<this.fillBufferSize?(this.fillBufferSize--,this.subBuffer=this.buffer[this.fillIndex++].charCodeAt(0)):this.subBuffer=
0,this.bitCount=8;this.bitBuffer|=this.subBuffer>>(this.bitCount-=g);this.bitBuffer&=65535};this.makeTable=function(g,p,r,u){var x=g,w,v,C,A,D,G,B,I,K;w=[];var J=[],F=[],E=1<<15-r;for(v=0;v<g;++v)w[v]=0;for(v=0;v<g;++v)w[p[v]]++;F[1]=0;for(v=1;17>v;++v)F[v+1]=F[v]+(w[v]<<16-v)&65535;if(0!=F[17])return!1;C=16-r;for(v=1;v<=r;++v)F[v]>>=C,J[v]=1<<r-v;for(;17>v;)J[v]=1<<16-v++;v=F[r+1]>>C;if(0!=v)for(A=1<<r;v!=A;)u[v++]=0;for(w=0;w<g;++w)if(0!=(D=p[w])){G=F[D]+J[D];if(D<=r)for(v=F[D];v<G;++v)u[v]=w;else{v=
D-r;A=F[D];B=A>>C;for(I=u;0!=v;)0==I[B]&&(this.l_Tree[x]=0,this.r_Tree[x]=0,I[B]=x++),K=A&E?this.r_Tree:this.l_Tree,A<<=1,v--;K[I[B]]=w}F[D]=G}return!0}}
function LHaHeader(g){this.size;this.checksum;this.method;this.packed;this.original;this.timeStamp;this.attribute;this.level;this.nameLength;this.name;g.endian="LITTLE";g.pos=0;this.size=g.readByte();this.checksum=g.readByte();this.method=g.readMultiByte(5,"txt");this.packed=g.readInt();this.original=g.readInt();this.timeStamp=g.readInt();this.attribute=g.readByte();this.level=g.readByte();this.nameLength=g.readByte();this.name=g.readMultiByte(this.nameLength,"txt");g.readShort()}
(function(){function g(g,t){var d=Object.create(null,{endian:{value:1,writable:!0},length:{value:0,writable:!0},index:{value:0,writable:!0},buffer:{value:null,writable:!0},view:{value:null,writable:!0},bytesAvailable:{get:function(){return this.length-this.index}},position:{get:function(){return this.index},set:function(a){0>a?a=0:a>this.length&&(a=this.length);this.index=a}},clear:{value:function(){this.buffer=new ArrayBuffer;this.view=null;this.index=this.length=0}},readAt:{value:function(a){return this.view.getUint8(a)}},
readByte:{value:function(){return this.view.getInt8(this.index++)}},readShort:{value:function(){var a=this.view.getInt16(this.index,this.endian);this.index+=2;return a}},readInt:{value:function(){var a=this.view.getInt32(this.index,this.endian);this.index+=4;return a}},readUbyte:{value:function(){return this.view.getUint8(this.index++)}},readUshort:{value:function(){var a=this.view.getUint16(this.index,this.endian);this.index+=2;return a}},readUint:{value:function(){var a=this.view.getUint32(this.index,
this.endian);this.index+=4;return a}},readBytes:{value:function(a,l,m){a=a.view;var c=this.index,e=this.view;(m+=c)>this.length&&(m=this.length);for(;c<m;++c)a.setUint8(l++,e.getUint8(c));this.index=c}},readString:{value:function(a){var l=this.index,m=this.view,c="";(a+=l)>this.length&&(a=this.length);for(;l<a;++l)c+=String.fromCharCode(m.getUint8(l));this.index=a;return c}},writeAt:{value:function(a,l){this.view.setUint8(a,l)}},writeByte:{value:function(a){this.view.setInt8(this.index++,a)}},writeShort:{value:function(a){this.view.setInt16(this.index,
a);this.index+=2}},writeInt:{value:function(a){this.view.setInt32(this.index,a);this.index+=4}}});d.buffer=g;d.view=new DataView(g);d.length=g.byteLength;return Object.seal(d)}function p(){return Object.create(null,{l:{value:0,writable:!0},r:{value:0,writable:!0},next:{value:null,writable:!0}})}function r(){return Object.create(null,{player:{value:null,writable:!0},channels:{value:[],writable:!0},buffer:{value:[],writable:!0},samplesTick:{value:0,writable:!0},samplesLeft:{value:0,writable:!0},remains:{value:0,
writable:!0},completed:{value:0,writable:!0},bufferSize:{get:function(){return this.buffer.length},set:function(g){var t;t=this.buffer.length||0;if(!(g==t||512>g)&&(this.buffer.length=g,g>t))for(this.buffer[t]=p(),t=++t;t<g;++t)this.buffer[t]=this.buffer[t-1].next=p()}},complete:{get:function(){return this.completed},set:function(g){this.completed=g^this.player.loopSong}},reset:{value:function(){var g=this.channels[0],t=this.buffer[0];for(this.completed=this.remains=this.samplesLeft=0;g;)g.initialize(),
g=g.next;for(;t;)t.l=t.r=0,t=t.next}},restore:{configurable:!0,value:function(){}}})}function u(){var E=Object.create(null,{context:{value:null,writable:!0},node:{value:null,writable:!0},analyse:{value:0,writable:!0},endian:{value:0,writable:!0},sampleRate:{value:0,writable:!0},playSong:{value:0,writable:!0},lastSong:{value:0,writable:!0},version:{value:0,writable:!0},title:{value:"",writable:!0},channels:{value:0,writable:!0},loopSong:{value:1,writable:!0},speed:{value:0,writable:!0},tempo:{value:0,
writable:!0},mixer:{value:null,writable:!0},tick:{value:0,writable:!0},paused:{value:0,writable:!0},callback:{value:null,writable:!0},quality:{configurable:!0,set:function(g){this.callback=g?this.mixer.accurate.bind(this.mixer):this.mixer.fast.bind(this.mixer)}},toggle:{value:function(g){this.mixer.channels[g].mute^=1}},setup:{configurable:!0,value:function(){}},load:{value:function(t){this.lastSong=this.playSong=this.version=0;this.mixer.restore();t.view||(t=g(t));t.position=0;if(67324752==t.readUint())if(window.neoart.Unzip)t=
x(t),t=t.uncompress(t.entries[0]);else throw"Unzip support is not available.";t.endian=this.endian;t.position=0;this.loader(t);this.version&&this.setup();return this.version}},play:{value:function(){var g;this.version&&(this.paused?this.paused=0:(this.initialize(),this.node=this.context.createScriptProcessor(this.mixer.bufferSize),this.node.onaudioprocess=this.callback),this.analyse&&window.neoart.Flectrum?(g=window.neoart.analyserNode=this.context.createAnalyser(),this.node.connect(g),g.connect(this.context.destination)):
this.node.connect(this.context.destination),g=document.createEvent("Event"),g.initEvent("flodPlay",!0,!1),document.dispatchEvent(g))}},pause:{value:function(){if(this.node){this.node.disconnect();this.paused=1;var g=document.createEvent("Event");g.initEvent("flodPause",!0,!1);document.dispatchEvent(g)}}},stop:{value:function(){if(this.node){this.node.disconnect();this.node.onaudioprocess=this.node=null;this.paused=0;this.restore&&this.restore();var g=document.createEvent("Event");g.initEvent("flodStop",
!0,!1);document.dispatchEvent(g)}}},reset:{value:function(){this.tick=0;this.mixer.initialize();this.mixer.samplesTick=2.5*this.sampleRate/this.tempo>>0}}});window.neoart.audioContext||(window.neoart.audioContext=new AudioContext);E.context=window.neoart.audioContext;E.sampleRate=E.context.sampleRate;return E}function x(E){function t(c){var b=Object.create(null,{count:{value:null,writable:!0},symbol:{value:null,writable:!0}});b.count=new Uint16Array(c);b.symbol=new Uint16Array(c);return Object.seal(b)}
function d(){var a=Object.create(null,{output:{value:null,writable:!0},inpbuf:{value:null,writable:!0},inpcnt:{value:0,writable:!0},outcnt:{value:0,writable:!0},bitbuf:{value:0,writable:!0},bitcnt:{value:0,writable:!0},flencode:{value:null,writable:!0},fdiscode:{value:null,writable:!0},dlencode:{value:null,writable:!0},ddiscode:{value:null,writable:!0},input:{set:function(c){this.inpbuf=c[0];this.inpbuf.endian=c[2];this.inpcnt=this.inpbuf.position=0;this.output=g(new ArrayBuffer(c[1]));this.output.endian=
c[2];this.outcnt=this.output.position=0}},inflate:{value:function(){var c,b;do if(b=this.bits(1),c=this.bits(2),c=0==c?this.stored():1==c?this.codes(this.flencode,this.fdiscode):2==c?this.dynamic():1)throw l;while(!b)}},initialize:{value:function(){var c=new Uint8Array(288),b=0;this.flencode=t(288);for(this.fdiscode=t(30);144>b;++b)c[b]=8;for(;256>b;++b)c[b]=9;for(;280>b;++b)c[b]=7;for(;288>b;++b)c[b]=8;this.construct(this.fdiscode,c,288);for(b=0;30>b;++b)c[b]=5;this.construct(this.fdiscode,c,30);
this.dlencode=t(286);this.ddiscode=t(30)}},construct:{value:function(c,b,e){for(var l=0,f=1,a=new Uint16Array(16),m=0;16>l;++l)c.count[l]=0;for(;m<e;++m)c.count[b[m]]++;if(c.count[0]==e)return 0;for(l=1;16>l;++l)if(f<<=1,f-=c.count[l],0>f)return f;for(l=1;15>l;++l)a[l+1]=a[l]+c.count[l];for(m=0;m<e;++m)0!=b[m]&&(c.symbol[a[b[m]]++]=m);return f}},bits:{value:function(c){for(var b=this.bitbuf,e=this.inpbuf.length;this.bitcnt<c;){if(this.inpcnt==e)throw m;b|=this.inpbuf.readAt(this.inpcnt++)<<this.bitcnt;
this.bitcnt+=8}this.bitbuf=b>>c;this.bitcnt-=c;return b&(1<<c)-1}},codes:{value:function(b,e){var l,f,a;do{a=this.decode(b);if(0>a)return a;if(256>a)this.output.writeAt(this.outcnt++,a);else if(256<a){a-=257;if(29<=a)throw ERRRO7;f=s[a]+this.bits(q[a]);a=this.decode(e);if(0>a)return a;l=y[a]+this.bits(H[a]);if(l>this.outcnt)throw c;for(l=this.outcnt-l;f--;)this.output.writeAt(this.outcnt++,this.output.readAt(l++))}}while(256!=a);return 0}},decode:{value:function(c){for(var b=this.bitbuf,e=0,l,f=0,
a=0,d=this.inpbuf.length,h=this.bitcnt,k=1;;){for(;h--;){e|=b&1;b>>=1;l=c.count[k];if(e<f+l)return this.bitbuf=b,this.bitcnt=this.bitcnt-k&7,c.symbol[a+(e-f)];a+=l;f+=l;f<<=1;e<<=1;++k}h=16-k;if(!h)break;if(this.inpcnt==d)throw m;b=this.inpbuf.readAt(this.inpcnt++);8<h&&(h=8)}return-9}},stored:{value:function(){var c=this.inpbuf.length,b;this.bitbuf=this.bitcnt=0;if(this.inpcnt+4>c)throw m;b=this.inpbuf.readAt(this.inpcnt++);b|=this.inpbuf.readAt(this.inpcnt++)<<8;if(this.inpbuf.readAt(this.inpcnt++)!=
(~b&255)||this.inpbuf.readAt(this.inpcnt++)!=(~b>>8&255))throw e;if(this.inpcnt+b>c)throw m;for(;b--;)this.output.writeAt(this.outcnt++,this.inpbuf.readAt(this.inpcnt++));return 0}},dynamic:{value:function(){var c=new Uint8Array(316),e;e=0;var l,a=this.bits(5)+257,m=this.bits(5)+1;l=this.bits(4)+4;var d=a+m,y;if(286<a||30<m)throw f;for(;e<l;++e)c[M[e]]=this.bits(3);for(;19>e;++e)c[M[e]]=0;if(e=this.construct(this.dlencode,c,19))throw b;for(e=0;e<d;)if(y=this.decode(this.dlencode),16>y)c[e++]=y;else{l=
0;if(16==y){if(0==e)throw k;l=c[e-1];y=3+this.bits(2)}else y=17==y?3+this.bits(3):11+this.bits(7);if(e+y>d)throw h;for(;y--;)c[e++]=l}e=this.construct(this.dlencode,c,a);if(0>e||0<e&&1!=a-this.dlencode.count[0])throw z;e=this.construct(this.ddiscode,c.subarray(a),m);if(0>e||0<e&&1!=m-this.ddiscode.count[0])throw n;return this.codes(this.dlencode,this.ddiscode)}}});a.initialize();return Object.seal(a)}function a(){return Object.create(null,{name:{value:"",writable:!0},extra:{value:null,writable:!0},
version:{value:0,writable:!0},flag:{value:0,writable:!0},method:{value:0,writable:!0},time:{value:0,writable:!0},crc:{value:0,writable:!0},compressed:{value:0,writable:!0},size:{value:0,writable:!0},offset:{value:0,writable:!0},date:{get:function(){return new Date((this.time>>25&127)+1980,(this.time>>21&15)-1,this.time>>16&31,this.time>>11&31,this.time>>5&63,(this.time&31)<<1)}},isDirectory:{get:function(){return"/"==this.name.charAt(this.name.length-1)}}})}if(!E)return null;var l="Invalid block type.",
m="Available inflate data did not terminate.",c="Distance is too far back.",e="Stored block length did not match one's complement.",f="Too many length or distance codes.",b="Code lengths codes incomplete.",k="Repeat lengths with no first length.",h="Repeat more than specified lengths.",z="Invalid literal/length code lengths.",n="Invalid distance code lengths.",s=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258],q=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,
4,5,5,5,5,0],y=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],H=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],M=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],p=Object.create(null,{endian:{value:1,writable:!0},entries:{value:null,writable:!0},stream:{value:null,writable:!0},uncompress:{value:function(c){var b=this.stream,e;e=!1;var l,f,a;if(!c)return null;if("string"==typeof c){a=this.entries.length;for(l=
0;l<a;++l)if(f=this.entries[l],f.name==c){c=f;e=!0;break}if(!e)return null}b.position=c.offset+28;e=b.readUshort();b.position+=c.name.length+e;if(c.compressed)switch(e=g(new ArrayBuffer(c.compressed),this.endian),b.readBytes(e,0,c.compressed),c.method){case 0:return e;case 8:return b=d(),b.input=[e,c.size,this.endian],b.inflate(),b.output;default:throw"Compression method not supported.";}}},parseCentral:{value:function(){var c=this.stream,b,e=g(new ArrayBuffer(46),this.endian),l,f=this.entries.length,
m;for(l=0;l<f;++l){c.readBytes(e,0,46);e.position=0;if(33639248!=e.readUint())throw"Unexpected end of archive.";e.position+=24;m=e.readUshort();if(!m)throw"Unexpected end of archive.";b=a();b.name=c.readString(m);if(m=e.readUshort())b.extra=g(new ArrayBuffer(m),this.endian),c.readBytes(b.extra,0,m);c.position+=e.readUshort();e.position=6;b.version=e.readUshort();b.flag=e.readUshort();if(1==(b.flag&1))throw"Encrypted archive not supported.";b.method=e.readUshort();b.time=e.readUint();b.crc=e.readUint();
b.compressed=e.readUint();b.size=e.readUint();e.position=42;b.offset=e.readUint();Object.freeze(b);this.entries[l]=b}}},parseEnd:{value:function(){var c=this.stream,b=c.length-22,e=b-65536;0>e&&(e=0);do if(80==c.readAt(b)&&(c.position=b,101010256==c.readUint()))break;while(--b>e);if(b==e)throw"The archive is either in unknown format or damaged.";c.position=b+10;this.entries=[];this.entries.length=c.readUshort();c.position=b+16;c.position=c.readUint();this.parseCentral()}}});E.view||(E=g(E));E.endian=
1;E.position=0;p.stream=E;p.parseEnd();return Object.seal(p)}function w(g){var t=Object.create(null,{next:{value:null,writable:!0},mute:{value:0,writable:!0},panning:{value:0,writable:!0},delay:{value:0,writable:!0},pointer:{value:0,writable:!0},length:{value:0,writable:!0},audena:{value:0,writable:!0},audcnt:{value:0,writable:!0},audloc:{value:0,writable:!0},audper:{value:0,writable:!0},audvol:{value:0,writable:!0},timer:{value:0,writable:!0},level:{value:0,writable:!0},ldata:{value:0,writable:!0},
rdata:{value:0,writable:!0},enabled:{get:function(){return this.audena},set:function(d){d!=this.audena&&(this.audena=d,this.audloc=this.pointer,this.audcnt=this.pointer+this.length,this.timer=1,d&&(this.delay+=2))}},period:{set:function(d){0>d?d=0:65535<d&&(d=65535);this.audper=d}},volume:{set:function(d){0>d?d=0:64<d&&(d=64);this.audvol=d}},resetData:{value:function(){this.rdata=this.ldata=0}},initialize:{value:function(){this.audloc=this.audcnt=this.audena=0;this.audper=50;this.length=this.pointer=
this.delay=this.rdata=this.ldata=this.timer=this.audvol=0}}});t.panning=t.level=0==(++g&2)?-1:1;return Object.seal(t)}function v(){return Object.create(null,{active:{value:0,writable:!0},forced:{value:-1,writable:!0},l0:{value:0,writable:!0},l1:{value:0,writable:!0},l2:{value:0,writable:!0},l3:{value:0,writable:!0},l4:{value:0,writable:!0},r0:{value:0,writable:!0},r1:{value:0,writable:!0},r2:{value:0,writable:!0},r3:{value:0,writable:!0},r4:{value:0,writable:!0},initialize:{value:function(){this.r0=
this.r1=this.r2=this.r3=this.r4=this.l0=this.l1=this.l2=this.l3=this.l4=0}},process:{value:function(g,t){var d=0.5139651662784244;0==g&&(this.l0=0.4860348337215757*t.l+d*this.l0,this.r0=0.4860348337215757*t.r+d*this.r0,d=0.06850445132502514,t.l=this.l1=0.9314955486749749*this.l0+d*this.l1,t.r=this.r1=0.9314955486749749*this.r0+d*this.r1);0<(this.active|this.forced)&&(d=0.47866541564678,this.l2=0.52133458435322*t.l+d*this.l2,this.r2=0.52133458435322*t.r+d*this.r2,this.l3=0.52133458435322*this.l2+d*
this.l3,this.r3=0.52133458435322*this.r2+d*this.r3,t.l=this.l4=0.52133458435322*this.l3+d*this.l4,t.r=this.r4=0.52133458435322*this.r3+d*this.r4);1<t.l?t.l=1:-1>t.l&&(t.l=-1);1<t.r?t.r=1:-1>t.r&&(t.r=-1)}}})}function C(){return Object.create(null,{note:{value:0,writable:!0},sample:{value:0,writable:!0},effect:{value:0,writable:!0},param:{value:0,writable:!0}})}function A(){return Object.create(null,{name:{value:"",writable:!0},length:{value:0,writable:!0},loop:{value:0,writable:!0},repeat:{value:0,
writable:!0},volume:{value:0,writable:!0},pointer:{value:0,writable:!0},loopPtr:{value:0,writable:!0}})}function D(){return Object.create(null,{pattern:{value:0,writable:!0},transpose:{value:0,writable:!0}})}function G(){var g=r();Object.defineProperties(g,{filter:{value:null,writable:!0},model:{value:1,writable:!0},memory:{value:[],writable:!0},loopPtr:{value:0,writable:!0},loopLen:{value:4,writable:!0},clock:{value:0,writable:!0},master:{value:0,writable:!0},ready:{value:0,writable:!0},volume:{set:function(g){0<
g?(64<g&&(g=64),this.master=g/64*0.00390625):this.master=0}},initialize:{value:function(){var g=this.memory.length,d=g+this.loopLen;this.reset();this.filter.initialize();if(!this.ready)for(this.ready=1,this.loopPtr=g;g<d;++g)this.memory[g]=0}},restore:{value:function(){this.ready=0;this.memory.length=0}},store:{value:function(g,d,a){var l,m,c=g.position,e=this.memory.length;a&&(g.position=a);m=g.position+d;m>=g.length&&(l=m-g.length,d=g.length-g.position);m=e;for(d+=e;m<d;++m)this.memory[m]=g.readByte();
for(d+=l;m<d;++m)this.memory[m]=0;a&&(g.position=c);return e}},fast:{value:function(g){var d,a,l=this.memory,m,c=0,e,f=0,b,k,h=this.bufferSize,z,n,s;if(this.completed){if(!this.remains){this.player.stop();return}h=this.remains}for(;c<h;){this.samplesLeft||(this.player.process(),this.samplesLeft=this.samplesTick,this.completed&&(h=c+this.samplesTick,h>this.bufferSize&&(this.remains=h-this.bufferSize,h=this.bufferSize)));n=this.samplesLeft;c+n>=h&&(n=h-c);e=f+n;for(d=this.channels[0];d;){k=this.buffer[f];
if(d.audena&&60<d.audper)for(z=d.audper/this.clock,s=d.audvol*this.master,m=s*(1-d.level),b=s*(1+d.level),a=f;a<e;++a)d.delay?d.delay--:1>--d.timer&&(d.mute||(s=0.0078125*l[d.audloc],d.ldata=s*m,d.rdata=s*b),d.audloc++,d.timer+=z,d.audloc>=d.audcnt&&(d.audloc=d.pointer,d.audcnt=d.pointer+d.length)),k.l+=d.ldata,k.r+=d.rdata,k=k.next;else for(a=f;a<e;++a)k.l+=d.ldata,k.r+=d.rdata,k=k.next;d=d.next}f=e;c+=n;this.samplesLeft-=n}s=this.model;l=this.filter;k=this.buffer[0];d=g.outputBuffer.getChannelData(0);
g=g.outputBuffer.getChannelData(1);for(a=0;a<h;++a)l.process(s,k),d[a]=k.l,g[a]=k.r,k.l=k.r=0,k=k.next}}});g.channels[0]=w(0);g.channels[0].next=g.channels[1]=w(1);g.channels[1].next=g.channels[2]=w(2);g.channels[2].next=g.channels[3]=w(3);g.bufferSize=8192;g.filter=v();g.master=0.00390625;return Object.seal(g)}function B(g){var t=u();Object.defineProperties(t,{quality:{set:function(d){this.callback=this.mixer.fast.bind(this.mixer)}},stereo:{set:function(d){var a=this.mixer.channels[0];for(0>d?d=
0:1<d&&(d=1);a;)a.level=d*a.panning,a=a.next}},volume:{set:function(d){0>d?d=0:1<d&&(d=1);this.mixer.master=0.00390625*d}},frequency:{value:function(d){d?(this.mixer.clock=3579545/this.sampleRate,this.mixer.samplesTick=735):(this.mixer.clock=3546895/this.sampleRate,this.mixer.samplesTick=882)}}});t.mixer=g||G();t.mixer.player=t;t.frequency(0);t.channels=4;t.endian=0;t.quality=0;t.speed=6;t.tempo=125;return t}function I(){return Object.create(null,{next:{value:null,writable:!0},mute:{value:0,writable:!0},
enabled:{value:0,writable:!0},sample:{value:null,writable:!0},length:{value:0,writable:!0},index:{value:0,writable:!0},pointer:{value:0,writable:!0},delta:{value:0,writable:!0},fraction:{value:0,writable:!0},speed:{value:0,writable:!0},dir:{value:0,writable:!0},oldSample:{value:null,writable:!0},oldLength:{value:0,writable:!0},oldPointer:{value:0,writable:!0},oldFraction:{value:0,writable:!0},oldSpeed:{value:0,writable:!0},oldDir:{value:0,writable:!0},volume:{value:0,writable:!0},lvol:{value:0,writable:!0},
rvol:{value:0,writable:!0},panning:{value:128,writable:!0},lpan:{value:0.5,writable:!0},rpan:{value:0.5,writable:!0},ldata:{value:0,writable:!0},rdata:{value:0,writable:!0},mixCounter:{value:0,writable:!0},lmixRampU:{value:0,writable:!0},lmixDeltaU:{value:0,writable:!0},rmixRampU:{value:0,writable:!0},rmixDeltaU:{value:0,writable:!0},lmixRampD:{value:0,writable:!0},lmixDeltaD:{value:0,writable:!0},rmixRampD:{value:0,writable:!0},rmixDeltaD:{value:0,writable:!0},volCounter:{value:0,writable:!0},lvolDelta:{value:0,
writable:!0},rvolDelta:{value:0,writable:!0},panCounter:{value:0,writable:!0},lpanDelta:{value:0,writable:!0},rpanDelta:{value:0,writable:!0},initialize:{value:function(){this.enabled=0;this.sample=null;this.dir=this.speed=this.fraction=this.delta=this.pointer=this.index=this.length=0;this.oldSample=null;this.rvol=this.lvol=this.volume=this.oldDir=this.oldSpeed=this.oldFraction=this.oldPointer=this.oldLength=0;this.panning=128;this.rpan=this.lpan=0.5;this.rpanDelta=this.lpanDelta=this.panCounter=
this.rvolDelta=this.lvolDelta=this.volCounter=this.rmixDeltaD=this.rmixRampD=this.lmixDeltaD=this.lmixRampD=this.rmixDeltaU=this.rmixRampU=this.lmixDeltaU=this.lmixRampU=this.mixCounter=this.rdata=this.ldata=0}}})}function K(){return Object.create(null,{name:{value:"",writable:!0},bits:{value:8,writable:!0},volume:{value:0,writable:!0},length:{value:0,writable:!0},data:{value:[],writable:!0},loopMode:{value:0,writable:!0},loopStart:{value:0,writable:!0},loopLen:{value:0,writable:!0},store:{value:function(g){var t=
0,d,a=this.length,l;this.loopLen||(this.loopMode=0);l=g.position;this.loopMode?(a=this.loopStart+this.loopLen,this.data=new Float32Array(a+1)):this.data=new Float32Array(this.length+1);if(8==this.bits)for(l+a>g.length&&(a=g.length-l),d=0;d<a;d++)t=g.readByte()+t,-128>t?t+=256:127<t&&(t-=256),this.data[d]=0.0078125*t;else for(l+(a<<1)>g.length&&(a=g.length-l>>1),d=0;d<a;d++)t=g.readShort()+t,-32768>t?t+=65536:32767<t&&(t-=65536),this.data[d]=3.051758E-5*t;t=l+length;this.loopMode?(this.length=this.loopStart+
this.loopLen,this.data[a]=1==this.loopMode?this.data[this.loopStart]:this.data[a-1]):this.data[this.length]=0;if(a!=this.length)for(l=this.data[a-1],d=a;d<this.length;d++)this.data[d]=l;g.position=t<g.length?t:g.length-1}}})}function J(){var g=r();Object.defineProperties(g,{setup:{value:function(g){var d=1;this.channels.length=g;for(this.channels[0]=I();d<g;++d)this.channels[d]=this.channels[d-1].next=I()}},initialize:{value:function(){this.reset()}},fast:{value:function(g){var d,a,l,m=0,c,e=0,f,
b,k=this.bufferSize,h,z;if(this.completed){if(!this.remains){this.player.stop();return}k=this.remains}for(;m<k;){this.samplesLeft||(this.player.process(),this.player.fast(),this.samplesLeft=this.samplesTick,this.completed&&(k=m+this.samplesTick,k>this.bufferSize&&(this.remains=k-this.bufferSize,k=this.bufferSize)));h=this.samplesLeft;m+h>=k&&(h=k-m);c=e+h;for(d=this.channels[0];d;){if(d.enabled)for(f=d.sample,a=f.data,b=this.buffer[e],l=e;l<c;++l){if(d.index!=d.pointer){if(d.index>=d.length)if(f.loopMode)d.pointer=
f.loopStart+(d.index-d.length),d.length=f.length,2==f.loopMode&&(d.dir=d.dir?0:f.length+f.loopStart-1);else{d.enabled=0;break}else d.pointer=d.index;d.mute?(d.ldata=0,d.rdata=0):(z=d.dir?a[d.dir-d.pointer]:a[d.pointer],d.ldata=z*d.lvol,d.rdata=z*d.rvol)}d.index=d.pointer+d.delta;1<=(d.fraction+=d.speed)&&(d.index++,d.fraction--);b.l+=d.ldata;b.r+=d.rdata;b=b.next}d=d.next}e=c;m+=h;this.samplesLeft-=h}b=this.buffer[0];d=g.outputBuffer.getChannelData(0);g=g.outputBuffer.getChannelData(1);for(l=0;l<
k;++l)1<b.l?b.l=1:-1>b.l&&(b.l=-1),1<b.r?b.r=1:-1>b.r&&(b.r=-1),d[l]=b.l,g[l]=b.r,b.l=b.r=0,b=b.next}},accurate:{value:function(g){var d,a,l,m,c,e=0,f,b=0,k,h,z,n,s=this.bufferSize,q,y;if(this.completed){if(!this.remains){this.player.stop();return}s=this.remains}for(;e<s;){this.samplesLeft||(this.player.process(),this.player.accurate(),this.samplesLeft=this.samplesTick,this.completed&&(s=e+this.samplesTick,s>this.bufferSize&&(this.remains=s-this.bufferSize,s=this.bufferSize)));q=this.samplesLeft;
e+q>=s&&(q=s-e);f=b+q;for(d=this.channels[0];d;){if(d.enabled){h=d.sample;a=h.data;if(z=d.oldSample)l=z.data;n=this.buffer[b];for(c=b;c<f;++c){y=d.mute?0:a[d.pointer];y+=(a[d.pointer+d.dir]-y)*d.fraction;1<=(d.fraction+=d.speed)&&(m=d.fraction>>0,d.fraction-=m,0<d.dir?(d.pointer+=m,d.pointer>d.length&&(d.fraction+=d.pointer-d.length,d.pointer=d.length)):(d.pointer-=m,d.pointer<d.length&&(d.fraction+=d.length-d.pointer,d.pointer=d.length)));d.mixCounter?(z?(k=d.mute?0:l[d.oldPointer],k+=(l[d.oldPointer+
d.oldDir]-k)*d.oldFraction,1<(d.oldFraction+=d.oldSpeed)&&(m=d.oldFraction>>0,d.oldFraction-=m,0<d.oldDir?(d.oldPointer+=m,d.oldPointer>d.oldLength&&(d.oldFraction+=d.oldPointer-d.oldLength,d.oldPointer=d.oldLength)):(d.oldPointer-=m,d.oldPointer<d.oldLength&&(d.oldFraction+=d.oldLength-d.oldPointer,d.oldPointer=d.oldLength))),n.l+=y*d.lmixRampU+k*d.lmixRampD,n.r+=y*d.rmixRampU+k*d.rmixRampD,d.lmixRampD-=d.lmixDeltaD,d.rmixRampD-=d.rmixDeltaD):(n.l+=y*d.lmixRampU,n.r+=y*d.rmixRampU),d.lmixRampU+=
d.lmixDeltaU,d.rmixRampU+=d.rmixDeltaU,d.mixCounter--,d.oldPointer==d.oldLength&&(z.loopMode?1==z.loopMode?(d.oldPointer=z.loopStart,d.oldLength=z.length):0<d.oldDir?(d.oldPointer=z.length-1,d.oldLength=z.loopStart,d.oldDir=-1):(d.oldFraction-=1,d.oldPointer=z.loopStart,d.oldLength=z.length,d.oldDir=1):(z=null,d.oldPointer=0))):(n.l+=y*d.lvol,n.r+=y*d.rvol,d.volCounter?(d.lvol+=d.lvolDelta,d.rvol+=d.rvolDelta,d.volCounter--):d.panCounter&&(d.lpan+=d.lpanDelta,d.rpan+=d.rpanDelta,d.panCounter--,d.lvol=
d.volume*d.lpan,d.rvol=d.volume*d.rpan));if(d.pointer==d.length)if(h.loopMode)1==h.loopMode?(d.pointer=h.loopStart,d.length=h.length):0<d.dir?(d.pointer=h.length-1,d.length=h.loopStart,d.dir=-1):(d.fraction-=1,d.pointer=h.loopStart,d.length=h.length,d.dir=1);else{d.enabled=0;break}n=n.next}}d=d.next}b=f;e+=q;this.samplesLeft-=q}n=this.buffer[0];d=g.outputBuffer.getChannelData(0);g=g.outputBuffer.getChannelData(1);for(c=0;c<s;++c)1<n.l?n.l=1:-1>n.l&&(n.l=-1),1<n.r?n.r=1:-1>n.r&&(n.r=-1),d[c]=n.l,g[c]=
n.r,n.l=n.r=0,n=n.next}}});g.bufferSize=8192;return Object.seal(g)}function F(g){var t=u();Object.defineProperties(t,{track:{value:null,writable:!0},length:{value:0,writable:!0},restart:{value:0,writable:!0},timer:{value:0,writable:!0},master:{value:0,writable:!0},volume:{set:function(d){0>d?d=0:1<d&&(d=1);this.master=64*d}},setup:{configurable:!1,value:function(){this.mixer.setup(this.channels)}}});t.mixer=g||J();t.mixer.player=t;t.endian=1;t.quality=1;return t}window.neoart=Object.create(null);
window.neoart.Unzip=1;(function(){var p="Unknown Format;Ultimate SoundTracker;D.O.C. SoundTracker 9;Master SoundTracker;D.O.C. SoundTracker 2.0/2.2;SoundTracker 2.3;SoundTracker 2.4;NoiseTracker 1.0;NoiseTracker 1.1;NoiseTracker 2.0;ProTracker 1.0;ProTracker 1.1/2.1;ProTracker 1.2/2.0;His Master's NoiseTracker;SoundFX 1.0/1.7;SoundFX 1.8;SoundFX 1.945;SoundFX 1.994/2.0;BP SoundMon V1;BP SoundMon V2;BP SoundMon V3;Delta Music 1.0;Delta Music 2.0;Digital Mugician;Digital Mugician 7 Voices;Future Composer 1.0/1.3;Future Composer 1.4;SidMon 1.0;SidMon 2.0;David Whittaker;FredEd;Jochen Hippel;Jochen Hippel COSO;Rob Hubbard;FastTracker II;Sk@leTracker;MadTracker 2.0;MilkyTracker;DigiBooster Pro 2.18;OpenMPT".split(";");
window.neoart.FileLoader=function(){var t=Object.create(null,{player:{value:null,writable:!0},index:{value:0,writable:!0},amiga:{value:null,writable:!0},mixer:{value:null,writable:!0},tracker:{get:function(){return this.player?p[this.index+this.player.version]:p[0]}},load:{value:function(d){var a,l;d.view||(d=g(d));d.endian=1;d.position=0;if(67324752==d.readUint())if(window.neoart.Unzip)d=x(d),d=d.uncompress(d.entries[0]);else throw"Unzip support is not available.";if(!d)return null;if(this.player&&
"STPlayer"!=this.player.id&&(this.player.load(d),this.player.version))return player;if(336<d.length&&(d.position=38,a=d.readString(20),"FastTracker v2.00   "==a||"FastTracker v 2.00  "==a||"Sk@le Tracker"==a||"MadTracker 2.0"==a||"MilkyTracker        "==a||"DigiBooster Pro 2.18"==a||-1!=a.indexOf("OpenMPT"))&&(this.player=window.neoart.F2Player(this.mixer),this.player.load(d),this.player.version))return this.index=33,this.player;d.endian=0;if(2105<d.length)if(d.position=1080,a=d.readString(4),"M.K."==
a||"FLT4"==a){if(this.player=window.neoart.MKPlayer(this.amiga),this.player.load(d),this.player.version)return this.index=4,this.player}else if("FEST"==a&&(this.player=window.neoart.HMPlayer(this.amiga),this.player.load(d),this.player.version))return this.index=12,this.player;if(2105<d.length&&(d.position=1080,a=d.readString(4),"M.K."==a||"M!K!"==a)&&(this.player=window.neoart.PTPlayer(this.amiga),this.player.load(d),this.player.version))return this.index=9,this.player;if(1685<d.length&&(d.position=
60,a=d.readString(4),"SONG"!=a&&(d.position=124,a=d.readString(4)),"SONG"==a||"SO31"==a)&&(this.player=window.neoart.FXPlayer(this.amiga),this.player.load(d),this.player.version))return this.index=13,this.player;if(4<d.length&&(d.position=0,a=d.readString(4),"ALL "==a&&(this.player=window.neoart.D1Player(this.amiga),this.player.load(d),this.player.version))||3018<d.length&&(d.position=3014,a=d.readString(4),".FNL"==a&&(this.player=window.neoart.D2Player(this.amiga),this.player.load(d),this.player.version)))return this.index=
20,this.player;if(30<d.length&&(d.position=26,a=d.readString(3),"BPS"==a||"V.2"==a||"V.3"==a)&&(this.player=window.neoart.BPPlayer(this.amiga),this.player.load(d),this.player.version))return this.index=17,this.player;if(4<d.length&&(d.position=0,a=d.readString(4),"SMOD"==a||"FC14"==a)&&(this.player=window.neoart.FCPlayer(this.amiga),this.player.load(d),this.player.version))return this.index=24,this.player;if(10<d.length&&(d.position=0,a=d.readString(9)," MUGICIAN"==a&&(this.player=window.neoart.DMPlayer(this.amiga),
this.player.load(d),this.player.version)))return this.index=22,this.player;if(86<d.length&&(d.position=58,a=d.readString(28),"SIDMON II - THE MIDI VERSION"==a&&(this.player=window.neoart.S2Player(this.amiga),this.player.load(d),this.player.version)))return this.index=26,this.player;if(2830<d.length&&(d.position=0,l=d.readUshort(),20218==l&&(this.player=window.neoart.FEPlayer(this.amiga),this.player.load(d),this.player.version)))return this.index=29,this.player;if(5220<d.length&&(this.player=window.neoart.S1Player(this.amiga),
this.player.load(d),this.player.version))return this.index=26,this.player;d.position=0;l=d.readUshort();d.position=0;a=d.readString(4);if("COSO"==a||24576==l||24578==l||24590==l||24598==l)if(this.player=window.neoart.JHPlayer(this.amiga),this.player.load(d),this.player.version)return this.index=30,this.player;d.position=0;d.readUshort();this.player=window.neoart.DWPlayer(this.amiga);this.player.load(d);if(this.player.version)return this.index=28,this.player;d.position=0;l=d.readUshort();if(24576==
l&&(this.player=window.neoart.RHPlayer(this.amiga),this.player.load(d),this.player.version))return this.index=32,this.player;if(1625<d.length&&(this.player=window.neoart.STPlayer(this.amiga),this.player.load(d),this.player.version))return this.index=0,this.player;d.clear();this.index=0;return this.player=null}}});t.amiga=G();return Object.seal(t)}()})();(function(){function g(a){return Object.create(null,{index:{value:a,writable:!0},next:{value:null,writable:!0},channel:{value:null,writable:!0},enabled:{value:0,
writable:!0},restart:{value:0,writable:!0},note:{value:0,writable:!0},period:{value:0,writable:!0},sample:{value:0,writable:!0},samplePtr:{value:0,writable:!0},sampleLen:{value:0,writable:!0},synth:{value:0,writable:!0},synthPtr:{value:0,writable:!0},arpeggio:{value:0,writable:!0},autoArpeggio:{value:0,writable:!0},autoSlide:{value:0,writable:!0},vibrato:{value:0,writable:!0},volume:{value:0,writable:!0},volumeDef:{value:0,writable:!0},adsrControl:{value:0,writable:!0},adsrPtr:{value:0,writable:!0},
adsrCtr:{value:0,writable:!0},lfoControl:{value:0,writable:!0},lfoPtr:{value:0,writable:!0},lfoCtr:{value:0,writable:!0},egControl:{value:0,writable:!0},egPtr:{value:0,writable:!0},egCtr:{value:0,writable:!0},egValue:{value:0,writable:!0},fxControl:{value:0,writable:!0},fxCtr:{value:0,writable:!0},modControl:{value:0,writable:!0},modPtr:{value:0,writable:!0},modCtr:{value:0,writable:!0},initialize:{value:function(){this.channel=null;this.samplePtr=this.sample=this.period=this.note=this.restart=this.enabled=
0;this.sampleLen=2;this.synth=0;this.synthPtr=-1;this.modCtr=this.modPtr=this.modControl=this.fxCtr=this.fxControl=this.egValue=this.egCtr=this.egPtr=this.egControl=this.lfoCtr=this.lfoPtr=this.lfoControl=this.adsrCtr=this.adsrPtr=this.adsrControl=this.volumeDef=this.volume=this.vibrato=this.autoSlide=this.autoArpeggio=this.arpeggio=0}}})}var t=[6848,6464,6080,5760,5440,5120,4832,4576,4320,4064,3840,3616,3424,3232,3040,2880,2720,2560,2416,2288,2160,2032,1920,1808,1712,1616,1520,1440,1360,1280,1208,
1144,1080,1016,960,904,856,808,760,720,680,640,604,572,540,508,480,452,428,404,380,360,340,320,302,286,270,254,240,226,214,202,190,180,170,160,151,143,135,127,120,113,107,101,95,90,85,80,76,72,68,64,60,57],d=[0,64,128,64,0,-64,-128,-64];window.neoart.BPPlayer=function(a){a=B(a);Object.defineProperties(a,{id:{value:"BPPlayer"},tracks:{value:[],writable:!0},patterns:{value:[],writable:!0},samples:{value:[],writable:!0},length:{value:0,writable:!0},buffer:{value:null,writable:!0},voices:{value:[],writable:!0},
trackPos:{value:0,writable:!0},patternPos:{value:0,writable:!0},row:{value:0,writable:!0},nextPos:{value:0,writable:!0},jumpFlag:{value:0,writable:!0},repeatCtr:{value:0,writable:!0},arpeggioCtr:{value:0,writable:!0},vibratoPos:{value:0,writable:!0},initialize:{value:function(){var l,a=this.voices[0];this.reset();this.speed=6;this.tick=1;this.repeatCtr=this.jumpFlag=this.nextPos=this.row=this.patternPos=this.trackPos=0;this.arpeggioCtr=1;for(l=this.vibratoPos=0;128>l;++l)this.buffer[l]=0;for(;a;)a.initialize(),
a.channel=this.mixer.channels[a.index],a.samplePtr=this.mixer.loopPtr,a=a.next}},restore:{value:function(){for(var l,a,c,e=this.voices[0];e;){if(-1<e.synthPtr)for(c=e.index<<5,a=e.synthPtr+32,l=e.synthPtr;l<a;++l)this.mixer.memory[l]=this.buffer[c++];e=e.next}}},loader:{value:function(l){var a=0,c=0,e,f,b;this.title=l.readString(26);e=l.readString(4);if("BPSM"==e)this.version=1;else{e=e.substr(0,3);if("V.2"==e)this.version=2;else if("V.3"==e)this.version=3;else return;l.position=29;b=l.readUbyte()}for(this.length=
l.readUshort();16>++c;)e=A(),Object.defineProperties(e,{synth:{value:0,writable:!0},table:{value:0,writable:!0},adsrControl:{value:0,writable:!0},adsrTable:{value:0,writable:!0},adsrLen:{value:0,writable:!0},adsrSpeed:{value:0,writable:!0},lfoControl:{value:0,writable:!0},lfoTable:{value:0,writable:!0},lfoDepth:{value:0,writable:!0},lfoLen:{value:0,writable:!0},lfoDelay:{value:0,writable:!0},lfoSpeed:{value:0,writable:!0},egControl:{value:0,writable:!0},egTable:{value:0,writable:!0},egLen:{value:0,
writable:!0},egDelay:{value:0,writable:!0},egSpeed:{value:0,writable:!0},fxControl:{value:0,writable:!0},fxDelay:{value:0,writable:!0},fxSpeed:{value:0,writable:!0},modControl:{value:0,writable:!0},modTable:{value:0,writable:!0},modLen:{value:0,writable:!0},modDelay:{value:0,writable:!0},modSpeed:{value:0,writable:!0}}),e=Object.seal(e),255==l.readUbyte()?(e.synth=1,e.table=l.readUbyte(),e.pointer=e.table<<6,e.length=l.readUshort()<<1,e.adsrControl=l.readUbyte(),e.adsrTable=l.readUbyte()<<6,e.adsrLen=
l.readUshort(),e.adsrSpeed=l.readUbyte(),e.lfoControl=l.readUbyte(),e.lfoTable=l.readUbyte()<<6,e.lfoDepth=l.readUbyte(),e.lfoLen=l.readUshort(),3>this.version?(l.readByte(),e.lfoDelay=l.readUbyte(),e.lfoSpeed=l.readUbyte(),e.egControl=l.readUbyte(),e.egTable=l.readUbyte()<<6,l.readByte(),e.egLen=l.readUshort(),l.readByte(),e.egDelay=l.readUbyte(),e.egSpeed=l.readUbyte(),e.fxSpeed=1,e.modSpeed=1,e.volume=l.readUbyte(),l.position+=6):(e.lfoDelay=l.readUbyte(),e.lfoSpeed=l.readUbyte(),e.egControl=l.readUbyte(),
e.egTable=l.readUbyte()<<6,e.egLen=l.readUshort(),e.egDelay=l.readUbyte(),e.egSpeed=l.readUbyte(),e.fxControl=l.readUbyte(),e.fxSpeed=l.readUbyte(),e.fxDelay=l.readUbyte(),e.modControl=l.readUbyte(),e.modTable=l.readUbyte()<<6,e.modSpeed=l.readUbyte(),e.modDelay=l.readUbyte(),e.volume=l.readUbyte(),e.modLen=l.readUshort())):(l.position--,e.synth=0,e.name=l.readString(24),e.length=l.readUshort()<<1,e.length?(e.loop=l.readUshort(),e.repeat=l.readUshort()<<1,e.volume=l.readUshort(),e.loop+e.repeat>=
e.length&&(e.repeat=e.length-e.loop)):(e.pointer--,e.repeat=2,l.position+=6)),this.samples[c]=e;e=this.length<<2;this.tracks.length=e;for(c=0;c<e;++c)f=D(),Object.defineProperties(f,{soundTranspose:{value:0,writable:!0}}),f=Object.seal(f),f.pattern=l.readUshort(),f.soundTranspose=l.readByte(),f.transpose=l.readByte(),f.pattern>a&&(a=f.pattern),this.tracks[c]=f;e=a<<4;this.patterns.length=e;for(c=0;c<e;++c)a=C(),a.note=l.readByte(),a.sample=l.readUbyte(),a.effect=a.sample&15,a.sample=(a.sample&240)>>
4,a.param=l.readByte(),this.patterns[c]=a;this.mixer.store(l,b<<6);for(c=0;16>++c;)e=this.samples[c],!e.synth&&e.length&&(e.pointer=this.mixer.store(l,e.length),e.loopPtr=e.pointer+e.loop)}},process:{value:function(){var l,a,c,e,f,b=this.mixer.memory,k,h=this.voices[0];this.arpeggioCtr=--this.arpeggioCtr&3;for(this.vibratoPos=++this.vibratoPos&7;h;){l=h.channel;h.period+=h.autoSlide;l.period=h.vibrato?h.period+(d[this.vibratoPos]/h.vibrato>>0):h.period;l.pointer=h.samplePtr;l.length=h.sampleLen;if(h.arpeggio||
h.autoArpeggio)e=h.note,this.arpeggioCtr?1==this.arpeggioCtr&&(e+=(h.arpeggio&15)+(h.autoArpeggio&15)):e+=((h.arpeggio&240)>>4)+((h.autoArpeggio&240)>>4),l.period=h.period=t[e+35],h.restart=0;if(!(!h.synth||0>h.sample||(e=this.samples[h.sample],h.adsrControl&&0==--h.adsrCtr&&(h.adsrCtr=e.adsrSpeed,a=128+b[e.adsrTable+h.adsrPtr]>>2,l.volume=a*h.volume>>6,++h.adsrPtr==e.adsrLen&&(h.adsrPtr=0,1==h.adsrControl&&(h.adsrControl=0))),h.lfoControl&&0==--h.lfoCtr&&(h.lfoCtr=e.lfoSpeed,a=b[e.lfoTable+h.lfoPtr],
e.lfoDepth&&(a=a/e.lfoDepth>>0),l.period=h.period+a,++h.lfoPtr==e.lfoLen&&(h.lfoPtr=0,1==h.lfoControl&&(h.lfoControl=0))),0>h.synthPtr))){if(h.egControl&&0==--h.egCtr){h.egCtr=e.egSpeed;a=h.egValue;h.egValue=128+b[e.egTable+h.egPtr]>>3;if(h.egValue!=a)if(k=(h.index<<5)+a,c=h.synthPtr+a,h.egValue<a)for(a-=h.egValue,f=c-a;c>f;)b[--c]=this.buffer[--k];else for(a=h.egValue-a,f=c+a;c<f;)b[c++]=~this.buffer[k++]+1;++h.egPtr==e.egLen&&(h.egPtr=0,1==h.egControl&&(h.egControl=0))}switch(h.fxControl){case 1:if(0==
--h.fxCtr)for(h.fxCtr=e.fxSpeed,c=h.synthPtr,f=h.synthPtr+32,a=0<c?b[c-1]:0;c<f;)a=a+b[c+1]>>1,b[c++]=a;break;case 2:k=(h.index<<5)+31;f=h.synthPtr+32;a=e.fxSpeed;for(c=h.synthPtr;c<f;++c)this.buffer[k]<b[c]?b[c]-=a:this.buffer[k]>b[c]&&(b[c]+=a),k--;break;case 3:case 5:k=h.index<<5;f=h.synthPtr+32;a=e.fxSpeed;for(c=h.synthPtr;c<f;++c)this.buffer[k]<b[c]?b[c]-=a:this.buffer[k]>b[c]&&(b[c]+=a),k++;break;case 4:k=h.synthPtr+64;f=h.synthPtr+32;a=e.fxSpeed;for(c=h.synthPtr;c<f;++c)b[k]<b[c]?b[c]-=a:b[k]>
b[c]&&(b[c]+=a),k++;break;case 6:if(0==--h.fxCtr)for(h.fxControl=0,h.fxCtr=1,k=h.synthPtr+64,f=h.synthPtr+32,c=h.synthPtr;c<f;++c)b[c]=b[k++]}h.modControl&&0==--h.modCtr&&(h.modCtr=e.modSpeed,b[h.synthPtr+32]=b[e.modTable+h.modPtr],++h.modPtr==e.modLen&&(h.modPtr=0,1==h.modControl&&(h.modControl=0)))}h=h.next}if(0==--this.tick){this.tick=this.speed;for(h=this.voices[0];h;){l=h.channel;h.enabled=0;f=this.tracks[(this.trackPos<<2)+h.index];this.row=k=this.patterns[this.patternPos+(f.pattern-1<<4)];
e=k.note;c=k.effect;a=k.param;if(e){h.autoArpeggio=h.autoSlide=h.vibrato=0;if(10!=c||0==(a&240))e+=f.transpose;h.note=e;h.period=t[e+35];h.restart=13>c?h.volumeDef=1:0;e=k.sample;0==e&&(e=h.sample);if(10!=c||0==(a&15))e+=f.soundTranspose;13>c&&(!h.synth||h.sample!=e)&&(h.sample=e,h.enabled=1)}switch(c){case 0:h.arpeggio=a;break;case 1:h.volume=a;h.volumeDef=0;if(3>this.version||!h.synth)l.volume=h.volume;break;case 2:this.tick=this.speed=a;break;case 3:this.mixer.filter.active=a;break;case 4:h.period-=
a;h.arpeggio=0;break;case 5:h.period+=a;h.arpeggio=0;break;case 6:3==this.version?h.vibrato=a:this.repeatCtr=a;break;case 7:3==this.version?(this.nextPos=a,this.jumpFlag=1):0==this.repeatCtr&&(this.trackPos=a);break;case 8:h.autoSlide=a;break;case 9:h.autoArpeggio=a;3==this.version&&(h.adsrPtr=0,0==h.adsrControl&&(h.adsrControl=1));break;case 11:h.fxControl=a;break;case 13:h.autoArpeggio=a;h.fxControl^=1;h.adsrPtr=0;0==h.adsrControl&&(h.adsrControl=1);break;case 14:h.autoArpeggio=a;h.adsrPtr=0;0==
h.adsrControl&&(h.adsrControl=1);break;case 15:h.autoArpeggio=a}h=h.next}this.jumpFlag?(this.trackPos=this.nextPos,this.patternPos=this.jumpFlag=0):16==++this.patternPos&&(this.patternPos=0,++this.trackPos==this.length&&(this.trackPos=0,this.mixer.complete=1));for(h=this.voices[0];h;){l=h.channel;h.enabled&&(l.enabled=h.enabled=0);if(0!=h.restart&&-1<h.synthPtr){k=h.index<<5;f=h.synthPtr+32;for(c=h.synthPtr;c<f;++c)b[c]=this.buffer[k++];h.synthPtr=-1}h=h.next}for(h=this.voices[0];h;){if(!(0==h.restart||
0>h.sample)){l=h.channel;l.period=h.period;h.restart=0;e=this.samples[h.sample];if(e.synth){if(h.synth=1,h.egValue=0,h.adsrPtr=h.lfoPtr=h.egPtr=h.modPtr=0,h.adsrCtr=1,h.lfoCtr=e.lfoDelay+1,h.egCtr=e.egDelay+1,h.fxCtr=e.fxDelay+1,h.modCtr=e.modDelay+1,h.adsrControl=e.adsrControl,h.lfoControl=e.lfoControl,h.egControl=e.egControl,h.fxControl=e.fxControl,h.modControl=e.modControl,l.pointer=h.samplePtr=e.pointer,l.length=h.sampleLen=e.length,h.adsrControl?(a=128+b[e.adsrTable]>>2,h.volumeDef&&(h.volume=
e.volume,h.volumeDef=0),l.volume=a*h.volume>>6):l.volume=h.volumeDef?e.volume:h.volume,h.egControl||h.fxControl||h.modControl)for(h.synthPtr=e.pointer,c=h.index<<5,f=h.synthPtr+32,k=h.synthPtr;k<f;++k)this.buffer[c++]=b[k]}else h.synth=h.lfoControl=0,0>e.pointer?(h.samplePtr=this.mixer.loopPtr,h.sampleLen=2):(l.pointer=e.pointer,l.volume=h.volumeDef?e.volume:h.volume,2!=e.repeat?(h.samplePtr=e.loopPtr,l.length=h.sampleLen=e.repeat):(h.samplePtr=this.mixer.loopPtr,h.sampleLen=2,l.length=e.length));
l.enabled=h.enabled=1}h=h.next}}}}});a.voices[0]=g(0);a.voices[0].next=a.voices[1]=g(1);a.voices[1].next=a.voices[2]=g(2);a.voices[2].next=a.voices[3]=g(3);a.buffer=new Int8Array(128);return Object.seal(a)}})();(function(){function g(a){return Object.create(null,{index:{value:a,writable:!0},next:{value:null,writable:!0},channel:{value:null,writable:!0},sample:{value:null,writable:!0},trackPos:{value:0,writable:!0},patternPos:{value:0,writable:!0},status:{value:0,writable:!0},speed:{value:0,writable:!0},
step:{value:null,writable:!0},row:{value:null,writable:!0},note:{value:0,writable:!0},period:{value:0,writable:!0},arpeggioPos:{value:0,writable:!0},pitchBend:{value:0,writable:!0},tableCtr:{value:0,writable:!0},tablePos:{value:0,writable:!0},vibratoCtr:{value:0,writable:!0},vibratoDir:{value:0,writable:!0},vibratoPos:{value:0,writable:!0},vibratoPeriod:{value:0,writable:!0},volume:{value:0,writable:!0},attackCtr:{value:0,writable:!0},decayCtr:{value:0,writable:!0},releaseCtr:{value:0,writable:!0},
sustain:{value:0,writable:!0},initialize:{value:function(){this.sample=null;this.status=this.patternPos=this.trackPos=0;this.speed=1;this.row=this.step=null;this.releaseCtr=this.decayCtr=this.attackCtr=this.volume=this.vibratoPeriod=this.vibratoPos=this.vibratoDir=this.vibratoCtr=this.tablePos=this.tableCtr=this.pitchBend=this.arpeggioPos=this.period=this.note=0;this.sustain=1}}})}function t(){var a=A();Object.defineProperties(a,{synth:{value:0,writable:!0},attackStep:{value:0,writable:!0},attackDelay:{value:0,
writable:!0},decayStep:{value:0,writable:!0},decayDelay:{value:0,writable:!0},releaseStep:{value:0,writable:!0},releaseDelay:{value:0,writable:!0},sustain:{value:0,writable:!0},arpeggio:{value:null,writable:!0},pitchBend:{value:0,writable:!0},portamento:{value:0,writable:!0},table:{value:null,writable:!0},tableDelay:{value:0,writable:!0},vibratoWait:{value:0,writable:!0},vibratoStep:{value:0,writable:!0},vibratoLen:{value:0,writable:!0}});a.arpeggio=new Int8Array(8);a.table=new Int8Array(48);return Object.seal(a)}
var d=[0,6848,6464,6096,5760,5424,5120,4832,4560,4304,4064,3840,3616,3424,3232,3048,2880,2712,2560,2416,2280,2152,2032,1920,1808,1712,1616,1524,1440,1356,1280,1208,1140,1076,960,904,856,808,762,720,678,640,604,570,538,508,480,452,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,113,113,113,113,113,113,113,113,113,113,113,113,113];window.neoart.D1Player=function(a){a=B(a);Object.defineProperties(a,{id:{value:"D1Player"},pointers:{value:null,writable:!0},tracks:{value:[],
writable:!0},patterns:{value:[],writable:!0},samples:{value:[],writable:!0},voices:{value:[],writable:!0},initialize:{value:function(){var a=this.voices[0];this.reset();for(this.speed=6;a;)a.initialize(),a.channel=this.mixer.channels[a.index],a.sample=this.samples[20],a=a.next}},loader:{value:function(a){var m,c=0,e,f=0,b,d,h;if("ALL "==a.readString(4)){for(m=new Uint32Array(25);25>c;++c)m[c]=a.readUint();this.pointers=new Uint32Array(4);for(c=1;4>c;++c)this.pointers[c]=this.pointers[f]+(m[f++]>>
1)-1;b=this.pointers[3]+(m[3]>>1)-1;this.tracks.length=b;e=104+m[1]-2;a.position=104;f=1;for(c=0;c<b;++c)d=D(),h=a.readUshort(),65535==h||a.position==e?(d.pattern=-1,d.transpose=a.readUshort(),e+=m[f++]):(a.position--,d.pattern=(h>>2&16320)>>2,d.transpose=a.readByte()),this.tracks[c]=d;b=m[4]>>2;this.patterns.length=b;for(c=0;c<b;++c)e=C(),e.sample=a.readUbyte(),e.note=a.readUbyte(),e.effect=a.readUbyte()&31,e.param=a.readUbyte(),this.patterns[c]=e;e=5;for(c=0;20>c;++c){this.samples[c]=null;if(0!=
m[e]){d=t();d.attackStep=a.readUbyte();d.attackDelay=a.readUbyte();d.decayStep=a.readUbyte();d.decayDelay=a.readUbyte();d.sustain=a.readUshort();d.releaseStep=a.readUbyte();d.releaseDelay=a.readUbyte();d.volume=a.readUbyte();d.vibratoWait=a.readUbyte();d.vibratoStep=a.readUbyte();d.vibratoLen=a.readUbyte();d.pitchBend=a.readByte();d.portamento=a.readUbyte();d.synth=a.readUbyte();d.tableDelay=a.readUbyte();for(f=0;8>f;++f)d.arpeggio[f]=a.readByte();d.length=a.readUshort();d.loop=a.readUshort();d.repeat=
a.readUshort()<<1;d.synth=d.synth?0:1;if(d.synth){for(f=0;48>f;++f)d.table[f]=a.readByte();b=m[e]-78}else b=d.length;d.pointer=this.mixer.store(a,b);d.loopPtr=d.pointer+d.loop;this.samples[c]=d}e++}d=t();d.pointer=d.loopPtr=this.mixer.memory.length;d.length=d.repeat=2;this.samples[20]=d;this.version=1}}},process:{value:function(){for(var a,m,c,e,f=this.voices[0];f;){m=f.channel;0==--f.speed&&(f.speed=this.speed,0==f.patternPos&&(f.step=this.tracks[this.pointers[f.index]+f.trackPos],0>f.step.pattern&&
(f.trackPos=f.step.transpose,f.step=this.tracks[this.pointers[f.index]+f.trackPos]),f.trackPos++),c=this.patterns[f.step.pattern+f.patternPos],c.effect&&(f.row=c),c.note&&(m.enabled=0,f.row=c,f.note=c.note+f.step.transpose,f.arpeggioPos=f.pitchBend=f.status=0,e=f.sample=this.samples[c.sample],e.synth||(m.pointer=e.pointer),m.length=e.length,f.tableCtr=f.tablePos=0,f.vibratoCtr=e.vibratoWait,f.vibratoPos=e.vibratoLen,f.vibratoDir=e.vibratoLen<<1,f.volume=f.attackCtr=f.decayCtr=f.releaseCtr=0,f.sustain=
e.sustain),16==++f.patternPos&&(f.patternPos=0));e=f.sample;if(e.synth)if(0==f.tableCtr){f.tableCtr=e.tableDelay;do a=1,48<=f.tablePos&&(f.tablePos=0),c=e.table[f.tablePos],f.tablePos++,0<=c?(m.pointer=e.pointer+(c<<5),a=0):-1!=c?e.tableDelay=c&127:f.tablePos=e.table[f.tablePos];while(a)}else f.tableCtr--;e.portamento&&(c=d[f.note]+f.pitchBend,0!=f.period?f.period<c?(f.period+=e.portamento,f.period>c&&(f.period=c)):(f.period-=e.portamento,f.period<c&&(f.period=c)):f.period=c);0==f.vibratoCtr?(f.vibratoPeriod=
f.vibratoPos*e.vibratoStep,0==(f.status&1)?(f.vibratoPos++,f.vibratoPos==f.vibratoDir&&(f.status^=1)):(f.vibratoPos--,0==f.vibratoPos&&(f.status^=1))):f.vibratoCtr--;f.pitchBend=0>e.pitchBend?f.pitchBend+e.pitchBend:f.pitchBend-e.pitchBend;if(f.row)switch(c=f.row,c.effect){case 1:if(c=c.param&15)this.speed=c;break;case 2:f.pitchBend-=c.param;break;case 3:f.pitchBend+=c.param;break;case 4:this.mixer.filter.active=c.param;break;case 5:e.vibratoWait=c.param;break;case 6:e.vibratoStep=c.param;case 7:e.vibratoLen=
c.param;break;case 8:e.pitchBend=c.param;break;case 9:e.portamento=c.param;break;case 10:e.volume=64;break;case 11:e.arpeggio[0]=c.param;break;case 12:e.arpeggio[1]=c.param;break;case 13:e.arpeggio[2]=c.param;break;case 14:e.arpeggio[3]=c.param;break;case 15:e.arpeggio[4]=c.param;break;case 16:e.arpeggio[5]=c.param;break;case 17:e.arpeggio[6]=c.param;break;case 18:e.arpeggio[7]=c.param;break;case 19:e.arpeggio[0]=e.arpeggio[4]=c.param;break;case 20:e.arpeggio[1]=e.arpeggio[5]=c.param;break;case 21:e.arpeggio[2]=
e.arpeggio[6]=c.param;break;case 22:e.arpeggio[3]=e.arpeggio[7]=c.param;break;case 23:c=c.param;64<c&&(c=64);e.attackStep=c;break;case 24:e.attackDelay=c.param;break;case 25:c=c.param;64<c&&(c=64);e.decayStep=c;break;case 26:e.decayDelay=c.param;break;case 27:e.sustain=c.param&e.sustain&255;break;case 28:e.sustain=(e.sustain&65280)+c.param;break;case 29:c=c.param;64<c&&(c=64);e.releaseStep=c;break;case 30:e.releaseDelay=c.param}e.portamento?c=f.period:(c=d[f.note+e.arpeggio[f.arpeggioPos]],f.arpeggioPos=
++f.arpeggioPos&7,c-=e.vibratoLen*e.vibratoStep,c+=f.pitchBend,f.period=0);m.period=c+f.vibratoPeriod;a=f.status&14;c=f.volume;0==a&&(0==f.attackCtr?(f.attackCtr=e.attackDelay,c+=e.attackStep,64<=c&&(a|=2,f.status|=2,c=64)):f.attackCtr--);2==a&&(0==f.decayCtr?(f.decayCtr=e.decayDelay,c-=e.decayStep,c<=e.volume&&(a|=6,f.status|=6,c=e.volume)):f.decayCtr--);6==a&&(0==f.sustain?(a|=14,f.status|=14):f.sustain--);14==a&&(0==f.releaseCtr?(f.releaseCtr=e.releaseDelay,c-=e.releaseStep,0>c&&(f.status&=9,c=
0)):f.releaseCtr--);m.volume=f.volume=c;m.enabled=1;e.synth||(e.loop?(m.pointer=e.loopPtr,m.length=e.repeat):(m.pointer=this.mixer.loopPtr,m.length=2));f=f.next}}}});a.voices[0]=g(0);a.voices[0].next=a.voices[1]=g(1);a.voices[1].next=a.voices[2]=g(2);a.voices[2].next=a.voices[3]=g(3);return Object.seal(a)}})();(function(){function g(a){return Object.create(null,{index:{value:a,writable:!0},next:{value:null,writable:!0},channel:{value:null,writable:!0},sample:{value:null,writable:!0},trackPtr:{value:0,
writable:!0},trackPos:{value:0,writable:!0},trackLen:{value:0,writable:!0},patternPos:{value:0,writable:!0},restart:{value:0,writable:!0},step:{value:null,writable:!0},row:{value:null,writable:!0},note:{value:0,writable:!0},period:{value:0,writable:!0},finalPeriod:{value:0,writable:!0},arpeggioPtr:{value:0,writable:!0},arpeggioPos:{value:0,writable:!0},pitchBend:{value:0,writable:!0},portamento:{value:0,writable:!0},tableCtr:{value:0,writable:!0},tablePos:{value:0,writable:!0},vibratoCtr:{value:0,
writable:!0},vibratoDir:{value:0,writable:!0},vibratoPos:{value:0,writable:!0},vibratoPeriod:{value:0,writable:!0},vibratoSustain:{value:0,writable:!0},volume:{value:0,writable:!0},volumeMax:{value:0,writable:!0},volumePos:{value:0,writable:!0},volumeSustain:{value:0,writable:!0},initialize:{value:function(){this.sample=null;this.restart=this.patternPos=this.trackLen=this.trackPos=this.trackPtr=0;this.row=this.step=null;this.volume=this.vibratoSustain=this.vibratoPeriod=this.vibratoPos=this.vibratoDir=
this.vibratoCtr=this.tablePos=this.tableCtr=this.portamento=this.pitchBend=this.arpeggioPos=this.arpeggioPtr=this.finalPeriod=this.period=this.note=0;this.volumeMax=63;this.volumeSustain=this.volumePos=0}}})}function t(){var a=A();Object.defineProperties(a,{index:{value:0,writable:!0},pitchBend:{value:0,writable:!0},synth:{value:0,writable:!0},table:{value:null,writable:!0},vibratos:{value:null,writable:!0},volumes:{value:null,writable:!0}});a.table=new Uint8Array(48);a.vibratos=new Uint8Array(15);
a.volumes=new Uint8Array(15);return Object.seal(a)}var d=[0,6848,6464,6096,5760,5424,5120,4832,4560,4304,4064,3840,3616,3424,3232,3048,2880,2712,2560,2416,2280,2152,2032,1920,1808,1712,1616,1524,1440,1356,1280,1208,1140,1076,1016,960,904,856,808,762,720,678,640,604,570,538,508,480,452,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,113,113,113,113,113,113,113,113,113,113,113,113,113];window.neoart.D2Player=function(a){a=B(a);Object.defineProperties(a,{id:{value:"D2Player"},
tracks:{value:[],writable:!0},patterns:{value:[],writable:!0},samples:{value:[],writable:!0},data:{value:null,writable:!0},arpeggios:{value:null,writable:!0},voices:{value:[],writable:!0},noise:{value:0,writable:!0},initialize:{value:function(){var a=this.voices[0];this.reset();this.speed=5;this.tick=1;for(this.noise=0;a;)a.initialize(),a.channel=this.mixer.channels[a.index],a.sample=this.samples[this.samples.length-1],a.trackPtr=this.data[a.index],a.restart=this.data[a.index+4],a.trackLen=this.data[a.index+
8],a=a.next}},loader:{value:function(a){var d=0,c,e=0,f,b,k;a.position=3014;if(".FNL"==a.readString(4)){a.position=4042;for(this.data=new Uint16Array(12);4>d;++d)this.data[d+4]=a.readUshort()>>1,k=a.readUshort()>>1,this.data[d+8]=k,e+=k;k=e;for(d=3;0<d;--d)this.data[d]=k-=this.data[d+8];this.tracks.length=e;for(d=0;d<e;++d)c=D(),c.pattern=a.readUbyte()<<4,c.transpose=a.readByte(),this.tracks[d]=c;e=a.readUint()>>2;this.patterns.length=e;for(d=0;d<e;++d)f=C(),f.note=a.readUbyte(),f.sample=a.readUbyte(),
f.effect=a.readUbyte()-1,f.param=a.readUbyte(),this.patterns[d]=f;a.position+=254;k=a.readUshort();b=a.position;a.position-=256;e=1;f=new Uint16Array(128);for(d=0;128>d;++d)c=a.readUshort(),c!=k&&(f[e++]=c);this.samples.length=e;for(d=0;d<e;++d){a.position=b+f[d];k=t();k.length=a.readUshort()<<1;k.loop=a.readUshort();k.repeat=a.readUshort()<<1;for(c=0;15>c;++c)k.volumes[c]=a.readUbyte();for(c=0;15>c;++c)k.vibratos[c]=a.readUbyte();k.pitchBend=a.readUshort();k.synth=a.readByte();k.index=a.readUbyte();
for(c=0;48>c;++c)k.table[c]=a.readUbyte();this.samples[d]=k}e=a.readUint();this.mixer.store(a,e);a.position+=64;for(d=0;8>d;++d)f[d]=a.readUint();e=this.samples.length;b=a.position;for(d=0;d<e;++d)k=this.samples[d],0<=k.synth||(a.position=b+f[k.index],k.pointer=this.mixer.store(a,k.length),k.loopPtr=k.pointer+k.loop);a.position=3018;for(d=0;1024>d;++d)this.arpeggios[d]=a.readByte();k=t();k.pointer=k.loopPtr=this.mixer.memory.length;k.length=k.repeat=2;this.samples[e]=k;e=this.patterns.length;c=this.samples.length-
1;for(d=0;d<e;++d)f=this.patterns[d],f.sample>c&&(f.sample=0);this.version=2}}},process:{value:function(){var a;a=0;for(var m,c,e,f=this.voices[0];64>a;)this.noise=this.noise<<7|this.noise>>>25,this.noise+=1858762093,this.noise^=2656676139,c=this.noise>>>24&255,127<c&&(c|=-256),this.mixer.memory[a++]=c,c=this.noise>>>16&255,127<c&&(c|=-256),this.mixer.memory[a++]=c,c=this.noise>>>8&255,127<c&&(c|=-256),this.mixer.memory[a++]=c,c=this.noise&255,127<c&&(c|=-256),this.mixer.memory[a++]=c;0>--this.tick&&
(this.tick=this.speed);for(;f;){if(!(1>f.trackLen)){a=f.channel;e=f.sample;e.synth&&(a.pointer=e.loopPtr,a.length=e.repeat);if(0==this.tick){0==f.patternPos&&(f.step=this.tracks[f.trackPtr+f.trackPos],++f.trackPos==f.trackLen&&(f.trackPos=f.restart));c=f.row=this.patterns[f.step.pattern+f.patternPos];c.note&&(a.enabled=0,f.note=c.note,f.period=d[c.note+f.step.transpose],e=f.sample=this.samples[c.sample],0>e.synth&&(a.pointer=e.pointer,a.length=e.length),f.arpeggioPos=0,f.tableCtr=0,f.tablePos=0,f.vibratoCtr=
e.vibratos[1],f.vibratoPos=0,f.vibratoDir=0,f.vibratoPeriod=0,f.vibratoSustain=e.vibratos[2],f.volume=0,f.volumePos=0,f.volumeSustain=0);switch(c.effect){case 0:this.speed=c.param&15;break;case 1:this.mixer.filter.active=c.param;break;case 2:f.pitchBend=~(c.param&255)+1;break;case 3:f.pitchBend=c.param&255;break;case 4:f.portamento=c.param;break;case 5:f.volumeMax=c.param&63;break;case 6:this.mixer.volume=c.param;break;case 7:f.arpeggioPtr=(c.param&63)<<4}f.patternPos=++f.patternPos&15}e=f.sample;
0<=e.synth&&(f.tableCtr?f.tableCtr--:(f.tableCtr=e.index,c=e.table[f.tablePos],255==c&&(c=e.table[++f.tablePos],255!=c&&(f.tablePos=c,c=e.table[f.tablePos])),255!=c&&(a.pointer=c<<8,a.length=e.length,47<++f.tablePos&&(f.tablePos=0))));c=e.vibratos[f.vibratoPos];f.vibratoPeriod=f.vibratoDir?f.vibratoPeriod-c:f.vibratoPeriod+c;0==--f.vibratoCtr&&(f.vibratoCtr=e.vibratos[f.vibratoPos+1],f.vibratoDir=~f.vibratoDir);f.vibratoSustain?f.vibratoSustain--:(f.vibratoPos+=3,15==f.vibratoPos&&(f.vibratoPos=12),
f.vibratoSustain=e.vibratos[f.vibratoPos+2]);f.volumeSustain?f.volumeSustain--:(c=e.volumes[f.volumePos],m=e.volumes[f.volumePos+1],m<f.volume?(f.volume-=c,f.volume<m&&(f.volume=m,f.volumePos+=3,f.volumeSustain=e.volumes[f.volumePos-1])):(f.volume+=c,f.volume>m&&(f.volume=m,f.volumePos+=3,15==f.volumePos&&(f.volumePos=12),f.volumeSustain=e.volumes[f.volumePos-1])));f.portamento&&(f.period<f.finalPeriod?(f.finalPeriod-=f.portamento,f.finalPeriod<f.period&&(f.finalPeriod=f.period)):(f.finalPeriod+=
f.portamento,f.finalPeriod>f.period&&(f.finalPeriod=f.period)));c=this.arpeggios[f.arpeggioPtr+f.arpeggioPos];-128==c&&(f.arpeggioPos=0,c=this.arpeggios[f.arpeggioPtr]);f.arpeggioPos=++f.arpeggioPos&15;0==f.portamento&&(c=f.note+f.step.transpose+c,0>c&&(c=0),f.finalPeriod=d[c]);f.vibratoPeriod-=e.pitchBend-f.pitchBend;a.period=f.finalPeriod+f.vibratoPeriod;c=f.volume>>2&63;c>f.volumeMax&&(c=f.volumeMax);a.volume=c;a.enabled=1}f=f.next}}}});a.voices[0]=g(0);a.voices[0].next=a.voices[1]=g(1);a.voices[1].next=
a.voices[2]=g(2);a.voices[2].next=a.voices[3]=g(3);a.arpeggios=new Int8Array(1024);return Object.seal(a)}})();(function(){function g(){return Object.create(null,{channel:{value:null,writable:!0},sample:{value:null,writable:!0},step:{value:null,writable:!0},note:{value:0,writable:!0},period:{value:0,writable:!0},val1:{value:0,writable:!0},val2:{value:0,writable:!0},finalPeriod:{value:0,writable:!0},arpeggioStep:{value:0,writable:!0},effectCtr:{value:0,writable:!0},pitch:{value:0,writable:!0},pitchCtr:{value:0,
writable:!0},pitchStep:{value:0,writable:!0},portamento:{value:0,writable:!0},volume:{value:0,writable:!0},volumeCtr:{value:0,writable:!0},volumeStep:{value:0,writable:!0},mixMute:{value:0,writable:!0},mixPtr:{value:0,writable:!0},mixEnd:{value:0,writable:!0},mixSpeed:{value:0,writable:!0},mixStep:{value:0,writable:!0},mixVolume:{value:0,writable:!0},initialize:{value:function(){this.step=this.sample=null;this.volumeStep=this.volumeCtr=this.volume=this.portamento=this.pitchStep=this.pitchCtr=this.pitch=
this.effectCtr=this.arpeggioStep=this.finalPeriod=this.val2=this.val1=this.period=this.note=0;this.mixMute=1;this.mixVolume=this.mixStep=this.mixSpeed=this.mixEnd=this.mixPtr=0}}})}var t=[3220,3040,2869,2708,2556,2412,2277,2149,2029,1915,1807,1706,1610,1520,1434,1354,1278,1206,1139,1075,1014,957,904,853,805,760,717,677,639,603,569,537,507,479,452,426,403,380,359,338,319,302,285,269,254,239,226,213,201,190,179,169,160,151,142,134,127,4842,4571,4314,4072,3843,3628,3424,3232,3051,2879,2718,2565,2421,
2285,2157,2036,1922,1814,1712,1616,1525,1440,1359,1283,1211,1143,1079,1018,961,907,856,808,763,720,679,641,605,571,539,509,480,453,428,404,381,360,340,321,303,286,270,254,240,227,214,202,191,180,170,160,151,143,135,127,4860,4587,4330,4087,3857,3641,3437,3244,3062,2890,2728,2574,2430,2294,2165,2043,1929,1820,1718,1622,1531,1445,1364,1287,1215,1147,1082,1022,964,910,859,811,765,722,682,644,607,573,541,511,482,455,430,405,383,361,341,322,304,287,271,255,241,228,215,203,191,181,170,161,152,143,135,128,
4878,4604,4345,4102,3871,3654,3449,3255,3073,2900,2737,2584,2439,2302,2173,2051,1936,1827,1724,1628,1536,1450,1369,1292,1219,1151,1086,1025,968,914,862,814,768,725,684,646,610,575,543,513,484,457,431,407,384,363,342,323,305,288,272,256,242,228,216,203,192,181,171,161,152,144,136,128,4895,4620,4361,4116,3885,3667,3461,3267,3084,2911,2747,2593,2448,2310,2181,2058,1943,1834,1731,1634,1542,1455,1374,1297,1224,1155,1090,1029,971,917,865,817,771,728,687,648,612,578,545,515,486,458,433,408,385,364,343,324,
306,289,273,257,243,229,216,204,193,182,172,162,153,144,136,129,4913,4637,4377,4131,3899,3681,3474,3279,3095,2921,2757,2603,2456,2319,2188,2066,1950,1840,1737,1639,1547,1461,1379,1301,1228,1159,1094,1033,975,920,868,820,774,730,689,651,614,580,547,516,487,460,434,410,387,365,345,325,307,290,274,258,244,230,217,205,193,183,172,163,154,145,137,129,4931,4654,4393,4146,3913,3694,3486,3291,3106,2932,2767,2612,2465,2327,2196,2073,1957,1847,1743,1645,1553,1466,1384,1306,1233,1163,1098,1037,978,923,872,823,
777,733,692,653,616,582,549,518,489,462,436,411,388,366,346,326,308,291,275,259,245,231,218,206,194,183,173,163,154,145,137,130,4948,4671,4409,4161,3928,3707,3499,3303,3117,2942,2777,2621,2474,2335,2204,2081,1964,1854,1750,1651,1559,1471,1389,1311,1237,1168,1102,1040,982,927,875,826,779,736,694,655,619,584,551,520,491,463,437,413,390,368,347,328,309,292,276,260,245,232,219,206,195,184,174,164,155,146,138,130,4966,4688,4425,4176,3942,3721,3512,3315,3129,2953,2787,2631,2483,2344,2212,2088,1971,1860,
1756,1657,1564,1477,1394,1315,1242,1172,1106,1044,985,930,878,829,782,738,697,658,621,586,553,522,493,465,439,414,391,369,348,329,310,293,277,261,246,233,219,207,196,185,174,164,155,146,138,131,4984,4705,4441,4191,3956,3734,3524,3327,3140,2964,2797,2640,2492,2352,2220,2096,1978,1867,1762,1663,1570,1482,1399,1320,1246,1176,1110,1048,989,934,881,832,785,741,699,660,623,588,555,524,495,467,441,416,392,370,350,330,312,294,278,262,247,233,220,208,196,185,175,165,156,147,139,131,5002,4722,4457,4206,3970,
3748,3537,3339,3151,2974,2807,2650,2501,2361,2228,2103,1985,1874,1769,1669,1576,1487,1404,1325,1251,1180,1114,1052,993,937,884,835,788,744,702,662,625,590,557,526,496,468,442,417,394,372,351,331,313,295,279,263,248,234,221,209,197,186,175,166,156,148,139,131,5020,4739,4473,4222,3985,3761,3550,3351,3163,2985,2818,2659,2510,2369,2236,2111,1992,1881,1775,1675,1581,1493,1409,1330,1255,1185,1118,1055,996,940,887,838,791,746,704,665,628,592,559,528,498,470,444,419,395,373,352,332,314,296,280,264,249,235,
222,209,198,187,176,166,157,148,140,132,5039,4756,4489,4237,3999,3775,3563,3363,3174,2996,2828,2669,2519,2378,2244,2118,2E3,1887,1781,1681,1587,1498,1414,1335,1260,1189,1122,1059,1E3,944,891,841,794,749,707,667,630,594,561,530,500,472,445,420,397,374,353,334,315,297,281,265,250,236,223,210,198,187,177,167,157,149,140,132,5057,4773,4505,4252,4014,3788,3576,3375,3186,3007,2838,2679,2528,2387,2253,2126,2007,1894,1788,1688,1593,1503,1419,1339,1264,1193,1126,1063,1003,947,894,844,796,752,710,670,632,597,
563,532,502,474,447,422,398,376,355,335,316,298,282,266,251,237,223,211,199,188,177,167,158,149,141,133,5075,4790,4521,4268,4028,3802,3589,3387,3197,3018,2848,2688,2538,2395,2261,2134,2014,1901,1794,1694,1599,1509,1424,1344,1269,1198,1130,1067,1007,951,897,847,799,754,712,672,634,599,565,533,504,475,449,423,400,377,356,336,317,299,283,267,252,238,224,212,200,189,178,168,159,150,141,133,5093,4808,4538,4283,4043,3816,3602,3399,3209,3029,2859,2698,2547,2404,2269,2142,2021,1908,1801,1700,1604,1514,1429,
1349,1273,1202,1134,1071,1011,954,900,850,802,757,715,675,637,601,567,535,505,477,450,425,401,379,357,337,318,300,284,268,253,238,225,212,201,189,179,169,159,150,142,134];window.neoart.DMPlayer=function(d){d=B(d);Object.defineProperties(d,{id:{value:"DMPlayer"},songs:{value:[],writable:!0},patterns:{value:[],writable:!0},samples:{value:[],writable:!0},voices:{value:[],writable:!0},buffer1:{value:0,writable:!0},buffer2:{value:0,writable:!0},song1:{value:0,writable:!0},song2:{value:0,writable:!0},trackPos:{value:0,
writable:!0},patternPos:{value:0,writable:!0},patternLen:{value:0,writable:!0},patternEnd:{value:0,writable:!0},stepEnd:{value:0,writable:!0},numChannels:{value:0,writable:!0},arpeggios:{value:null,writable:!0},averages:{value:null,writable:!0},volumes:{value:null,writable:!0},mixChannel:{value:null,writable:!0},mixPeriod:{value:0,writable:!0},initialize:{value:function(){var a,l=0,d;this.reset();7<this.playSong&&(this.playSong=0);this.song1=this.songs[this.playSong];this.speed=this.song1.speed&15;
this.speed|=this.speed<<4;this.tick=this.song1.speed;this.patternPos=this.trackPos=0;this.patternLen=64;this.stepEnd=this.patternEnd=1;for(this.numChannels=4;7>l;++l)d=this.voices[l],d.initialize(),d.sample=this.samples[0],4>l&&(a=this.mixer.channels[l],a.enabled=0,a.pointer=this.mixer.loopPtr,a.length=2,a.period=124,a.volume=0,d.channel=a);if(2==this.version)for(0!=(this.playSong&1)&&this.playSong--,this.song2=this.songs[this.playSong+1],this.mixChannel=w(7),this.numChannels=7,a=this.mixer.channels[3],
a.mute=0,a.pointer=this.buffer1,a.length=350,a.period=this.mixPeriod,a.volume=64,a=this.buffer1+700,l=this.buffer1;l<a;++l)this.mixer.memory[l]=0}},loader:{value:function(a){var l,d=0,c,e,f,b;c=a.readString(24);if(" MUGICIAN/SOFTEYES 1990 "==c)this.version=1;else if(" MUGICIAN2/SOFTEYES 1990"==c)this.version=2;else return;a.position=28;for(e=new Uint32Array(8);8>d;++d)e[d]=a.readUint();a.position=76;for(d=0;8>d;++d)f=Object.create(null,{title:{value:"",writable:!0},speed:{value:0,writable:!0},length:{value:0,
writable:!0},loop:{value:0,writable:!0},loopStep:{value:0,writable:!0},tracks:{value:[],writable:!0}}),f.loop=a.readUbyte(),f.loopStep=a.readUbyte()<<2,f.speed=a.readUbyte(),f.length=a.readUbyte()<<2,f.title=a.readString(12),this.songs[d]=f;a.position=204;this.lastSong=this.songs.length-1;for(d=0;8>d;++d)for(f=this.songs[d],c=e[d]<<2,l=0;l<c;++l)b=D(),b.pattern=a.readUbyte()<<6,b.transpose=a.readByte(),f.tracks[l]=b;f=a.position;a.position=60;c=a.readUint();this.samples.length=++c;a.position=f;for(d=
1;d<c;++d)e=A(),Object.defineProperties(e,{wave:{value:0,writable:!0},waveLen:{value:0,writable:!0},finetune:{value:0,writable:!0},arpeggio:{value:0,writable:!0},pitch:{value:0,writable:!0},pitchDelay:{value:0,writable:!0},pitchLoop:{value:0,writable:!0},pitchSpeed:{value:0,writable:!0},effect:{value:0,writable:!0},effectDone:{value:0,writable:!0},effectStep:{value:0,writable:!0},effectSpeed:{value:0,writable:!0},source1:{value:0,writable:!0},source2:{value:0,writable:!0},volumeLoop:{value:0,writable:!0},
volumeSpeed:{value:0,writable:!0}}),b=Object.seal(e),b.wave=a.readUbyte(),b.waveLen=a.readUbyte()<<1,b.volume=a.readUbyte(),b.volumeSpeed=a.readUbyte(),b.arpeggio=a.readUbyte(),b.pitch=a.readUbyte(),b.effectStep=a.readUbyte(),b.pitchDelay=a.readUbyte(),b.finetune=a.readUbyte()<<6,b.pitchLoop=a.readUbyte(),b.pitchSpeed=a.readUbyte(),b.effect=a.readUbyte(),b.source1=a.readUbyte(),b.source2=a.readUbyte(),b.effectSpeed=a.readUbyte(),b.volumeLoop=a.readUbyte(),this.samples[d]=b;this.samples[0]=this.samples[1];
f=a.position;a.position=64;c=a.readUint()<<7;a.position=f;this.mixer.store(a,c);f=a.position;a.position=68;e=a.readUint();a.position=26;c=a.readUshort()<<6;this.patterns.length=c;a.position=f+(e<<5);e&&(e=f);for(d=0;d<c;++d)l=C(),l.note=a.readUbyte(),l.sample=a.readUbyte()&63,l.effect=a.readUbyte(),l.param=a.readByte(),this.patterns[d]=l;f=a.position;a.position=72;if(e)for(c=a.readUint(),a.position=f,l=this.mixer.store(a,c),f=a.position,this.mixer.memory.length+=350,this.buffer1=this.mixer.memory.length,
this.mixer.memory.length+=350,this.buffer2=this.mixer.memory.length,this.mixer.memory.length+=350,this.mixer.loopLen=8,c=this.samples.length,d=1;d<c;++d)b=this.samples[d],32>b.wave||(a.position=e+(b.wave-32<<5),b.pointer=a.readUint(),b.length=a.readUint()-b.pointer,b.loop=a.readUint(),b.name=a.readString(12),b.loop?(b.loop-=b.pointer,b.repeat=b.length-b.loop,0!=(b.repeat&1)&&b.repeat--):(b.loopPtr=this.mixer.memory.length,b.repeat=8),0!=(b.pointer&1)&&b.pointer--,0!=(b.length&1)&&b.length--,b.pointer+=
l,b.loopPtr||(b.loopPtr=b.pointer+b.loop));else f+=a.readUint();a.position=24;if(1==a.readUshort())for(a.position=f,c=a.length-a.position,256<c&&(c=256),d=0;d<c;++d)this.arpeggios[d]=a.readUbyte()}},process:{value:function(){for(var a,l,d=0,c,e,f,b=this.mixer.memory,k,h,g,n,s,q;d<this.numChannels;++d){q=this.voices[d];n=q.sample;3>d||4==this.numChannels?(a=q.channel,this.stepEnd&&(q.step=this.song1.tracks[this.trackPos+d]),31<n.wave&&(a.pointer=n.loopPtr,a.length=n.repeat)):(a=this.mixChannel,this.stepEnd&&
(q.step=this.song2.tracks[this.trackPos+(d-3)]));if(this.patternEnd&&(l=this.patterns[q.step.pattern+this.patternPos],l.note)){74!=l.effect&&(q.note=l.note,l.sample&&(n=q.sample=this.samples[l.sample]));q.val1=64>l.effect?1:l.effect-62;q.val2=l.param;c=q.step.transpose+n.finetune;12!=q.val1?(q.pitch=l.effect,1==q.val1&&(c+=q.pitch,q.period=0>c?0:t[c])):(q.pitch=l.note,c+=q.pitch,q.period=0>c?0:t[c]);11==q.val1&&(n.arpeggio=q.val2&7);if(12!=q.val1)if(31<n.wave)a.pointer=n.pointer,a.length=n.length,
a.enabled=0,q.mixPtr=n.pointer,q.mixEnd=n.pointer+n.length,q.mixMute=0;else if(l=n.wave<<7,a.pointer=l,a.length=n.waveLen,10!=q.val1&&(a.enabled=0),4==this.numChannels&&0!=n.effect&&2!=q.val1&&4!=q.val1){f=l+128;h=n.source1<<7;for(e=l;e<f;++e)b[e]=b[h++];n.effectStep=0;q.effectCtr=n.effectSpeed}3!=q.val1&&4!=q.val1&&12!=q.val1&&(q.volumeCtr=1,q.volumeStep=0);q.arpeggioStep=0;q.pitchCtr=n.pitchDelay;q.pitchStep=0;q.portamento=0}switch(q.val1){case 5:s=q.val2;0<s&&65>s&&(this.patternLen=s);break;case 6:s=
q.val2&15;s|=s<<4;if(0==q.val2||15<q.val2)break;this.speed=s;break;case 7:this.mixer.filter.active=1;break;case 8:this.mixer.filter.active=0;break;case 13:q.val1=0;s=q.val2&15;if(0==s)break;s=q.val2&240;if(0==s)break;this.speed=q.val2}}for(d=0;d<this.numChannels;++d){q=this.voices[d];n=q.sample;if(4==this.numChannels){if(a=q.channel,32>n.wave&&n.effect&&!n.effectDone)if(n.effectDone=1,q.effectCtr)q.effectCtr--;else switch(q.effectCtr=n.effectSpeed,l=n.wave<<7,n.effect){case 1:for(e=0;127>e;++e)s=
b[l],s+=b[l+1],b[l++]=s>>1;break;case 2:h=n.source1<<7;g=n.source2<<7;c=n.effectStep;f=n.waveLen;n.effectStep=++n.effectStep&127;for(e=0;e<f;++e)s=b[h++],s+=b[g+c],b[l++]=s>>1,c=++c&127;break;case 3:s=b[l];for(e=0;127>e;++e)b[l]=b[++l];b[l]=s;break;case 4:l+=127;s=b[l];for(e=0;127>e;++e)b[l]=b[--l];b[l]=s;break;case 5:c=s=l;for(e=0;64>e;++e)b[c++]=b[l++],l++;c=l=s;c+=64;for(e=0;64>e;++e)b[c++]=b[l++];break;case 6:h=l+64;l+=128;for(e=0;64>e;++e)b[--l]=b[--h],b[--l]=b[h];break;case 7:l+=n.effectStep;
b[l]=~b[l]+1;++n.effectStep>=n.waveLen&&(n.effectStep=0);break;case 8:n.effectStep=++n.effectStep&127;g=(n.source2<<7)+n.effectStep;c=b[g];f=n.waveLen;s=3;for(e=0;e<f;++e)h=b[l]+s,-128>h?h+=256:127<h&&(h-=256),b[l++]=h,s+=c,-128>s?s+=256:127<s&&(s-=256);break;case 9:g=n.source2<<7;f=n.waveLen;for(e=0;e<f;++e)s=b[g++],s+=b[l],127<s&&(s-=256),b[l++]=s;break;case 10:for(e=0;126>e;++e)s=3*b[l++],s+=b[l+1],b[l]=s>>2;break;case 11:h=n.source1<<7;g=n.source2<<7;f=n.waveLen;n.effectStep=++n.effectStep&127;
s=n.effectStep;64<=s&&(s=127-s);c=(s^255)&63;for(e=0;e<f;++e)k=b[h++]*s,k+=b[g++]*c,b[l++]=k>>6;break;case 12:h=n.source1<<7;g=n.source2<<7;f=n.waveLen;n.effectStep=++n.effectStep&31;s=n.effectStep;16<=s&&(s=31-s);c=(s^255)&15;for(e=0;e<f;++e)k=b[h++]*s,k+=b[g++]*c,b[l++]=k>>4;break;case 13:for(e=0;126>e;++e)s=b[l++],s+=b[l+1],b[l]=s>>1;break;case 14:c=l+n.effectStep;b[c]=~b[c]+1;c=n.effectStep+n.source2&n.waveLen-1;c+=l;b[c]=~b[c]+1;++n.effectStep>=n.waveLen&&(n.effectStep=0);break;case 15:c=l;for(e=
0;127>e;++e)s=b[l],s+=b[l+1],b[l++]=s>>1;l=c;n.effectStep++;if(n.effectStep==n.source2){n.effectStep=0;c=s=l;for(e=0;64>e;++e)b[c++]=b[l++],l++;c=l=s;c+=64;for(e=0;64>e;++e)b[c++]=b[l++]}}}else a=3>d?q.channel:this.mixChannel;q.volumeCtr&&(q.volumeCtr--,0==q.volumeCtr&&(q.volumeCtr=n.volumeSpeed,q.volumeStep=++q.volumeStep&127,q.volumeStep||n.volumeLoop?(c=q.volumeStep+(n.volume<<7),s=~(b[c]+129)+1,q.volume=(s&255)>>2,a.volume=q.volume):q.volumeCtr=0));s=q.note;n.arpeggio&&(c=q.arpeggioStep+(n.arpeggio<<
5),s+=this.arpeggios[c],q.arpeggioStep=++q.arpeggioStep&31);c=s+q.step.transpose+n.finetune;q.finalPeriod=t[c];l=q.finalPeriod;if(1==q.val1||12==q.val1)s=~q.val2+1,q.portamento+=s,q.finalPeriod+=q.portamento,q.val2&&(0>s&&q.finalPeriod<=q.period||0<=s&&q.finalPeriod>=q.period)&&(q.portamento=q.period-l,q.val2=0);n.pitch&&(q.pitchCtr?q.pitchCtr--:(c=q.pitchStep,q.pitchStep=++q.pitchStep&127,0==q.pitchStep&&(q.pitchStep=n.pitchLoop),c+=n.pitch<<7,s=b[c],q.finalPeriod+=~s+1));a.period=q.finalPeriod}if(4<
this.numChannels){h=this.buffer1;this.buffer1=this.buffer2;this.buffer2=h;a=this.mixer.channels[3];a.pointer=h;for(d=3;7>d;++d)q=this.voices[d],q.mixStep=0,125>q.finalPeriod?(q.mixMute=1,q.mixSpeed=0):(e=(q.finalPeriod<<8)/this.mixPeriod&65535,g=(256/e&255)<<8,l=256%e<<8&16777215,q.mixSpeed=(g|l/e&255)<<8),q.mixVolume=q.mixMute?0:q.volume<<8;for(d=0;350>d;++d){l=0;for(e=3;7>e;++e)q=this.voices[e],g=(b[q.mixPtr+(q.mixStep>>16)]&255)+q.mixVolume,l+=this.volumes[g],q.mixStep+=q.mixSpeed;b[h++]=this.averages[l]}a.length=
350;a.period=this.mixPeriod;a.volume=64}if(0==--this.tick){if(this.tick=this.speed&15,this.speed=(this.speed&240)>>4,this.speed|=this.tick<<4,this.patternEnd=1,this.patternPos++,64==this.patternPos||this.patternPos==this.patternLen)this.patternPos=0,this.stepEnd=1,this.trackPos+=4,this.trackPos==this.song1.length&&(this.trackPos=this.song1.loopStep,this.mixer.complete=1)}else this.stepEnd=this.patternEnd=0;for(d=0;d<this.numChannels;++d)q=this.voices[d],q.mixPtr+=q.mixStep>>16,n=q.sample,n.effectDone=
0,q.mixPtr>=q.mixEnd&&(n.loop?q.mixPtr-=n.repeat:(q.mixPtr=0,q.mixMute=1)),4>d&&(a=q.channel,a.enabled=1)}},tables:{value:function(){var a=0,d,m,c=0,e=0,f,b,k=128;this.averages=new Int32Array(1024);this.volumes=new Int32Array(16384);for(this.mixPeriod=203;1024>a;++a)127<k&&(k-=256),this.averages[a]=k,383<a&&639>a&&(k=++k&255);for(a=0;64>a;++a){f=-128;b=128;for(m=0;256>m;++m)k=f*e/63+128,d=c+b,this.volumes[d]=k&255,0!=a&&63!=a&&128<=b&&--this.volumes[d],f++,b=++b&255;c+=256;e++}}}});d.voices[0]=g();
d.voices[1]=g();d.voices[2]=g();d.voices[3]=g();d.voices[4]=g();d.voices[5]=g();d.voices[6]=g();d.arpeggios=new Uint8Array(256);d.tables();return Object.seal(d)}})();(function(){function g(t,d){return Object.create(null,{index:{value:t,writable:!0},bitFlag:{value:d,writable:!0},next:{value:null,writable:!0},channel:{value:null,writable:!0},sample:{value:null,writable:!0},trackPtr:{value:0,writable:!0},trackPos:{value:0,writable:!0},patternPos:{value:0,writable:!0},frqseqPtr:{value:0,writable:!0},
frqseqPos:{value:0,writable:!0},volseqPtr:{value:0,writable:!0},volseqPos:{value:0,writable:!0},volseqSpeed:{value:0,writable:!0},volseqCounter:{value:0,writable:!0},halve:{value:0,writable:!0},speed:{value:0,writable:!0},tick:{value:0,writable:!0},busy:{value:0,writable:!0},flags:{value:0,writable:!0},note:{value:0,writable:!0},period:{value:0,writable:!0},transpose:{value:0,writable:!0},portaDelay:{value:0,writable:!0},portaDelta:{value:0,writable:!0},portaSpeed:{value:0,writable:!0},vibrato:{value:0,
writable:!0},vibratoDelta:{value:0,writable:!0},vibratoSpeed:{value:0,writable:!0},vibratoDepth:{value:0,writable:!0},initialize:{value:function(){this.sample=this.channel=null;this.speed=this.halve=this.volseqCounter=this.volseqSpeed=this.volseqPos=this.volseqPtr=this.frqseqPos=this.frqseqPtr=this.patternPos=this.trackPos=this.trackPtr=0;this.tick=1;this.busy=-1;this.vibratoDepth=this.vibratoSpeed=this.vibratoDelta=this.vibrato=this.portaSpeed=this.portaDelta=this.portaDelay=this.transpose=this.period=
this.note=this.flags=0}}})}window.neoart.DWPlayer=function(t){t=B(t);Object.defineProperties(t,{id:{value:"DWPlayer"},songs:{value:[],writable:!0},samples:{value:[],writable:!0},stream:{value:null,writable:!0},song:{value:null,writable:!0},songvol:{value:0,writable:!0},master:{value:0,writable:!0},periods:{value:0,writable:!0},frqseqs:{value:0,writable:!0},volseqs:{value:0,writable:!0},transpose:{value:0,writable:!0},slower:{value:0,writable:!0},slowerCounter:{value:0,writable:!0},delaySpeed:{value:0,
writable:!0},delayCounter:{value:0,writable:!0},fadeSpeed:{value:0,writable:!0},fadeCounter:{value:0,writable:!0},wave:{value:null,writable:!0},waveCenter:{value:0,writable:!0},waveLo:{value:0,writable:!0},waveHi:{value:0,writable:!0},waveDir:{value:0,writable:!0},waveLen:{value:0,writable:!0},wavePos:{value:0,writable:!0},waveRateNeg:{value:0,writable:!0},waveRatePos:{value:0,writable:!0},voices:{value:[],writable:!0},active:{value:0,writable:!0},complete:{value:0,writable:!0},variant:{value:0,writable:!0},
base:{value:0,writable:!0},com2:{value:0,writable:!0},com3:{value:0,writable:!0},com4:{value:0,writable:!0},readMix:{value:"",writable:!0},readLen:{value:0,writable:!0},initialize:{value:function(){var d,a,l=this.voices[this.active];this.reset();this.song=this.songs[this.playSong];this.songvol=this.master;this.speed=this.song.speed;this.transpose=0;this.slowerCounter=6;this.delaySpeed=this.song.delay;this.fadeCounter=this.fadeSpeed=this.delayCounter=0;if(this.wave){this.waveDir=0;this.wavePos=this.wave.pointer+
this.waveCenter;d=this.wave.pointer;for(a=this.wavePos;d<a;++d)this.mixer.memory[d]=this.waveRateNeg;for(a+=this.waveCenter;d<a;++d)this.mixer.memory[d]=this.waveRatePos}for(;l;)l.initialize(),l.channel=this.mixer.channels[l.index],l.sample=this.samples[0],this.complete+=l.bitFlag,l.trackPtr=this.song.tracks[l.index],l.trackPos=this.readLen,this.stream.position=l.trackPtr,l.patternPos=this.base+this.stream[this.readMix](),this.frqseqs&&(this.stream.position=this.frqseqs,l.frqseqPtr=this.base+this.stream.readUshort(),
l.frqseqPos=l.frqseqPtr),l=l.next}},loader:{value:function(d){var a,l,m,c,e,f,b=10,k,h;this.master=64;this.readMix="readUshort";this.readLen=2;this.variant=0;if(18663==d.readUshort()){d.position=4;if(24832!=d.readUshort())return;d.position+=d.readUshort();this.variant=30}else d.position=0;for(;20085!=h;){h=d.readUshort();switch(h){case 18426:this.base=d.position+d.readShort();break;case 24832:d.position+=2;e=d.position;24832==d.readUshort()&&(e=d.position+d.readUshort());break;case 49404:b=d.readUshort();
18==b?(this.readMix="readUint",this.readLen=4):this.variant=10;16890==d.readUshort()&&(l=d.position+d.readUshort());4656==d.readUshort()&&(a=1);break;case 4656:d.position-=6;16890==d.readUshort()&&(l=d.position+d.readUshort(),a=1);d.position+=4;break;case 48764:this.channels=d.readUshort(),d.position+=2,14204==d.readUshort()&&(this.master=d.readUshort())}if(20>d.bytesAvailable)return}c=d.position;this.songs=[];f=2147483647;k=0;for(d.position=l;;){l=Object.create(null,{speed:{value:0,writable:!0},
delay:{value:0,writable:!0},tracks:{value:null,writable:!0}});l.tracks=new Uint32Array(this.channels);a?(l.speed=d.readUbyte(),l.delay=d.readUbyte()):l.speed=d.readUshort();if(255<l.speed)break;for(m=0;m<this.channels;++m)h=this.base+d[this.readMix](),h<f&&(f=h),l.tracks[m]=h;this.songs[k++]=l;if(f-d.position<b)break}if(k&&(this.lastSong=this.songs.length-1,d.position=e,18987==d.readUshort())){l=b=0;for(this.wave=null;20085!=h;)switch(h=d.readUshort(),h){case 19450:if(l)break;e=d.position+d.readShort();
d.position++;k=d.readUbyte();d.position-=10;h=d.readUshort();a=d.position;16890==h||8314==h?l=d.position+d.readUshort():53500==h&&(l=64+d.readUshort(),d.position-=18,l+=d.position+d.readUshort());d.position=a;break;case 33987:if(b)break;d.position+=4;h=d.readUshort();56060==h?b=d.readUshort():56316==h&&(b=d.readUint());12==b&&30>this.variant&&(this.variant=20);a=d.position;this.samples=[];this.samples.length=++k;d.position=l;for(m=0;m<k;++m)h=A(),Object.defineProperties(h,{relative:{value:0,writable:!0},
finetune:{value:0,writable:!0}}),f=Object.seal(h),f.length=d.readUint(),f.relative=parseInt(3579545/d.readUshort()),f.pointer=this.mixer.store(d,f.length),h=d.position,d.position=e+m*b+4,f.loopPtr=d.readInt(),0==this.variant?(d.position+=6,f.volume=d.readUshort()):10==this.variant&&(d.position+=4,f.volume=d.readUshort(),f.finetune=d.readByte()),d.position=h,this.samples[m]=f;this.mixer.loopLen=64;d.length=l;d.position=a;break;case 8314:h=d.position+d.readShort();if(12860!=d.readUshort()){d.position-=
2;break}this.wave=this.samples[parseInt((h-e)/b)];this.waveCenter=d.readUshort()+1<<1;d.position+=2;this.waveRateNeg=d.readByte();d.position+=12;this.waveRatePos=d.readByte();break;case 1131:case 1643:k=d.readUshort(),f=this.samples[parseInt((d.readUshort()-e)/b)],f.relative=1643==h?f.relative+k:f.relative-k}if(this.samples.length){d.position=c;this.slower=this.volseqs=this.frqseqs=this.periods=0;this.com2=176;this.com3=160;for(this.com4=144;16<d.bytesAvailable;)switch(h=d.readUshort(),h){case 18426:d.position+=
2;if(18987!=d.readUshort())break;a=d.position;d.position+=4;h=d.readUshort();if(4154==h){if(d.position+=4,49404==d.readUshort()){h=d.readUshort();k=this.songs.length;for(m=0;m<k;++m)this.songs[m].delay*=h;d.position+=6}}else 21291==h&&(d.position-=8);h=d.readUshort();18987==h&&(d.position=this.base+d.readUshort(),this.slower=d.readByte());d.position=a;break;case 3179:d.position-=6;h=d.readUshort();if(21611==h||21099==h)d.position+=4,this.waveHi=this.wave.pointer+d.readUshort();else if(21867==h||21355==
h)d.position+=4,this.waveLo=this.wave.pointer+d.readUshort();this.waveLen=21611>h?1:2;break;case 32256:case 32257:case 32258:case 32259:this.active=h&15;k=this.channels-1;if(this.active)for(this.voices[0].next=null,m=k;0<m;)this.voices[m].next=this.voices[--m];else for(this.voices[k].next=null,m=0;m<k;)this.voices[m].next=this.voices[++m];break;case 3176:d.position+=22;3089==d.readUshort()&&(this.variant=40);break;case 12845:a=d.position;h=d.readUshort();if(10==h||12==h)d.position-=8,17914==d.readUshort()&&
(this.periods=d.position+d.readUshort());d.position=a+2;break;case 1024:case 1088:case 1536:h=d.readUshort();192==h||64==h?(this.com2=192,this.com3=176,this.com4=160):h==this.com3?(d.position+=2,17914==d.readUshort()&&(this.volseqs=d.position+d.readUshort(),40>this.variant&&(this.variant=30))):h==this.com4&&(d.position+=2,17914==d.readUshort()&&(this.frqseqs=d.position+d.readUshort()));break;case 20211:d.position+=2;case 20178:f=d.position,d.position-=10,d.position+=d.readUshort(),a=d.position,d.position=
a+2,d.position=this.base+d.readUshort()+10,18964==d.readUshort()&&(this.variant=41),d.position=a+16,h=this.base+d.readUshort(),h>f&&h<a&&(d.position=h,h=d.readUshort(),20712==h?this.variant=21:5977==h&&(this.variant=11)),d.position=a+20,h=this.base+d.readUshort(),h>f&&h<a&&(d.position=h+2,18560!=d.readUshort()&&(this.variant=31)),d.position=a+26,h=d.readUshort(),h>f&&h<a&&(this.variant=32),this.frqseqs&&(d.position=d.length)}this.periods&&(this.com2-=256,this.com3-=256,this.com4-=256,this.stream=
d,this.version=1)}}}},process:{value:function(){var d,a,l,m,c,e=this.voices[this.active];if(this.slower&&0==--this.slowerCounter)this.slowerCounter=6;else if(255<(this.delayCounter+=this.delaySpeed))this.delayCounter-=256;else{if(this.fadeSpeed&&(0==--this.fadeCounter&&(this.fadeCounter=this.fadeSpeed,this.songvol--),!this.songvol))if(this.loopSong)this.initialize();else{this.mixer.complete=1;return}this.wave&&(this.waveDir?(this.mixer.memory[this.wavePos++]=this.waveRatePos,1<this.waveLen&&(this.mixer.memory[this.wavePos++]=
this.waveRatePos),(this.wavePos-=this.waveLen<<1)==this.waveLo&&(this.waveDir=0)):(this.mixer.memory[this.wavePos++]=this.waveRateNeg,1<this.waveLen&&(this.mixer.memory[this.wavePos++]=this.waveRateNeg),this.wavePos==this.waveHi&&(this.waveDir=1)));for(;e;){d=e.channel;this.stream.position=e.patternPos;m=e.sample;e.busy||(e.busy=1,0>m.loopPtr?(d.pointer=this.mixer.loopPtr,d.length=this.mixer.loopLen):(d.pointer=m.pointer+m.loopPtr,d.length=m.length-m.loopPtr));if(0==--e.tick)for(e.flags=0,a=1;0<a;)if(c=
this.stream.readByte(),0>c)if(-32<=c)e.speed=this.speed*(c+33);else if(c>=this.com2)c-=this.com2,e.sample=m=this.samples[c];else if(c>=this.com3)l=this.stream.position,this.stream.position=this.volseqs+(c-this.com3<<1),this.stream.position=this.base+this.stream.readUshort(),e.volseqPtr=this.stream.position,this.stream.position--,e.volseqSpeed=this.stream.readUbyte(),this.stream.position=l;else if(c>=this.com4)l=this.stream.position,this.stream.position=this.frqseqs+(c-this.com4<<1),e.frqseqPtr=this.base+
this.stream.readUshort(),e.frqseqPos=e.frqseqPtr,this.stream.position=l;else switch(c){case -128:this.stream.position=e.trackPtr+e.trackPos;(c=this.stream[this.readMix]())?(this.stream.position=this.base+c,e.trackPos+=this.readLen):(this.stream.position=e.trackPtr,this.stream.position=this.base+this.stream[this.readMix](),e.trackPos=this.readLen,this.loopSong||(this.complete&=~e.bitFlag,this.complete||(this.mixer.complete=1)));break;case -127:0<this.variant&&(e.portaDelta=0);e.portaSpeed=this.stream.readByte();
e.portaDelay=this.stream.readUbyte();e.flags|=2;break;case -126:e.tick=e.speed;e.patternPos=this.stream.position;41==this.variant?(e.busy=1,d.enabled=0):(d.pointer=this.mixer.loopPtr,d.length=this.mixer.loopLen);a=0;break;case -125:0<this.variant&&(e.tick=e.speed,e.patternPos=this.stream.position,d.enabled=1,a=0);break;case -124:this.mixer.complete=1;break;case -123:0<this.variant&&(this.transpose=this.stream.readByte());break;case -122:e.vibrato=-1;e.vibratoSpeed=this.stream.readUbyte();e.vibratoDepth=
this.stream.readUbyte();e.vibratoDelta=0;break;case -121:e.vibrato=0;break;case -120:21==this.variant?e.halve=1:11==this.variant?this.fadeSpeed=this.stream.readUbyte():e.transpose=this.stream.readByte();break;case -119:21==this.variant?e.halve=0:(e.trackPtr=this.base+this.stream.readUshort(),e.trackPos=0);break;case -118:31==this.variant?this.delaySpeed=this.stream.readUbyte():this.speed=this.stream.readUbyte();break;case -117:this.fadeCounter=this.fadeSpeed=this.stream.readUbyte();break;case -116:c=
this.stream.readUbyte(),32!=this.variant&&(this.songvol=c)}else e.patternPos=this.stream.position,e.note=c+=m.finetune,e.tick=e.speed,e.busy=0,20<=this.variant?(c=c+this.transpose+e.transpose&255,this.stream.position=e.volseqPtr,a=this.stream.readUbyte(),e.volseqPos=this.stream.position,e.volseqCounter=e.volseqSpeed,e.halve&&(a>>=1),a=a*this.songvol>>6):a=m.volume,d.pointer=m.pointer,d.length=m.length,d.volume=a,this.stream.position=this.periods+(c<<1),c=this.stream.readUshort()*m.relative>>10,10>
this.variant&&(e.portaDelta=c),d.period=c,d.enabled=1,a=0;else 1==e.tick?30>this.variant?d.enabled=0:(c=this.stream.readUbyte(),131!=c&&(40>this.variant||224>c||131!=this.stream.readUbyte())&&(d.enabled=0)):0==this.variant?e.flags&2&&(e.portaDelay?e.portaDelay--:(e.portaDelta-=e.portaSpeed,d.period=e.portaDelta)):(this.stream.position=e.frqseqPos,c=this.stream.readByte(),0>c&&(c&=127,this.stream.position=e.frqseqPtr),e.frqseqPos=this.stream.position,c=c+e.note+this.transpose+e.transpose&255,this.stream.position=
this.periods+(c<<1),c=this.stream.readUshort()*m.relative>>10,e.flags&2&&(e.portaDelay?e.portaDelay--:(e.portaDelta+=e.portaSpeed,c-=e.portaDelta)),e.vibrato&&(0<e.vibrato?(e.vibratoDelta-=e.vibratoSpeed,e.vibratoDelta||(e.vibrato^=2147483648)):(e.vibratoDelta+=e.vibratoSpeed,e.vibratoDelta==e.vibratoDepth&&(e.vibrato^=2147483648)),e.vibratoDelta||(e.vibrato^=1),c=e.vibrato&1?c+e.vibratoDelta:c-e.vibratoDelta),d.period=c,20<=this.variant&&0>--e.volseqCounter&&(this.stream.position=e.volseqPos,a=this.stream.readByte(),
0<=a&&(e.volseqPos=this.stream.position),e.volseqCounter=e.volseqSpeed,a&=127,e.halve&&(a>>=1),d.volume=a*this.songvol>>6));e=e.next}}}}});t.voices[0]=g(0,1);t.voices[1]=g(1,2);t.voices[2]=g(2,4);t.voices[3]=g(3,8);return Object.seal(t)}})();(function(){function p(a){return Object.create(null,{index:{value:a,writable:!0},next:{value:null,writable:!0},channel:{value:null,writable:!0},sample:{value:null,writable:!0},enabled:{value:0,writable:!0},pattern:{value:0,writable:!0},soundTranspose:{value:0,
writable:!0},transpose:{value:0,writable:!0},patStep:{value:0,writable:!0},frqStep:{value:0,writable:!0},frqPos:{value:0,writable:!0},frqSustain:{value:0,writable:!0},frqTranspose:{value:0,writable:!0},volStep:{value:0,writable:!0},volPos:{value:0,writable:!0},volCtr:{value:0,writable:!0},volSpeed:{value:0,writable:!0},volSustain:{value:0,writable:!0},note:{value:0,writable:!0},pitch:{value:0,writable:!0},volume:{value:0,writable:!0},pitchBendFlag:{value:0,writable:!0},pitchBendSpeed:{value:0,writable:!0},
pitchBendTime:{value:0,writable:!0},portamentoFlag:{value:0,writable:!0},portamento:{value:0,writable:!0},volBendFlag:{value:0,writable:!0},volBendSpeed:{value:0,writable:!0},volBendTime:{value:0,writable:!0},vibratoFlag:{value:0,writable:!0},vibratoSpeed:{value:0,writable:!0},vibratoDepth:{value:0,writable:!0},vibratoDelay:{value:0,writable:!0},vibrato:{value:0,writable:!0},initialize:{value:function(){this.sample=null;this.volPos=this.volStep=this.frqTranspose=this.frqSustain=this.frqPos=this.frqStep=
this.patStep=this.transpose=this.soundTranspose=this.pattern=this.enabled=0;this.volSpeed=this.volCtr=1;this.vibrato=this.vibratoDelay=this.vibratoDepth=this.vibratoSpeed=this.vibratoFlag=this.volBendTime=this.volBendSpeed=this.volBendFlag=this.portamento=this.portamentoFlag=this.pitchBendTime=this.pitchBendSpeed=this.pitchBendFlag=this.volume=this.pitch=this.note=this.volSustain=0}},volumeBend:{value:function(){if(this.volBendFlag^=1)if(this.volBendTime--,this.volume+=this.volBendSpeed,0>this.volume||
64<this.volume)this.volBendTime=0}}})}var t=[1712,1616,1524,1440,1356,1280,1208,1140,1076,1016,960,906,856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,113,113,113,113,113,113,113,113,113,113,113,113,113,3424,3232,3048,2880,2712,2560,2416,2280,2152,2032,1920,1812,1712,1616,1524,1440,1356,1280,1208,1140,1076,1016,960,906,856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,
240,226,214,202,190,180,170,160,151,143,135,127,120,113,113,113,113,113,113,113,113,113,113,113,113,113],d=[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,8,8,8,8,8,8,8,8,16,8,16,16,8,8,24,-64,-64,-48,-40,-32,-24,-16,-8,0,-8,-16,-24,-32,-40,-48,-56,63,55,47,39,31,23,15,7,-1,7,15,23,31,39,47,55,-64,-64,-48,-40,-32,-24,-16,-8,0,-8,-16,-24,-32,-40,-48,-56,-64,55,47,39,31,23,15,7,-1,7,15,23,31,39,47,55,-64,-64,-48,-40,-32,-24,-16,-8,0,-8,-16,-24,-32,-40,
-48,-56,-64,-72,47,39,31,23,15,7,-1,7,15,23,31,39,47,55,-64,-64,-48,-40,-32,-24,-16,-8,0,-8,-16,-24,-32,-40,-48,-56,-64,-72,-80,39,31,23,15,7,-1,7,15,23,31,39,47,55,-64,-64,-48,-40,-32,-24,-16,-8,0,-8,-16,-24,-32,-40,-48,-56,-64,-72,-80,-88,31,23,15,7,-1,7,15,23,31,39,47,55,-64,-64,-48,-40,-32,-24,-16,-8,0,-8,-16,-24,-32,-40,-48,-56,-64,-72,-80,-88,-96,23,15,7,-1,7,15,23,31,39,47,55,-64,-64,-48,-40,-32,-24,-16,-8,0,-8,-16,-24,-32,-40,-48,-56,-64,-72,-80,-88,-96,-104,15,7,-1,7,15,23,31,39,47,55,-64,
-64,-48,-40,-32,-24,-16,-8,0,-8,-16,-24,-32,-40,-48,-56,-64,-72,-80,-88,-96,-104,-112,7,-1,7,15,23,31,39,47,55,-64,-64,-48,-40,-32,-24,-16,-8,0,-8,-16,-24,-32,-40,-48,-56,-64,-72,-80,-88,-96,-104,-112,-120,-1,7,15,23,31,39,47,55,-64,-64,-48,-40,-32,-24,-16,-8,0,-8,-16,-24,-32,-40,-48,-56,-64,-72,-80,-88,-96,-104,-112,-120,-128,7,15,23,31,39,47,55,-64,-64,-48,-40,-32,-24,-16,-8,0,-8,-16,-24,-32,-40,-48,-56,-64,-72,-80,-88,-96,-104,-112,-120,-128,-120,15,23,31,39,47,55,-64,-64,-48,-40,-32,-24,-16,-8,
0,-8,-16,-24,-32,-40,-48,-56,-64,-72,-80,-88,-96,-104,-112,-120,-128,-120,-112,23,31,39,47,55,-64,-64,-48,-40,-32,-24,-16,-8,0,-8,-16,-24,-32,-40,-48,-56,-64,-72,-80,-88,-96,-104,-112,-120,-128,-120,-112,-104,31,39,47,55,-64,-64,-48,-40,-32,-24,-16,-8,0,-8,-16,-24,-32,-40,-48,-56,-64,-72,-80,-88,-96,-104,-112,-120,-128,-120,-112,-104,-96,39,47,55,-64,-64,-48,-40,-32,-24,-16,-8,0,-8,-16,-24,-32,-40,-48,-56,-64,-72,-80,-88,-96,-104,-112,-120,-128,-120,-112,-104,-96,-88,47,55,-64,-64,-48,-40,-32,-24,
-16,-8,0,-8,-16,-24,-32,-40,-48,-56,-64,-72,-80,-88,-96,-104,-112,-120,-128,-120,-112,-104,-96,-88,-80,55,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,127,127,127,127,
127,127,127,127,127,127,127,127,127,127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,127,127,127,127,127,127,127,127,127,127,127,127,127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,127,127,127,127,127,127,127,127,127,127,127,127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,127,127,127,127,127,127,127,127,127,127,127,-127,-127,-127,-127,
-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,127,127,127,127,127,127,127,127,127,127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,127,127,127,127,127,127,127,127,127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,127,127,127,127,127,127,127,127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,
-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,127,127,127,127,127,127,127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,127,127,127,127,127,127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,127,127,127,127,127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,
-127,-127,-127,-127,-127,-127,127,127,127,127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,-127,127,127,127,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,127,127,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,-128,
-128,-128,-128,127,-128,-128,-128,-128,-128,-128,-128,-128,127,127,127,127,127,127,127,127,-128,-128,-128,-128,-128,-128,-128,127,127,127,127,127,127,127,127,127,-128,-128,-128,-128,-128,-128,127,127,127,127,127,127,127,127,127,127,-128,-128,-128,-128,-128,127,127,127,127,127,127,127,127,127,127,127,-128,-128,-128,-128,127,127,127,127,127,127,127,127,127,127,127,127,-128,-128,-128,127,127,127,127,127,127,127,127,127,127,127,127,127,-128,-128,127,127,127,127,127,127,127,127,127,127,127,127,127,127,
-128,-128,127,127,127,127,127,127,127,127,127,127,127,127,127,127,-128,-128,-112,-104,-96,-88,-80,-72,-64,-56,-48,-40,-32,-24,-16,-8,0,8,16,24,32,40,48,56,64,72,80,88,96,104,112,127,-128,-128,-96,-80,-64,-48,-32,-16,0,16,32,48,64,80,96,112,69,69,121,125,122,119,112,102,97,88,83,77,44,32,24,18,4,-37,-45,-51,-58,-68,-75,-82,-88,-93,-99,-103,-109,-114,-117,-118,69,69,121,125,122,119,112,102,91,75,67,55,44,32,24,18,4,-8,-24,-37,-49,-58,-66,-80,-88,-92,-98,-102,-107,-108,-115,-125,0,0,64,96,127,96,64,
32,0,-32,-64,-96,-128,-96,-64,-32,0,0,64,96,127,96,64,32,0,-32,-64,-96,-128,-96,-64,-32,-128,-128,-112,-104,-96,-88,-80,-72,-64,-56,-48,-40,-32,-24,-16,-8,0,8,16,24,32,40,48,56,64,72,80,88,96,104,112,127,-128,-128,-96,-80,-64,-48,-32,-16,0,16,32,48,64,80,96,112];window.neoart.FCPlayer=function(a){a=B(a);Object.defineProperties(a,{id:{value:"FCPlayer"},seqs:{value:null,writable:!0},pats:{value:null,writable:!0},vols:{value:null,writable:!0},frqs:{value:null,writable:!0},length:{value:0,writable:!0},
samples:{value:[],writable:!0},voices:{value:[],writable:!0},initialize:{value:function(){var a=this.voices[0];this.reset();this.seqs.position=0;this.pats.position=0;this.vols.position=0;for(this.frqs.position=0;a;)a.initialize(),a.channel=this.mixer.channels[a.index],a.pattern=this.seqs.readUbyte()<<6,a.transpose=this.seqs.readByte(),a.soundTranspose=this.seqs.readByte(),a=a.next;this.speed=this.seqs.readUbyte();this.speed||(this.speed=3);this.tick=this.speed}},loader:{value:function(a){var m,c,
e,f,b,k,h,z,n;c=a.readString(4);if("SMOD"==c)this.version=1;else if("FC14"==c)this.version=2;else return;a.position=4;this.length=a.readUint();a.position=1==this.version?100:180;this.seqs=g(new ArrayBuffer(this.length));a.readBytes(this.seqs,0,this.length);this.length=this.length/13>>0;a.position=12;e=a.readUint();a.position=8;a.position=a.readUint();this.pats=g(new ArrayBuffer(e+1));a.readBytes(this.pats,0,e);a.position=20;e=a.readUint();a.position=16;a.position=a.readUint();this.frqs=g(new ArrayBuffer(e+
9));this.frqs.writeInt(16777216);this.frqs.writeInt(225);a.readBytes(this.frqs,8,e);this.frqs.position=this.frqs.length-1;this.frqs.writeByte(225);this.frqs.position=0;a.position=28;e=a.readUint();a.position=24;a.position=a.readUint();this.vols=g(new ArrayBuffer(e+8));this.vols.writeInt(16777216);this.vols.writeInt(225);a.readBytes(this.vols,8,e);a.position=32;h=a.readUint();a.position=40;1==this.version?(this.samples.length=57,f=0):(this.samples.length=200,f=2);for(m=0;10>m;++m)if(e=a.readUshort()<<
1,0<e)if(b=a.position,a.position=h,c=a.readString(4),"SSMP"==c){z=e;for(c=0;10>c;++c)a.readInt(),e=a.readUshort()<<1,0<e?(k=A(),k.length=e+2,k.loop=a.readUshort(),k.repeat=a.readUshort()<<1,k.loop+k.repeat>k.length&&(k.repeat=k.length-k.loop),h+k.length>a.length&&(k.length=a.length-h),k.pointer=this.mixer.store(a,k.length,h+n),k.loopPtr=k.pointer+k.loop,this.samples[100+10*m+c]=k,n+=k.length,a.position+=6):a.position+=10;h+=z+2;a.position=b+4}else a.position=b,k=A(),k.length=e+f,k.loop=a.readUshort(),
k.repeat=a.readUshort()<<1,k.loop+k.repeat>k.length&&(k.repeat=k.length-k.loop),h+k.length>a.length&&(k.length=a.length-h),k.pointer=this.mixer.store(a,k.length,h),k.loopPtr=k.pointer+k.loop,this.samples[m]=k,h+=k.length;else a.position+=4;if(1==this.version)for(f=0,z=47,m=10;57>m;++m)for(k=A(),k.length=d[f++]<<1,k.loop=0,k.repeat=k.length,b=this.mixer.memory.length,k.pointer=b,k.loopPtr=b,this.samples[m]=k,e=b+k.length,c=b;c<e;++c)this.mixer.memory[c]=d[z++];else for(a.position=36,h=a.readUint(),
a.position=100,m=10;90>m;++m)e=a.readUbyte()<<1,2>e||(k=A(),k.length=e,k.loop=0,k.repeat=k.length,h+k.length>a.length&&(k.length=a.length-h),k.pointer=this.mixer.store(a,k.length,h),k.loopPtr=k.pointer,this.samples[m]=k,h+=k.length);this.length*=13}},process:{value:function(){var a,d,c,e,f,b=this.voices[0];if(0==--this.tick){for(a=this.seqs.position;b;){d=b.channel;this.pats.position=b.pattern+b.patStep;f=this.pats.readUbyte();if(64<=b.patStep||73==f)this.seqs.position==this.length&&(this.seqs.position=
0,this.mixer.complete=1),b.patStep=0,b.pattern=this.seqs.readUbyte()<<6,b.transpose=this.seqs.readByte(),b.soundTranspose=this.seqs.readByte(),this.pats.position=b.pattern,f=this.pats.readUbyte();c=this.pats.readUbyte();this.frqs.position=0;this.vols.position=0;0!=f&&(b.note=f&127,b.pitch=0,b.portamento=0,b.enabled=d.enabled=0,f=8+((c&63)+b.soundTranspose<<6),0<=f&&f<this.vols.length&&(this.vols.position=f),b.volStep=0,b.volSpeed=b.volCtr=this.vols.readUbyte(),b.volSustain=0,b.frqPos=8+(this.vols.readUbyte()<<
6),b.frqStep=0,b.frqSustain=0,b.vibratoFlag=0,b.vibratoSpeed=this.vols.readUbyte(),b.vibratoDepth=b.vibrato=this.vols.readUbyte(),b.vibratoDelay=this.vols.readUbyte(),b.volPos=this.vols.position);c&64?b.portamento=0:c&128&&(b.portamento=this.pats[this.pats.position+1],1==this.version&&(b.portamento<<=1));b.patStep+=2;b=b.next}this.seqs.position!=a&&(f=this.seqs.readUbyte())&&(this.speed=f);this.tick=this.speed}for(b=this.voices[0];b;){d=b.channel;do{a=0;if(b.frqSustain){b.frqSustain--;break}this.frqs.position=
b.frqPos+b.frqStep;do{e=0;if(!this.frqs.bytesAvailable)break;c=this.frqs.readUbyte();if(225==c)break;224==c&&(b.frqStep=this.frqs.readUbyte()&63,this.frqs.position=b.frqPos+b.frqStep,c=this.frqs.readUbyte());switch(c){case 226:d.enabled=0,b.enabled=1,b.volCtr=1,b.volStep=0;case 228:(c=this.samples[this.frqs.readUbyte()])?(d.pointer=c.pointer,d.length=c.length):b.enabled=0;b.sample=c;b.frqStep+=2;break;case 233:f=100+10*this.frqs.readUbyte();if(c=this.samples[f+this.frqs.readUbyte()])d.enabled=0,d.pointer=
c.pointer,d.length=c.length,b.enabled=1;b.sample=c;b.volCtr=1;b.volStep=0;b.frqStep+=3;break;case 231:e=1;b.frqPos=8+(this.frqs.readUbyte()<<6);b.frqPos>=this.frqs.length&&(b.frqPos=0);b.frqStep=0;this.frqs.position=b.frqPos;break;case 234:b.pitchBendSpeed=this.frqs.readByte();b.pitchBendTime=this.frqs.readUbyte();b.frqStep+=3;break;case 232:a=1;b.frqSustain=this.frqs.readUbyte();b.frqStep+=2;break;case 227:b.vibratoSpeed=this.frqs.readUbyte(),b.vibratoDepth=this.frqs.readUbyte(),b.frqStep+=3}a||
e||(this.frqs.position=b.frqPos+b.frqStep,b.frqTranspose=this.frqs.readByte(),b.frqStep++)}while(e)}while(a);if(b.volSustain)b.volSustain--;else if(b.volBendTime)b.volumeBend();else if(0==--b.volCtr){b.volCtr=b.volSpeed;do{e=0;this.vols.position=b.volPos+b.volStep;if(!this.vols.bytesAvailable)break;c=this.vols.readUbyte();if(225==c)break;switch(c){case 234:b.volBendSpeed=this.vols.readByte();b.volBendTime=this.vols.readUbyte();b.volStep+=3;b.volumeBend();break;case 232:b.volSustain=this.vols.readUbyte();
b.volStep+=2;break;case 224:e=1;f=this.vols.readUbyte()&63;b.volStep=f-5;break;default:b.volume=c,b.volStep++}}while(e)}c=b.frqTranspose;0<=c&&(c+=b.note+b.transpose);c&=127;e=t[c];if(b.vibratoDelay)b.vibratoDelay--;else{f=b.vibrato;b.vibratoFlag?(a=b.vibratoDepth<<1,f+=b.vibratoSpeed,f>a&&(f=a,b.vibratoFlag=0)):(f-=b.vibratoSpeed,0>f&&(f=0,b.vibratoFlag=1));b.vibrato=f;f-=b.vibratoDepth;for(a=(c<<1)+160;256>a;)f<<=1,a+=24;e+=f}b.portamentoFlag^=1;b.portamentoFlag&&b.portamento&&(b.pitch=31<b.portamento?
b.pitch+(b.portamento&31):b.pitch-b.portamento);b.pitchBendFlag^=1;b.pitchBendFlag&&b.pitchBendTime&&(b.pitchBendTime--,b.pitch-=b.pitchBendSpeed);e+=b.pitch;113>e?e=113:3424<e&&(e=3424);d.period=e;d.volume=b.volume;b.sample&&(c=b.sample,d.enabled=b.enabled,d.pointer=c.loopPtr,d.length=c.repeat);b=b.next}}}});a.voices[0]=p(0);a.voices[0].next=a.voices[1]=p(1);a.voices[1].next=a.voices[2]=p(2);a.voices[2].next=a.voices[3]=p(3);return Object.seal(a)}})();(function(){function p(d,a){return Object.create(null,
{index:{value:d,writable:!0},bitFlag:{value:a,writable:!0},next:{value:null,writable:!0},channel:{value:null,writable:!0},sample:{value:null,writable:!0},trackPos:{value:0,writable:!0},patternPos:{value:0,writable:!0},tick:{value:0,writable:!0},busy:{value:0,writable:!0},synth:{value:0,writable:!0},note:{value:0,writable:!0},period:{value:0,writable:!0},volume:{value:0,writable:!0},envelopePos:{value:0,writable:!0},sustainTime:{value:0,writable:!0},arpeggioPos:{value:0,writable:!0},arpeggioSpeed:{value:0,
writable:!0},portamento:{value:0,writable:!0},portaCounter:{value:0,writable:!0},portaDelay:{value:0,writable:!0},portaFlag:{value:0,writable:!0},portaLimit:{value:0,writable:!0},portaNote:{value:0,writable:!0},portaPeriod:{value:0,writable:!0},portaSpeed:{value:0,writable:!0},vibrato:{value:0,writable:!0},vibratoDelay:{value:0,writable:!0},vibratoDepth:{value:0,writable:!0},vibratoFlag:{value:0,writable:!0},vibratoSpeed:{value:0,writable:!0},pulseCounter:{value:0,writable:!0},pulseDelay:{value:0,
writable:!0},pulseDir:{value:0,writable:!0},pulsePos:{value:0,writable:!0},pulseSpeed:{value:0,writable:!0},blendCounter:{value:0,writable:!0},blendDelay:{value:0,writable:!0},blendDir:{value:0,writable:!0},blendPos:{value:0,writable:!0},initialize:{value:function(){this.sample=this.channel=null;this.patternPos=this.trackPos=0;this.busy=this.tick=1;this.blendPos=this.blendDir=this.blendDelay=this.blendCounter=this.pulseSpeed=this.pulsePos=this.pulseDir=this.pulseDelay=this.pulseCounter=this.vibratoSpeed=
this.vibratoFlag=this.vibratoDepth=this.vibratoDelay=this.vibrato=this.portaSpeed=this.portaPeriod=this.portaNote=this.portaLimit=this.portaFlag=this.portaDelay=this.portaCounter=this.portamento=this.arpeggioSpeed=this.arpeggioPos=this.sustainTime=this.envelopePos=this.volume=this.period=this.note=0}}})}var t=[8192,7728,7296,6888,6504,6136,5792,5464,5160,4872,4600,4336,4096,3864,3648,3444,3252,3068,2896,2732,2580,2436,2300,2168,2048,1932,1824,1722,1626,1534,1448,1366,1290,1218,1150,1084,1024,966,
912,861,813,767,724,683,645,609,575,542,512,483,456,430,406,383,362,341,322,304,287,271,256,241,228,215,203,191,181,170,161,152,143,135];window.neoart.FEPlayer=function(d){d=B(d);Object.defineProperties(d,{id:{value:"FEPlayer"},songs:{value:[],writable:!0},samples:{value:[],writable:!0},patterns:{value:null,writable:!0},song:{value:null,writable:!0},voices:{value:[],writable:!0},complete:{value:0,writable:!0},sampFlag:{value:0,writable:!0},initialize:{value:function(){var a,d,m=this.voices[3];this.reset();
this.song=this.songs[this.playSong];this.speed=this.song.speed;for(this.complete=15;m;){m.initialize();m.channel=this.mixer.channels[m.index];m.patternPos=this.song.tracks[m.index][0];a=m.synth;for(d=a+64;a<d;++a)this.mixer.memory[a]=0;m=m.next}}},loader:{value:function(a){for(var d,m,c,e,f,b,k,h,z,n;16>a.position;)if(k=a.readUshort(),a.position+=2,20218!=k)return;for(;1024>a.position;)if(k=a.readUshort(),4666==k)a.position+=2,k=a.readUshort(),45057==k&&(a.position-=4,m=a.position+a.readUshort()-
2197);else if(8522==k&&(a.position+=2,k=a.readUshort(),18426==k)){d=a.position+a.readShort();this.version=1;break}if(this.version){a.position=m+2210;b=a.readUint();a.position=d+b;this.samples=[];for(b=2147483647;b>a.position;){if(k=a.readUint()){if(k<a.position||k>=a.length){a.position-=4;break}k<b&&(b=d+k)}e=Object.create(null,{pointer:{value:0,writable:!0},loopPtr:{value:0,writable:!0},length:{value:0,writable:!0},relative:{value:0,writable:!0},type:{value:0,writable:!0},synchro:{value:0,writable:!0},
envelopeVol:{value:0,writable:!0},attackSpeed:{value:0,writable:!0},attackVol:{value:0,writable:!0},decaySpeed:{value:0,writable:!0},decayVol:{value:0,writable:!0},sustainTime:{value:0,writable:!0},releaseSpeed:{value:0,writable:!0},releaseVol:{value:0,writable:!0},arpeggio:{value:null,writable:!0},arpeggioLimit:{value:0,writable:!0},arpeggioSpeed:{value:0,writable:!0},vibratoDelay:{value:0,writable:!0},vibratoDepth:{value:0,writable:!0},vibratoSpeed:{value:0,writable:!0},pulseCounter:{value:0,writable:!0},
pulseDelay:{value:0,writable:!0},pulsePosL:{value:0,writable:!0},pulsePosH:{value:0,writable:!0},pulseSpeed:{value:0,writable:!0},pulseRateNeg:{value:0,writable:!0},pulseRatePos:{value:0,writable:!0},blendCounter:{value:0,writable:!0},blendDelay:{value:0,writable:!0},blendRate:{value:0,writable:!0}});e.pointer=k;e.loopPtr=a.readShort();e.length=a.readUshort()<<1;e.relative=a.readUshort();e.vibratoDelay=a.readUbyte();a.position++;e.vibratoSpeed=a.readUbyte();e.vibratoDepth=a.readUbyte();e.envelopeVol=
a.readUbyte();e.attackSpeed=a.readUbyte();e.attackVol=a.readUbyte();e.decaySpeed=a.readUbyte();e.decayVol=a.readUbyte();e.sustainTime=a.readUbyte();e.releaseSpeed=a.readUbyte();e.releaseVol=a.readUbyte();e.arpeggio=new Int8Array(16);for(c=0;16>c;++c)e.arpeggio[c]=a.readByte();e.arpeggioSpeed=a.readUbyte();e.type=a.readByte();e.pulseRateNeg=a.readByte();e.pulseRatePos=a.readUbyte();e.pulseSpeed=a.readUbyte();e.pulsePosL=a.readUbyte();e.pulsePosH=a.readUbyte();e.pulseDelay=a.readUbyte();e.synchro=a.readUbyte();
e.blendRate=a.readUbyte();e.blendDelay=a.readUbyte();e.pulseCounter=a.readUbyte();e.blendCounter=a.readUbyte();e.arpeggioLimit=a.readUbyte();a.position+=12;this.samples.push(e);if(!a.bytesAvailable)break}if(2147483647!=b)for(this.mixer.store(a,a.length-b),f=this.samples.length,c=0;c<f;++c)e=this.samples[c],e.pointer&&(e.pointer-=d+b);b=this.mixer.memory.length;this.mixer.memory.length+=256;this.mixer.loopLen=100;for(c=0;4>c;++c)this.voices[c].synth=b,b+=64;a.position=m+2210;f=a.readUint();b=a.readUint();
a.position=d+b;this.patterns=g(new ArrayBuffer(f-b));a.readBytes(this.patterns,0,f-b);b+=d;a.position=m+2197;this.lastSong=f=a.readUbyte();this.songs=[];this.songs.length=++f;d=m+2830;n=b-d;for(c=b=0;c<f;++c){z=Object.create(null,{speed:{value:0,writable:!0},length:{value:0,writable:!0},tracks:{value:[],writable:!0}});z.tracks=[];for(e=0;4>e;++e){a.position=d+b;k=a.readUshort();h=3==e&&c==f-1?n:a.readUshort();h=h-k>>1;h>z.length&&(z.length=h);z.tracks[e]=new Uint32Array(h);a.position=d+k;for(k=0;k<
h;++k)z.tracks[e][k]=a.readUshort();b+=2}a.position=m+2199+c;z.speed=a.readUbyte();this.songs[c]=z}a.clear()}}},process:{value:function(){for(var a,d,m,c,e,f,b=this.voices[3];b;){a=b.channel;e=0;do if(this.patterns.position=b.patternPos,f=b.sample,this.sampFlag=0,b.busy||(b.busy=1,0==f.loopPtr?(a.pointer=this.mixer.loopPtr,a.length=this.mixer.loopLen):0<f.loopPtr&&(a.pointer=f.type?b.synth:f.pointer+f.loopPtr,a.length=f.length-f.loopPtr)),0==--b.tick)for(e=2;1<e;)if(m=this.patterns.readByte(),0>m)switch(m){case -125:b.sample=
f=this.samples[this.patterns.readUbyte()];this.sampFlag=1;b.patternPos=this.patterns.position;break;case -126:this.speed=this.patterns.readUbyte();b.patternPos=this.patterns.position;break;case -127:m=f?f.relative:428;b.portaSpeed=this.patterns.readUbyte()*this.speed;b.portaNote=this.patterns.readUbyte();b.portaLimit=t[b.portaNote]*m>>10;b.portamento=0;b.portaDelay=this.patterns.readUbyte()*this.speed;b.portaFlag=1;b.patternPos=this.patterns.position;break;case -124:a.enabled=0;b.tick=this.speed;
b.busy=1;b.patternPos=this.patterns.position;e=0;break;case -128:for(b.trackPos++;;)if(m=this.song.tracks[b.index][b.trackPos],65535==m)this.mixer.complete=1;else if(32767<m)b.trackPos=(m^32768)>>1,this.loopSong||(this.complete&=~b.bitFlag,this.complete||(this.mixer.complete=1));else{b.patternPos=m;e=b.tick=1;break}break;default:b.tick=this.speed*-m,b.patternPos=this.patterns.position,e=0}else{e=0;b.patternPos=this.patterns.position;b.note=m;b.arpeggioPos=0;b.vibratoFlag=-1;b.vibrato=0;b.arpeggioSpeed=
f.arpeggioSpeed;b.vibratoDelay=f.vibratoDelay;b.vibratoSpeed=f.vibratoSpeed;b.vibratoDepth=f.vibratoDepth;if(1==f.type){if(this.sampFlag||f.synchro&2){b.pulseCounter=f.pulseCounter;b.pulseDelay=f.pulseDelay;b.pulseDir=0;b.pulsePos=f.pulsePosL;b.pulseSpeed=f.pulseSpeed;d=b.synth;for(c=d+f.pulsePosL;d<c;++d)this.mixer.memory[d]=f.pulseRateNeg;for(c+=f.length-f.pulsePosL;d<c;++d)this.mixer.memory[d]=f.pulseRatePos}a.pointer=b.synth}else if(2==f.type){b.blendCounter=f.blendCounter;b.blendDelay=f.blendDelay;
b.blendDir=0;b.blendPos=1;d=f.pointer;m=b.synth;for(c=d+31;d<c;++d)this.mixer.memory[m++]=this.mixer.memory[d];a.pointer=b.synth}else a.pointer=f.pointer;b.tick=this.speed;b.busy=0;b.period=t[b.note]*f.relative>>10;b.volume=0;b.envelopePos=0;b.sustainTime=f.sustainTime;a.length=f.length;a.period=b.period;a.volume=0;a.enabled=1;b.portaFlag&&!b.portamento&&(b.portamento=b.period,b.portaCounter=1,b.portaPeriod=b.portaLimit-b.period)}else 1==b.tick&&(m=this.patterns.readAt(b.patternPos)-160&255,127<m&&
(a.enabled=0));while(0<e);if(a.enabled){m=b.note+f.arpeggio[b.arpeggioPos];0==--b.arpeggioSpeed&&(b.arpeggioSpeed=f.arpeggioSpeed,++b.arpeggioPos==f.arpeggioLimit&&(b.arpeggioPos=0));b.period=t[m]*f.relative>>10;b.portaFlag&&(b.portaDelay?b.portaDelay--:(b.period+=b.portaCounter*b.portaPeriod/b.portaSpeed,++b.portaCounter>b.portaSpeed&&(b.note=b.portaNote,b.portaFlag=0)));b.vibratoDelay?b.vibratoDelay--:b.vibratoFlag&&(0>b.vibratoFlag?(b.vibrato+=b.vibratoSpeed,b.vibrato==b.vibratoDepth&&(b.vibratoFlag^=
2147483648)):(b.vibrato-=b.vibratoSpeed,0==b.vibrato&&(b.vibratoFlag^=2147483648)),0==b.vibrato&&(b.vibratoFlag^=1),b.period=b.vibratoFlag&1?b.period+b.vibrato:b.period-b.vibrato);a.period=b.period;switch(b.envelopePos){case 0:b.volume+=f.attackSpeed;b.volume>=f.attackVol&&(b.volume=f.attackVol,b.envelopePos=1);break;case 1:b.volume-=f.decaySpeed;b.volume<=f.decayVol&&(b.volume=f.decayVol,b.envelopePos=2);break;case 2:b.sustainTime?b.sustainTime--:b.envelopePos=3;break;case 3:b.volume-=f.releaseSpeed,
b.volume<=f.releaseVol&&(b.volume=f.releaseVol,b.envelopePos=4)}m=f.envelopeVol<<12;m>>=8;m>>=4;m*=b.volume;m>>=8;m>>=1;a.volume=m;if(1==f.type)if(b.pulseDelay)b.pulseDelay--;else if(b.pulseSpeed)b.pulseSpeed--;else{if(b.pulseCounter||!(f.synchro&1)){b.pulseSpeed=f.pulseSpeed;if(b.pulseDir&4)for(;;){if(b.pulsePos>=f.pulsePosL){e=1;break}b.pulseDir&=-5;b.pulsePos++;b.pulseCounter--;if(b.pulsePos<=f.pulsePosH){e=2;break}b.pulseDir|=4;b.pulsePos--;b.pulseCounter--}else for(;;){if(b.pulsePos<=f.pulsePosH){e=
2;break}b.pulseDir|=4;b.pulsePos--;b.pulseCounter--;if(b.pulsePos>=f.pulsePosL){e=1;break}b.pulseDir&=-5;b.pulsePos++;b.pulseCounter++}a=b.synth+b.pulsePos;1==e?(this.mixer.memory[a]=f.pulseRatePos,b.pulsePos--):(this.mixer.memory[a]=f.pulseRateNeg,b.pulsePos++)}}else if(2==f.type)if(b.blendDelay)b.blendDelay--;else if(b.blendCounter||!(f.synchro&4))for(b.blendDir?1!=b.blendPos?b.blendPos--:(b.blendDir^=1,b.blendCounter--):b.blendPos!=f.blendRate<<1?b.blendPos++:(b.blendDir^=1,b.blendCounter--),d=
f.pointer,c=d+31,a=c+1;d<c;++d)m=b.blendPos*this.mixer.memory[a++]>>f.blendRate,this.mixer.memory[a++]=m+this.mixer.memory[d]}b=b.next}}}});d.voices[3]=p(3,8);d.voices[3].next=d.voices[2]=p(2,4);d.voices[2].next=d.voices[1]=p(1,2);d.voices[1].next=d.voices[0]=p(0,1);return Object.seal(d)}})();(function(){function g(d){return Object.create(null,{index:{value:d,writable:!0},next:{value:null,writable:!0},channel:{value:null,writable:!0},sample:{value:null,writable:!0},enabled:{value:0,writable:!0},period:{value:0,
writable:!0},effect:{value:0,writable:!0},param:{value:0,writable:!0},volume:{value:0,writable:!0},last:{value:0,writable:!0},slideCtr:{value:0,writable:!0},slideDir:{value:0,writable:!0},slideParam:{value:0,writable:!0},slidePeriod:{value:0,writable:!0},slideSpeed:{value:0,writable:!0},stepPeriod:{value:0,writable:!0},stepSpeed:{value:0,writable:!0},stepWanted:{value:0,writable:!0},initialize:{value:function(){this.sample=this.channel=null;this.stepWanted=this.stepSpeed=this.stepPeriod=this.slideSpeed=
this.slidePeriod=this.slideParam=this.slideDir=this.slideCtr=this.last=this.volume=this.param=this.effect=this.period=this.enabled=0}}})}var t=[1076,1016,960,906,856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,113,-1];window.neoart.FXPlayer=function(d){d=B(d);Object.defineProperties(d,{id:{value:"FXPlayer"},
standard:{value:0,writable:!0},track:{value:null,writable:!0},patterns:{value:[],writable:!0},samples:{value:[],writable:!0},length:{value:0,writable:!0},voices:{value:[],writable:!0},trackPos:{value:0,writable:!0},patternPos:{value:0,writable:!0},jumpFlag:{value:0,writable:!0},delphine:{value:0,writable:!0},force:{set:function(a){1>a?a=1:4<a&&(a=4);this.version=a}},ntsc:{set:function(a){this.standard=a;this.frequency(a);a=this.sampleRate/1E3*(a?20.44952532:20.637767904)/120;this.mixer.samplesTick=
this.tempo/122*a>>0}},initialize:{value:function(){var a=this.voices[0];this.reset();this.ntsc=this.standard;this.speed=6;for(this.jumpFlag=this.patternPos=this.trackPos=0;a;)a.initialize(),a.channel=this.mixer.channels[a.index],a.sample=this.samples[0],a=a.next}},loader:{value:function(a){var d=0,m,c,e,f,b=0,k;if(!(1686>a.length)){a.position=60;m=a.readString(4);if("SONG"!=m){a.position=124;m=a.readString(4);if("SO31"!=m||2350>a.length)return;e=544;this.samples.length=c=32;this.version=4}else e=
0,this.samples.length=c=16,this.version=1;this.tempo=a.readUshort();a.position=0;for(m=1;m<c;++m)(k=a.readUint())?(f=A(),f.pointer=b,b+=k,this.samples[m]=f):this.samples[m]=null;a.position+=20;for(m=1;m<c;++m)(f=this.samples[m])?(f.name=a.readString(22),f.length=a.readUshort()<<1,f.volume=a.readUshort(),f.loop=a.readUshort(),f.repeat=a.readUshort()<<1):a.position+=30;a.position=530+e;this.length=c=a.readUbyte();a.position++;for(m=0;m<c;++m)k=a.readUbyte()<<8,this.track[m]=k,k>d&&(d=k);e&&(e+=4);a.position=
660+e;d+=256;this.patterns.length=d;c=this.samples.length;for(m=0;m<d;++m){e=C();e.note=a.readShort();k=a.readUbyte();e.param=a.readUbyte();e.effect=k&15;e.sample=k>>4;this.patterns[m]=e;if(4==this.version)e.note&4096&&(e.sample+=16,0<e.note&&(e.note&=61439));else{if(9==e.effect||856<e.note)this.version=2;-3>e.note&&(this.version=3)}if(e.sample>=c||null==this.samples[e.sample])e.sample=0}this.mixer.store(a,b);for(m=1;m<c;++m)if(f=this.samples[m])for(f.loop?f.loopPtr=f.pointer+f.loop:(f.loopPtr=this.mixer.memory.length,
f.repeat=2),b=f.pointer+4,d=f.pointer;d<b;++d)this.mixer.memory[d]=0;f=A();f.pointer=f.loopPtr=this.mixer.memory.length;f.length=f.repeat=2;this.samples[0]=f;for(m=a.position=d=this.delphine=0;265>m;++m)d+=a.readUshort();switch(d){case 172662:case 1391423:case 1458300:case 1706977:case 1920077:case 1920694:case 1677853:case 1931956:case 1926836:case 1385071:case 1720635:case 1714491:case 1731874:case 1437490:this.delphine=1}}}},process:{value:function(){var a,d,m,c=this.voices[0];if(this.tick)for(;c;){a=
c.channel;if(2!=this.version||-3!=c.period)if(c.stepSpeed)c.stepPeriod+=c.stepSpeed,0>c.stepSpeed?c.stepPeriod<c.stepWanted&&(c.stepPeriod=c.stepWanted,2<this.version&&(c.stepSpeed=0)):c.stepPeriod>c.stepWanted&&(c.stepPeriod=c.stepWanted,2<this.version&&(c.stepSpeed=0)),2<this.version&&(c.last=c.stepPeriod),a.period=c.stepPeriod;else{if(c.slideSpeed&&(m=c.slideParam&15))if(++c.slideCtr==m)c.slideCtr=0,m=c.slideParam<<4<<3,c.slideDir?(c.slidePeriod-=8,a.period=c.slidePeriod,m-=c.slideSpeed,m==c.slidePeriod&&
(c.slideDir=0)):(c.slidePeriod+=8,a.period=c.slidePeriod,m+=c.slideSpeed,m==c.slidePeriod&&(c.slideDir=1));else{c=c.next;continue}m=0;switch(c.effect){case 1:m=this.tick%3;d=0;if(2==m){a.period=c.last;c=c.next;continue}for(m=1==m?c.param&15:c.param>>4;c.last!=t[d];)d++;a.period=t[d+m];break;case 2:m=c.param>>4;c.period=m?c.period+m:c.period-(c.param&15);a.period=c.period;break;case 3:this.mixer.filter.active=1;break;case 4:this.mixer.filter.active=0;break;case 8:m=-1;case 7:c.stepSpeed=c.param&15;
c.stepPeriod=2<this.version?c.last:c.period;0>m&&(c.stepSpeed=-c.stepSpeed);for(d=0;;){a=t[d];if(a==c.stepPeriod)break;if(0>a){d=-1;break}else d++}-1<d?(a=c.param>>4,-1<m&&(a=-a),d+=a,0>d&&(d=0),c.stepWanted=t[d]):c.stepWanted=c.period;break;case 9:c.slideSpeed=c.slidePeriod=c.period,c.slideParam=c.param,c.slideDir=0,c.slideCtr=0}}c=c.next}else for(m=this.track[this.trackPos]+this.patternPos;c;){a=c.channel;c.enabled=0;d=this.patterns[m+c.index];c.period=d.note;c.effect=d.effect;c.param=d.param;if(-3==
d.note)c.effect=0;else if(d.sample?(d=c.sample=this.samples[d.sample],c.volume=d.volume,5==c.effect?c.volume+=c.param:6==c.effect&&(c.volume-=c.param),a.volume=c.volume):d=c.sample,c.period){c.last=c.period;c.slideSpeed=0;c.stepSpeed=0;c.enabled=1;a.enabled=0;switch(c.period){case -2:a.volume=0;break;case -4:this.jumpFlag=1;break;case -5:break;default:a.pointer=d.pointer,a.length=d.length,a.period=this.delphine?c.period<<1:c.period}c.enabled&&(a.enabled=1);a.pointer=d.loopPtr;a.length=d.repeat}c=
c.next}++this.tick==this.speed&&(this.tick=0,this.patternPos+=4,256==this.patternPos||this.jumpFlag)&&(this.patternPos=this.jumpFlag=0,++this.trackPos==this.length&&(this.trackPos=0,this.mixer.complete=1))}}});d.voices[0]=g(0);d.voices[0].next=d.voices[1]=g(1);d.voices[1].next=d.voices[2]=g(2);d.voices[2].next=d.voices[3]=g(3);d.track=new Uint16Array(128);return Object.seal(d)}})();(function(){function g(a){return Object.create(null,{index:{value:a,writable:!0},next:{value:null,writable:!0},channel:{value:null,
writable:!0},sample:{value:null,writable:!0},enabled:{value:0,writable:!0},period:{value:0,writable:!0},effect:{value:0,writable:!0},param:{value:0,writable:!0},volume1:{value:0,writable:!0},volume2:{value:0,writable:!0},handler:{value:0,writable:!0},portaDir:{value:0,writable:!0},portaPeriod:{value:0,writable:!0},portaSpeed:{value:0,writable:!0},vibratoPos:{value:0,writable:!0},vibratoSpeed:{value:0,writable:!0},wavePos:{value:0,writable:!0},initialize:{value:function(){this.sample=this.channel=
null;this.wavePos=this.vibratoSpeed=this.vibratoPos=this.portaSpeed=this.portaPeriod=this.portaDir=this.handler=this.volume2=this.volume1=this.param=this.effect=this.period=this.enabled=0}}})}function t(){var a=A();Object.defineProperties(a,{finetune:{value:0,writable:!0},restart:{value:0,writable:!0},waveLen:{value:0,writable:!0},waves:{value:null,writable:!0},volumes:{value:null,writable:!0}});return Object.seal(a)}var d=[0,3,7,12,15,12,7,3,0,3,7,12,15,12,7,3,0,4,7,12,16,12,7,4,0,4,7,12,16,12,7,
4,0,3,8,12,15,12,8,3,0,3,8,12,15,12,8,3,0,4,8,12,16,12,8,4,0,4,8,12,16,12,8,4,0,5,8,12,17,12,8,5,0,5,8,12,17,12,8,5,0,5,9,12,17,12,9,5,0,5,9,12,17,12,9,5,12,0,7,0,3,0,7,0,12,0,7,0,3,0,7,0,12,0,7,0,4,0,7,0,12,0,7,0,4,0,7,0,0,3,7,3,7,12,7,12,15,12,7,12,7,3,7,3,0,4,7,4,7,12,7,12,16,12,7,12,7,4,7,4,31,27,24,19,15,12,7,3,0,3,7,12,15,19,24,27,31,28,24,19,16,12,7,4,0,4,7,12,16,19,24,28,0,12,0,12,0,12,0,12,0,12,0,12,0,12,0,12,0,12,24,12,0,12,24,12,0,12,24,12,0,12,24,12,0,3,0,3,0,3,0,3,0,3,0,3,0,3,0,3,0,4,
0,4,0,4,0,4,0,4,0,4,0,4,0,4],a=[856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,113,0],l=[0,24,49,74,97,120,141,161,180,197,212,224,235,244,250,253,255,253,250,244,235,224,212,197,180,161,141,120,97,74,49,24];window.neoart.HMPlayer=function(m){m=B(m);Object.defineProperties(m,{id:{value:"HMPlayer"},track:{value:null,writable:!0},patterns:{value:[],writable:!0},samples:{value:[],writable:!0},length:{value:0,
writable:!0},restart:{value:0,writable:!0},voices:{value:[],writable:!0},trackPos:{value:0,writable:!0},patternPos:{value:0,writable:!0},jumpFlag:{value:0,writable:!0},initialize:{value:function(){var c=this.voices[0];this.reset();this.speed=6;this.jumpFlag=this.patternPos=this.trackPos=0;for(this.mixer.samplesTick=884;c;)c.initialize(),c.channel=this.mixer.channels[c.index],c.sample=this.samples[0],c=c.next}},loader:{value:function(c){var e=0,a=0,b,d,l,m=0,g=0,p;if(!(2106>c.length)&&(c.position=
1080,d=c.readString(4),"FEST"==d)){c.position=950;this.length=c.readUbyte();this.restart=c.readUbyte();for(b=0;128>b;++b)this.track[b]=c.readUbyte();c.position=0;this.title=c.readString(20);for(b=this.version=1;32>b;++b){this.samples[b]=null;d=c.readString(4);if("Mupp"==d){p=c.readUbyte();e=p-a++;for(l=0;128>l;++l)this.track[l]&&this.track[l]>=e&&this.track[l]--;e=t();e.name=d;e.length=e.repeat=32;e.restart=c.readUbyte();e.waveLen=c.readUbyte();c.position+=17;e.finetune=c.readByte();e.volume=c.readUbyte();
d=c.position+4;p=1084+(p<<10);c.position=p;e.pointer=this.mixer.memory.length;e.waves=new Uint16Array(64);e.volumes=new Uint8Array(64);this.mixer.store(c,896);for(l=0;64>l;++l)e.waves[l]=c.readUbyte()<<5;for(l=0;64>l;++l)e.volumes[l]=c.readUbyte()&127;c.position=p;c.writeInt(1718382436);c.position=d;m+=896}else{d=d.substr(0,2);"El"==d?c.position+=18:(c.position-=4,d=c.readString(22));p=c.readUshort();if(!p){c.position+=6;continue}e=t();e.name=d;e.pointer=g;e.length=p<<1;e.finetune=c.readByte();e.volume=
c.readUbyte();e.loop=c.readUshort()<<1;e.repeat=c.readUshort()<<1;g+=e.length}this.samples[b]=e}for(b=0;128>b;++b)p=this.track[b]<<8,this.track[b]=p,p>a&&(a=p);c.position=1084;a+=256;this.patterns.length=a;for(b=0;b<a;++b){for(p=c.readUint();1718382436==p;)c.position+=1020,p=c.readUint();l=C();l.note=p>>16&4095;l.sample=p>>24&240|p>>12&15;l.effect=p>>8&15;l.param=p&255;if(31<l.sample||!this.samples[l.sample])l.sample=0;this.patterns[b]=l}this.mixer.store(c,g);for(b=1;32>b;++b)if(e=this.samples[b],
null!=e&&"Mupp"!=e.name)for(e.pointer+=m,e.loop?(e.loopPtr=e.pointer+e.loop,e.length=e.loop+e.repeat):(e.loopPtr=this.mixer.memory.length,e.repeat=2),g=e.pointer+4,l=e.pointer;l<g;++l)this.mixer.memory[l]=0;e=t();e.pointer=e.loopPtr=this.mixer.memory.length;e.length=e.repeat=2;this.samples[0]=e}}},process:{value:function(){var c,a,d,b,l,h=this.voices[0];if(this.tick)for(;h;)this.effects(h),this.handler(h),b=h.sample,h.channel.pointer=b.loopPtr,h.channel.length=b.repeat,h=h.next;else for(a=this.track[this.trackPos]+
this.patternPos;h;){c=h.channel;h.enabled=0;d=this.patterns[a+h.index];h.effect=d.effect;h.param=d.param;d.sample?(b=h.sample=this.samples[d.sample],h.volume2=b.volume,"Mupp"==b.name?(b.loopPtr=b.pointer+b.waves[0],h.handler=1,h.volume1=b.volumes[0]):(h.handler=0,h.volume1=64)):b=h.sample;d.note&&(3==h.effect||5==h.effect?d.note<h.period?(h.portaDir=1,h.portaPeriod=d.note):d.note>h.period?(h.portaDir=0,h.portaPeriod=d.note):h.portaPeriod=0:(h.period=d.note,h.vibratoPos=0,h.wavePos=0,h.enabled=1,c.enabled=
0,l=h.period*b.finetune>>8,c.period=h.period+l,h.handler?(c.pointer=b.loopPtr,c.length=b.repeat):(c.pointer=b.pointer,c.length=b.length)));switch(h.effect){case 11:this.trackPos=h.param-1;this.jumpFlag=1;break;case 12:h.volume2=h.param;64<h.volume2&&(h.volume2=64);break;case 13:this.jumpFlag=1;break;case 14:this.mixer.filter.active=h.param^1;break;case 15:l=h.param,1>l?l=1:31<l&&(l=31),this.speed=l,this.tick=0}d.note||this.effects(h);this.handler(h);h.enabled&&(c.enabled=1);c.pointer=b.loopPtr;c.length=
b.repeat;h=h.next}++this.tick==this.speed&&(this.tick=0,this.patternPos+=4,256==this.patternPos||this.jumpFlag)&&(this.patternPos=this.jumpFlag=0,this.trackPos=++this.trackPos&127,this.trackPos==this.length&&(this.trackPos=this.restart,this.mixer.complete=1))}},effects:{value:function(c){var e=c.channel,f,b,m=c.period&4095,h,g;if(c.effect||c.param)switch(c.effect){case 0:g=this.tick%3;if(!g)break;g=1==g?c.param>>4:c.param&15;b=37-g;for(f=0;f<b;++f)if(m>=a[f]){m=a[f+g];break}break;case 1:c.period-=
c.param;113>c.period&&(c.period=113);m=c.period;break;case 2:c.period+=c.param;856<c.period&&(c.period=856);m=c.period;break;case 3:case 5:5==c.effect?h=1:c.param&&(c.portaSpeed=c.param,c.param=0);c.portaPeriod&&(c.portaDir?(c.period-=c.portaSpeed,c.period<c.portaPeriod&&(c.period=c.portaPeriod,c.portaPeriod=0)):(c.period+=c.portaSpeed,c.period>c.portaPeriod&&(c.period=c.portaPeriod,c.portaPeriod=0)));m=c.period;break;case 4:case 6:6==c.effect?h=1:c.param&&(c.vibratoSpeed=c.param);g=l[c.vibratoPos>>
2&31];g=(c.vibratoSpeed&15)*g>>7;m=127<c.vibratoPos?m-g:m+g;g=c.vibratoSpeed>>2&60;c.vibratoPos=c.vibratoPos+g&255;break;case 7:g=d[(c.vibratoPos&15)+((c.param&15)<<4)];c.vibratoPos++;for(f=0;37>f&&!(m>=a[f]);++f);g+=f;35<g&&(g-=12);m=a[g];break;case 10:h=1}e.period=m+(m*c.sample.finetune>>8);h&&(g=c.param>>4,c.volume2=g?c.volume2+g:c.volume2-(c.param&15),64<c.volume2?c.volume2=64:0>c.volume2&&(c.volume2=0))}},handler:{value:function(c){var a;c.handler&&(a=c.sample,a.loopPtr=a.pointer+a.waves[c.wavePos],
c.volume1=a.volumes[c.wavePos],++c.wavePos>a.waveLen&&(c.wavePos=a.restart));c.channel.volume=c.volume1*c.volume2>>6}}});m.voices[0]=g(0);m.voices[0].next=m.voices[1]=g(1);m.voices[1].next=m.voices[2]=g(2);m.voices[2].next=m.voices[3]=g(3);m.track=new Uint16Array(128);return Object.seal(m)}})();(function(){function g(d){return Object.create(null,{index:{value:d,writable:!0},next:{value:null,writable:!0},channel:{value:null,writable:!0},enabled:{value:0,writable:!0},cosoCounter:{value:0,writable:!0},
cosoSpeed:{value:0,writable:!0},trackPtr:{value:0,writable:!0},trackPos:{value:0,writable:!0},trackTransp:{value:0,writable:!0},patternPtr:{value:0,writable:!0},patternPos:{value:0,writable:!0},frqseqPtr:{value:0,writable:!0},frqseqPos:{value:0,writable:!0},volseqPtr:{value:0,writable:!0},volseqPos:{value:0,writable:!0},sample:{value:0,writable:!0},loopPtr:{value:0,writable:!0},repeat:{value:0,writable:!0},tick:{value:0,writable:!0},note:{value:0,writable:!0},transpose:{value:0,writable:!0},info:{value:0,
writable:!0},infoPrev:{value:0,writable:!0},volume:{value:0,writable:!0},volCounter:{value:0,writable:!0},volSpeed:{value:0,writable:!0},volSustain:{value:0,writable:!0},volTransp:{value:0,writable:!0},volFade:{value:0,writable:!0},portaDelta:{value:0,writable:!0},vibrato:{value:0,writable:!0},vibDelay:{value:0,writable:!0},vibDelta:{value:0,writable:!0},vibDepth:{value:0,writable:!0},vibSpeed:{value:0,writable:!0},slide:{value:0,writable:!0},sldActive:{value:0,writable:!0},sldDone:{value:0,writable:!0},
sldCounter:{value:0,writable:!0},sldSpeed:{value:0,writable:!0},sldDelta:{value:0,writable:!0},sldPointer:{value:0,writable:!0},sldLen:{value:0,writable:!0},sldEnd:{value:0,writable:!0},sldLoopPtr:{value:0,writable:!0},initialize:{value:function(){this.channel=null;this.trackPtr=this.cosoSpeed=this.cosoCounter=this.enabled=0;this.trackPos=12;this.volseqPos=this.volseqPtr=this.frqseqPos=this.frqseqPtr=this.patternPos=this.patternPtr=this.trackTransp=0;this.sample=-1;this.volume=this.infoPrev=this.info=
this.transpose=this.note=this.tick=this.repeat=this.loopPtr=0;this.volSpeed=this.volCounter=1;this.volTransp=this.volSustain=0;this.volFade=100;this.sldLoopPtr=this.sldEnd=this.sldLen=this.sldPointer=this.sldDelta=this.sldSpeed=this.sldCounter=this.sldDone=this.sldActive=this.slide=this.vibSpeed=this.vibDepth=this.vibDelta=this.vibDelay=this.vibrato=this.portaDelta=0}}})}var p=[1712,1616,1524,1440,1356,1280,1208,1140,1076,1016,960,906,856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,
339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,113,113,113,113,113,113,113,113,113,113,113,113,113,3424,3232,3048,2880,2712,2560,2416,2280,2152,2032,1920,1812,6848,6464,6096,5760,5424,5120,4832,4560,4304,4064,3840,3624];window.neoart.JHPlayer=function(d){d=B(d);Object.defineProperties(d,{id:{value:"JHPlayer"},songs:{value:[],writable:!0},samples:{value:[],writable:!0},stream:{value:null,writable:!0},base:{value:0,writable:!0},patterns:{value:0,writable:!0},patternLen:{value:0,
writable:!0},periods:{value:0,writable:!0},frqseqs:{value:0,writable:!0},volseqs:{value:0,writable:!0},samplesData:{value:0,writable:!0},song:{value:null,writable:!0},voices:{value:[],writable:!0},coso:{value:0,writable:!0},variant:{value:0,writable:!0},initialize:{value:function(){var a=this.voices[0];this.reset();this.song=this.songs[this.playSong];this.speed=this.song.speed;for(this.tick=this.coso||1<this.variant?1:this.speed;a;)a.initialize(),a.channel=this.mixer.channels[a.index],a.trackPtr=
this.song.pointer+3*a.index,this.coso?(a.trackPos=0,a.patternPos=8):(this.stream.position=a.trackPtr,a.patternPtr=this.patterns+this.stream.readUbyte()*this.patternLen,a.trackTransp=this.stream.readByte(),a.volTransp=this.stream.readByte(),a.frqseqPtr=this.base,a.volseqPtr=this.base),a=a.next}},loader:{value:function(a){var d,m,c,e,f,b,k;this.base=this.periods=d=0;if(this.coso="COSO"==a.readString(4)){for(m=0;7>m;++m)d+=a.readInt();16942==d&&(a.position=47,d+=a.readUbyte());switch(d){case 22666:case 18842:case 30012:case 22466:case 3546:this.variant=
1;break;case 16948:case 18332:case 13698:this.variant=2;break;case 18546:case 13926:case 8760:case 17242:case 11394:case 14494:case 14392:case 13576:case 6520:this.variant=3;break;default:this.variant=4}this.version=2;a.position=4;this.frqseqs=a.readUint();this.volseqs=a.readUint();this.patterns=a.readUint();k=a.readUint();b=a.readUint();d=a.readUint();this.samplesData=a.readUint();a.position=0;a.writeInt(16777216);a.writeInt(225);a.writeShort(65535);e=(this.samplesData-d)/10-1;this.lastSong=(d-b)/
6}else{for(;12<a.bytesAvailable;)switch(d=a.readUshort(),d){case 576:d=a.readUshort();127==d&&(a.position+=2,this.periods=a.position+a.readUshort());break;case 28674:case 28675:this.channels=d&255;d=a.readUshort();30208==d&&(d=a.readUshort());16890==d&&(a.position+=4,this.base=a.position+a.readUshort());break;case 21574:d=a.readUshort(),19800==d&&(c=a.position-4,a.position=a.length)}if(!c||!this.base||!this.periods)return;this.version=1;a.position=c+4;this.frqseqs=m=c+32;d=a.readUshort();this.volseqs=
m+=++d<<6;d=a.readUshort();this.patterns=m+=++d<<6;d=a.readUshort();a.position+=2;this.patternLen=a.readUshort();k=m+=++d*this.patternLen;a.position-=4;d=a.readUshort();b=m+=12*++d;a.position=c+16;this.lastSong=a.readUshort();d=m+=6*++this.lastSong;e=a.readUshort();this.samplesData=m+30*e}a.position=d;this.samples=[];for(m=d=0;m<e;++m)f=A(),this.coso||(f.name=a.readString(18)),f.pointer=a.readUint(),f.length=a.readUshort()<<1,this.coso||(f.volume=a.readUshort()),f.loopPtr=a.readUshort()+f.pointer,
f.repeat=a.readUshort()<<1,f.loopPtr&1&&f.loopPtr--,d+=f.length,this.samples[m]=f;a.position=this.samplesData;this.mixer.store(a,d);a.position=b;this.songs=[];for(m=d=0;m<this.lastSong;++m)e=Object.create(null,{pointer:{value:0,writable:!0},speed:{value:0,writable:!0},length:{value:0,writable:!0}}),e.pointer=a.readUshort(),e.length=a.readUshort()-e.pointer+1,e.speed=a.readUshort(),e.pointer=12*e.pointer+k,e.length*=12,12<e.length&&(this.songs[d++]=e);this.lastSong=this.songs.length-1;if(!this.coso)for(a.position=
0,this.variant=1;a.position<c;)if(d=a.readUshort(),45116==d||3072==d){if(d=a.readUshort(),229==d||230==d||233==d){this.variant=2;break}}else if(20219==d){this.variant=3;break}this.stream=a}},process:{value:function(){var a,d,m,c,e,f,b=this.voices[0];if(0==--this.tick){for(this.tick=this.speed;b;){a=b.channel;if(this.coso){if(0>--b.cosoCounter){b.cosoCounter=b.cosoSpeed;do{this.stream.position=b.patternPos;do d=0,f=this.stream.readByte(),-1==f?(b.trackPos==this.song.length&&(b.trackPos=0,this.mixer.complete=
1),this.stream.position=b.trackPtr+b.trackPos,f=this.stream.readUbyte(),b.trackTransp=this.stream.readByte(),m=this.stream.readAt(this.stream.position),3<this.variant&&127<m?(c=m>>4&15,m&=15,15==c?(c=100,m&&(c=15-m+1,m=c<<=1,c<<=1,c+=m),b.volFade=c):8==c?this.mixer.complete=1:14==c&&(this.speed=m)):b.volTransp=this.stream.readByte(),this.stream.position=this.patterns+(f<<1),b.patternPos=this.stream.readUshort(),b.trackPos+=12,d=1):-2==f?(b.cosoCounter=b.cosoSpeed=this.stream.readUbyte(),d=3):-3==
f?(b.cosoCounter=b.cosoSpeed=this.stream.readUbyte(),b.patternPos=this.stream.position):(b.note=f,b.info=this.stream.readByte(),b.info&224&&(b.infoPrev=this.stream.readByte()),b.patternPos=this.stream.position,b.portaDelta=0,0<=f&&(1==this.variant&&(a.enabled=0),f=(b.info&31)+b.volTransp,this.stream.position=this.volseqs+(f<<1),this.stream.position=this.stream.readUshort(),b.volCounter=b.volSpeed=this.stream.readUbyte(),b.volSustain=0,f=this.stream.readByte(),b.vibSpeed=this.stream.readByte(),b.vibrato=
64,b.vibDepth=b.vibDelta=this.stream.readByte(),b.vibDelay=this.stream.readUbyte(),b.volseqPtr=this.stream.position,b.volseqPos=0,-128!=f&&(1<this.variant&&b.info&64&&(f=b.infoPrev),this.stream.position=this.frqseqs+(f<<1),b.frqseqPtr=this.stream.readUshort(),b.frqseqPos=0,b.tick=0)));while(2<d)}while(0<d)}}else{this.stream.position=b.patternPtr+b.patternPos;f=this.stream.readByte();if(b.patternPos==this.patternLen||1==(f&127))b.trackPos==this.song.length&&(b.trackPos=0,this.mixer.complete=1),this.stream.position=
b.trackPtr+b.trackPos,f=this.stream.readUbyte(),b.trackTransp=this.stream.readByte(),b.volTransp=this.stream.readByte(),-128==b.volTransp&&(this.mixer.complete=1),b.patternPtr=this.patterns+f*this.patternLen,b.patternPos=0,b.trackPos+=12,this.stream.position=b.patternPtr,f=this.stream.readByte();f&127&&(b.note=f&127,b.portaDelta=0,m=this.stream.position,b.patternPos||(this.stream.position+=this.patternLen),this.stream.position-=2,b.infoPrev=this.stream.readByte(),this.stream.position=m,b.info=this.stream.readByte(),
0<=f&&(1==this.variant&&(a.enabled=0),f=(b.info&31)+b.volTransp,this.stream.position=this.volseqs+(f<<6),b.volCounter=b.volSpeed=this.stream.readUbyte(),b.volSustain=0,f=this.stream.readByte(),b.vibSpeed=this.stream.readByte(),b.vibrato=64,b.vibDepth=b.vibDelta=this.stream.readByte(),b.vibDelay=this.stream.readUbyte(),b.volseqPtr=this.stream.position,b.volseqPos=0,1<this.variant&&b.info&64&&(f=b.infoPrev),b.frqseqPtr=this.frqseqs+(f<<6),b.frqseqPos=0,b.tick=0));b.patternPos+=2}b=b.next}b=this.voices[0]}for(;b;){a=
b.channel;b.enabled=0;do if(d=0,b.tick)b.tick--;else{this.stream.position=b.frqseqPtr+b.frqseqPos;do{f=this.stream.readByte();if(-31==f)break;d=3;3==this.variant&&this.coso&&(-27==f?f=-30:-26==f&&(f=-28));switch(f){case -32:b.frqseqPos=this.stream.readUbyte()&63;this.stream.position=b.frqseqPtr+b.frqseqPos;break;case -30:e=this.samples[this.stream.readUbyte()];b.sample=-1;b.loopPtr=e.loopPtr;b.repeat=e.repeat;b.enabled=1;a.enabled=0;a.pointer=e.pointer;a.length=e.length;b.volseqPos=0;b.volCounter=
1;b.slide=0;b.frqseqPos+=2;break;case -29:b.vibSpeed=this.stream.readByte();b.vibDepth=this.stream.readByte();b.frqseqPos+=3;break;case -28:e=this.samples[this.stream.readUbyte()];b.loopPtr=e.loopPtr;b.repeat=e.repeat;a.pointer=e.pointer;a.length=e.length;b.slide=0;b.frqseqPos+=2;break;case -27:if(2>this.variant)break;e=this.samples[this.stream.readUbyte()];a.enabled=0;b.enabled=1;2==this.variant?(m=this.stream.readUbyte()*e.length,b.loopPtr=e.loopPtr+m,b.repeat=e.repeat,a.pointer=e.pointer+m,a.length=
e.length,b.frqseqPos+=3):(b.sldPointer=e.pointer,b.sldEnd=e.pointer+e.length,f=this.stream.readUshort(),b.sldLoopPtr=65535==f?e.length:f<<1,b.sldLen=this.stream.readUshort()<<1,b.sldDelta=this.stream.readShort()<<1,b.sldActive=0,b.sldCounter=0,b.sldSpeed=this.stream.readUbyte(),b.slide=1,b.sldDone=0,b.frqseqPos+=9);b.volseqPos=0;b.volCounter=1;break;case -26:if(3>this.variant)break;b.sldLen=this.stream.readUshort()<<1;b.sldDelta=this.stream.readShort()<<1;b.sldActive=0;b.sldCounter=0;b.sldSpeed=this.stream.readUbyte();
b.sldDone=0;b.frqseqPos+=6;break;case -25:1==this.variant?(b.frqseqPtr=this.frqseqs+(this.stream.readUbyte()<<6),b.frqseqPos=0,this.stream.position=b.frqseqPtr,d=3):(f=this.stream.readUbyte(),f!=b.sample&&(e=this.samples[f],b.sample=f,b.loopPtr=e.loopPtr,b.repeat=e.repeat,b.enabled=1,a.enabled=0,a.pointer=e.pointer,a.length=e.length),b.volseqPos=0,b.volCounter=1,b.slide=0,b.frqseqPos+=2);break;case -24:b.tick=this.stream.readUbyte();b.frqseqPos+=2;d=1;break;case -23:if(2>this.variant)break;e=this.samples[this.stream.readUbyte()];
b.sample=-1;b.enabled=1;c=this.stream.readUbyte();m=this.stream.position;a.enabled=0;this.stream.position=this.samplesData+e.pointer+4;f=24*this.stream.readUshort()+(this.stream.readUshort()<<2);this.stream.position+=24*c;b.loopPtr=this.stream.readUint()&4294967294;a.length=(this.stream.readUint()&4294967294)-b.loopPtr;b.loopPtr+=e.pointer+f+8;a.pointer=b.loopPtr;b.repeat=2;this.stream.position=m;m=b.loopPtr+1;this.mixer.memory[m]=this.mixer.memory[b.loopPtr];b.volseqPos=0;b.volCounter=1;b.slide=
0;b.frqseqPos+=3;break;default:b.transpose=f,b.frqseqPos++,d=0}}while(2<d)}while(0<d);b.slide&&!b.sldDone&&0>--b.sldCounter&&(b.sldCounter=b.sldSpeed,b.sldActive?(f=b.sldLoopPtr+b.sldDelta,0>f?(b.sldDone=1,f=b.sldLoopPtr-b.sldDelta):(m=b.sldPointer+b.sldLen+f,m>b.sldEnd&&(b.sldDone=1,f=b.sldLoopPtr-b.sldDelta)),b.sldLoopPtr=f):b.sldActive=1,b.loopPtr=b.sldPointer+b.sldLoopPtr,b.repeat=b.sldLen,a.pointer=b.loopPtr,a.length=b.repeat);do if(d=0,b.volSustain)b.volSustain--;else{if(--b.volCounter)break;
b.volCounter=b.volSpeed;do{this.stream.position=b.volseqPtr+b.volseqPos;f=this.stream.readByte();if(-25>=f&&-31<=f)break;switch(f){case -24:b.volSustain=this.stream.readUbyte();b.volseqPos+=2;d=1;break;case -32:b.volseqPos=(this.stream.readUbyte()&63)-5;d=3;break;default:b.volume=f,b.volseqPos++,d=0}}while(2<d)}while(0<d);f=b.transpose;0<=f&&(f+=b.note+b.trackTransp);f&=127;this.coso?(83<f&&(f=0),d=p[f],f<<=1):(f<<=1,this.stream.position=this.periods+f,d=this.stream.readUshort());if(b.vibDelay)b.vibDelay--;
else if(3<this.variant)b.vibrato&32?(f=b.vibDelta+b.vibSpeed,f>b.vibDepth&&(b.vibrato&=-33,f=b.vibDepth)):(f=b.vibDelta-b.vibSpeed,0>f&&(b.vibrato|=32,f=0)),b.vibDelta=f,f=(f-(b.vibDepth>>1))*d,d+=f>>10;else if(2<this.variant)f=b.vibSpeed,0>f&&(f&=127,b.vibrato^=1),b.vibrato&1||(b.vibrato&32?(b.vibDelta+=f,m=b.vibDepth<<1,b.vibDelta>m&&(b.vibrato&=-33,b.vibDelta=m)):(b.vibDelta-=f,0>b.vibDelta&&(b.vibrato|=32,b.vibDelta=0))),d+=f-b.vibDepth;else{if(0<=b.vibrato||!(b.vibrato&1))b.vibrato&32?(b.vibDelta+=
b.vibSpeed,m=b.vibDepth<<1,b.vibDelta>=m&&(b.vibrato&=-33,b.vibDelta=m)):(b.vibDelta-=b.vibSpeed,0>b.vibDelta&&(b.vibrato|=32,b.vibDelta=0));if(m=b.vibDelta-b.vibDepth){for(f+=160;256>f;)m+=m,f+=24;d+=m}}3>this.variant&&(b.vibrato^=1);b.info&32&&(f=b.infoPrev,3<this.variant?0>f?(b.portaDelta+=-f,f=b.portaDelta*d,d+=f>>10):(b.portaDelta+=f,f=b.portaDelta*d,d-=f>>10):0>f?(b.portaDelta+=-f<<11,d+=b.portaDelta>>16):(b.portaDelta+=f<<11,d-=b.portaDelta>>16));f=3<this.variant?b.volFade*b.volume/100:b.volume;
a.period=d;a.volume=f;b.enabled&&(a.enabled=1,a.pointer=b.loopPtr,a.length=b.repeat);b=b.next}}}});d.voices[0]=g(0);d.voices[0].next=d.voices[1]=g(1);d.voices[1].next=d.voices[2]=g(2);d.voices[2].next=d.voices[3]=g(3);return Object.seal(d)}})();(function(){function g(a){return Object.create(null,{index:{value:a,writable:!0},next:{value:null,writable:!0},channel:{value:null,writable:!0},sample:{value:null,writable:!0},enabled:{value:0,writable:!0},period:{value:0,writable:!0},effect:{value:0,writable:!0},
param:{value:0,writable:!0},volume:{value:0,writable:!0},portaDir:{value:0,writable:!0},portaPeriod:{value:0,writable:!0},portaSpeed:{value:0,writable:!0},vibratoPos:{value:0,writable:!0},vibratoSpeed:{value:0,writable:!0},initialize:{value:function(){this.sample=this.channel=null;this.vibratoSpeed=this.vibratoPos=this.portaSpeed=this.portaPeriod=this.portaDir=this.volume=this.param=this.effect=this.period=this.enabled=0}}})}var p=[856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,
320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,113,0],d=[0,24,49,74,97,120,141,161,180,197,212,224,235,244,250,253,255,253,250,244,235,224,212,197,180,161,141,120,97,74,49,24];window.neoart.MKPlayer=function(a){a=B(a);Object.defineProperties(a,{id:{value:"MKPlayer"},track:{value:null,writable:!0},patterns:{value:[],writable:!0},samples:{value:[],writable:!0},length:{value:0,writable:!0},restart:{value:0,writable:!0},voices:{value:[],writable:!0},trackPos:{value:0,writable:!0},
patternPos:{value:0,writable:!0},jumpFlag:{value:0,writable:!0},vibratoDepth:{value:0,writable:!0},restartSave:{value:0,writable:!0},force:{set:function(a){1>a?a=1:5<a&&(a=5);this.version=a;this.vibratoDepth=5==a?6:7;3==a?(this.restartSave=this.restart,this.restart=0):(this.restart=this.restartSave,this.restartSave=0)}},initialize:{value:function(){var a=this.voices[0];this.reset();this.force=this.version;this.speed=6;for(this.jumpFlag=this.patternPos=this.trackPos=0;a;)a.initialize(),a.channel=this.mixer.channels[a.index],
a.sample=this.samples[0],a=a.next}},loader:{value:function(a){var d=0,c,e,f=0,b;if(!(2106>a.length)&&(a.position=1080,c=a.readString(4),"M.K."==c||"FLT4"==c)){a.position=0;this.title=a.readString(20);this.version=1;a.position+=22;for(c=1;32>c;++c)(b=a.readUshort())?(e=A(),a.position-=24,e.name=a.readString(22),e.length=b<<1,a.position+=3,e.volume=a.readUbyte(),e.loop=a.readUshort()<<1,e.repeat=a.readUshort()<<1,a.position+=22,e.pointer=f,f+=e.length,this.samples[c]=e,32768<e.length&&(this.version=
2)):(this.samples[c]=null,a.position+=28);a.position=950;this.length=a.readUbyte();b=a.readUbyte();this.restart=b<length?b:0;for(c=0;128>c;++c)b=a.readUbyte()<<8,this.track[c]=b,b>d&&(d=b);a.position=1084;d+=256;this.patterns.length=d;for(c=0;c<d;++c){e=C();b=a.readUint();e.note=b>>16&4095;e.effect=b>>8&15;e.sample=b>>24&240|b>>12&15;e.param=b&255;this.patterns[c]=e;if(31<e.sample||!this.samples[e.sample])e.sample=0;if(3==e.effect||4==e.effect)this.version=3;if(5==e.effect||6==e.effect)this.version=
5;if(6<e.effect&&10>e.effect){this.version=0;return}}this.mixer.store(a,f);for(c=1;32>c;++c)if(e=this.samples[c])for(-1<e.name.indexOf("2.0")&&(this.version=5),e.loop?(e.loopPtr=e.pointer+e.loop,e.length=e.loop+e.repeat):(e.loopPtr=this.mixer.memory.length,e.repeat=2),f=e.pointer+4,a=e.pointer;a<f;++a)this.mixer.memory[a]=0;e=A();e.pointer=e.loopPtr=this.mixer.memory.length;e.length=e.repeat=2;this.samples[0]=e;5>this.version&&127!=this.restart&&(this.version=4)}}},process:{value:function(){var a,
m,c,e,f,b,k=this.voices[0];if(this.tick)for(;k;){a=k.channel;if(k.effect||k.param){switch(k.effect){case 0:f=this.tick%3;if(!f){a.period=k.period;k=k.next;continue}f=1==f?k.param>>4:k.param&15;e=k.period&4095;c=37-f;for(m=0;m<c;++m)if(e>=p[m]){a.period=p[m+f];break}break;case 1:k.period-=k.param;113>k.period&&(k.period=113);a.period=k.period;break;case 2:k.period+=k.param;856<k.period&&(k.period=856);a.period=k.period;break;case 3:case 5:5==k.effect?b=1:k.param&&(k.portaSpeed=k.param,k.param=0);k.portaPeriod&&
(k.portaDir?(k.period-=k.portaSpeed,k.period<=k.portaPeriod&&(k.period=k.portaPeriod,k.portaPeriod=0)):(k.period+=k.portaSpeed,k.period>=k.portaPeriod&&(k.period=k.portaPeriod,k.portaPeriod=0)));a.period=k.period;break;case 4:case 6:6==k.effect?b=1:k.param&&(k.vibratoSpeed=k.param);f=k.vibratoPos>>2&31;f=(k.vibratoSpeed&15)*d[f]>>this.vibratoDepth;a.period=127<k.vibratoPos?k.period-f:k.period+f;f=k.vibratoSpeed>>2&60;k.vibratoPos=k.vibratoPos+f&255;break;case 10:b=1}b&&(f=k.param>>4,b=0,k.volume=
f?k.volume+f:k.volume-(k.param&15),0>k.volume?k.volume=0:64<k.volume&&(k.volume=64),a.volume=k.volume)}else a.period=k.period;k=k.next}else for(m=this.track[this.trackPos]+this.patternPos;k;){a=k.channel;k.enabled=0;f=this.patterns[m+k.index];k.effect=f.effect;k.param=f.param;f.sample?(c=k.sample=this.samples[f.sample],a.volume=k.volume=c.volume):c=k.sample;f.note&&(3==k.effect||5==k.effect?f.note<k.period?(k.portaDir=1,k.portaPeriod=f.note):f.note>k.period?(k.portaDir=0,k.portaPeriod=f.note):k.portaPeriod=
0:(k.enabled=1,k.vibratoPos=0,a.enabled=0,a.pointer=c.pointer,a.length=c.length,a.period=k.period=f.note));switch(k.effect){case 11:this.trackPos=k.param-1;this.jumpFlag^=1;break;case 12:a.volume=k.param;5==this.version&&(k.volume=k.param);break;case 13:this.jumpFlag^=1;break;case 14:this.mixer.filter.active=k.param^1;break;case 15:f=k.param,1>f?f=1:31<f&&(f=31),this.speed=f,this.tick=0}k.enabled&&(a.enabled=1);a.pointer=c.loopPtr;a.length=c.repeat;k=k.next}++this.tick==this.speed&&(this.tick=0,this.patternPos+=
4,256==this.patternPos||this.jumpFlag)&&(this.patternPos=this.jumpFlag=0,this.trackPos=++this.trackPos&127,this.trackPos==this.length&&(this.trackPos=this.restart,this.mixer.complete=1))}}});a.voices[0]=g(0);a.voices[0].next=a.voices[1]=g(1);a.voices[1].next=a.voices[2]=g(2);a.voices[2].next=a.voices[3]=g(3);a.track=new Uint16Array(128);return Object.seal(a)}})();(function(){function g(a){return Object.create(null,{index:{value:a,writable:!0},next:{value:null,writable:!0},channel:{value:null,writable:!0},
sample:{value:null,writable:!0},enabled:{value:0,writable:!0},loopCtr:{value:0,writable:!0},loopPos:{value:0,writable:!0},step:{value:0,writable:!0},period:{value:0,writable:!0},effect:{value:0,writable:!0},param:{value:0,writable:!0},volume:{value:0,writable:!0},pointer:{value:0,writable:!0},length:{value:0,writable:!0},loopPtr:{value:0,writable:!0},repeat:{value:0,writable:!0},finetune:{value:0,writable:!0},offset:{value:0,writable:!0},portaDir:{value:0,writable:!0},portaPeriod:{value:0,writable:!0},
portaSpeed:{value:0,writable:!0},glissando:{value:0,writable:!0},tremoloParam:{value:0,writable:!0},tremoloPos:{value:0,writable:!0},tremoloWave:{value:0,writable:!0},vibratoParam:{value:0,writable:!0},vibratoPos:{value:0,writable:!0},vibratoWave:{value:0,writable:!0},funkPos:{value:0,writable:!0},funkSpeed:{value:0,writable:!0},funkWave:{value:0,writable:!0},initialize:{value:function(){this.sample=this.channel=null;this.funkWave=this.funkSpeed=this.funkPos=this.vibratoWave=this.vibratoPos=this.vibratoParam=
this.tremoloWave=this.tremoloPos=this.tremoloParam=this.glissando=this.portaSpeed=this.portaPeriod=this.portaDir=this.offset=this.finetune=this.repeat=this.loopPtr=this.length=this.pointer=this.volume=this.param=this.effect=this.period=this.step=this.loopPos=this.loopCtr=this.enabled=0}}})}function p(){var a=A();Object.defineProperties(a,{finetune:{value:0,writable:!0},realLen:{value:0,writable:!0}});return Object.seal(a)}var d=[856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,
320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,113,0,850,802,757,715,674,637,601,567,535,505,477,450,425,401,379,357,337,318,300,284,268,253,239,225,213,201,189,179,169,159,150,142,134,126,119,113,0,844,796,752,709,670,632,597,563,532,502,474,447,422,398,376,355,335,316,298,282,266,251,237,224,211,199,188,177,167,158,149,141,133,125,118,112,0,838,791,746,704,665,628,592,559,528,498,470,444,419,395,373,352,332,314,296,280,264,249,235,222,209,198,187,176,166,157,148,140,132,
125,118,111,0,832,785,741,699,660,623,588,555,524,495,467,441,416,392,370,350,330,312,294,278,262,247,233,220,208,196,185,175,165,156,147,139,131,124,117,110,0,826,779,736,694,655,619,584,551,520,491,463,437,413,390,368,347,328,309,292,276,260,245,232,219,206,195,184,174,164,155,146,138,130,123,116,109,0,820,774,730,689,651,614,580,547,516,487,460,434,410,387,365,345,325,307,290,274,258,244,230,217,205,193,183,172,163,154,145,137,129,122,115,109,0,814,768,725,684,646,610,575,543,513,484,457,431,407,
384,363,342,323,305,288,272,256,242,228,216,204,192,181,171,161,152,144,136,128,121,114,108,0,907,856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,0,900,850,802,757,715,675,636,601,567,535,505,477,450,425,401,379,357,337,318,300,284,268,253,238,225,212,200,189,179,169,159,150,142,134,126,119,0,894,844,796,752,709,670,632,597,563,532,502,474,447,422,398,376,355,335,316,298,282,266,251,237,223,211,199,188,177,
167,158,149,141,133,125,118,0,887,838,791,746,704,665,628,592,559,528,498,470,444,419,395,373,352,332,314,296,280,264,249,235,222,209,198,187,176,166,157,148,140,132,125,118,0,881,832,785,741,699,660,623,588,555,524,494,467,441,416,392,370,350,330,312,294,278,262,247,233,220,208,196,185,175,165,156,147,139,131,123,117,0,875,826,779,736,694,655,619,584,551,520,491,463,437,413,390,368,347,328,309,292,276,260,245,232,219,206,195,184,174,164,155,146,138,130,123,116,0,868,820,774,730,689,651,614,580,547,
516,487,460,434,410,387,365,345,325,307,290,274,258,244,230,217,205,193,183,172,163,154,145,137,129,122,115,0,862,814,768,725,684,646,610,575,543,513,484,457,431,407,384,363,342,323,305,288,272,256,242,228,216,203,192,181,171,161,152,144,136,128,121,114,0],a=[0,24,49,74,97,120,141,161,180,197,212,224,235,244,250,253,255,253,250,244,235,224,212,197,180,161,141,120,97,74,49,24],l=[0,5,6,7,8,10,11,13,16,19,22,26,32,43,64,128];window.neoart.PTPlayer=function(m){m=B(m);Object.defineProperties(m,{id:{value:"PTPlayer"},
track:{value:null,writable:!0},patterns:{value:[],writable:!0},samples:{value:[],writable:!0},length:{value:0,writable:!0},voices:{value:[],writable:!0},trackPos:{value:0,writable:!0},patternPos:{value:0,writable:!0},patternBreak:{value:0,writable:!0},patternDelay:{value:0,writable:!0},breakPos:{value:0,writable:!0},jumpFlag:{value:0,writable:!0},vibratoDepth:{value:0,writable:!0},force:{set:function(c){1>c?c=1:3<c&&(c=3);this.version=c;this.vibratoDepth=2>c?6:7}},initialize:{value:function(){var c=
this.voices[0];this.tempo=125;this.speed=6;this.jumpFlag=this.breakPos=this.patternDelay=this.patternBreak=this.patternPos=this.trackPos=0;this.reset();for(this.force=this.version;c;)c.initialize(),c.channel=this.mixer.channels[c.index],c.sample=this.samples[0],c=c.next}},loader:{value:function(c){var a=0,d,b,m=0,h;if(!(2106>c.length)&&(c.position=1080,d=c.readString(4),"M.K."==d||"M!K!"==d)){c.position=0;this.title=c.readString(20);this.version=1;c.position+=22;for(d=1;32>d;++d)(h=c.readUshort())?
(b=p(),c.position-=24,b.name=c.readString(22),b.length=b.realLen=h<<1,c.position+=2,b.finetune=37*c.readUbyte(),b.volume=c.readUbyte(),b.loop=c.readUshort()<<1,b.repeat=c.readUshort()<<1,c.position+=22,b.pointer=m,m+=b.length,this.samples[d]=b):(this.samples[d]=null,c.position+=28);c.position=950;this.length=c.readUbyte();c.position++;for(d=0;128>d;++d)h=c.readUbyte()<<8,this.track[d]=h,h>a&&(a=h);c.position=1084;a+=256;this.patterns.length=a;for(d=0;d<a;++d){h=C();Object.defineProperties(h,{step:{value:0,
writable:!0}});b=Object.seal(h);b.step=h=c.readUint();b.note=h>>16&4095;b.effect=h>>8&15;b.sample=h>>24&240|h>>12&15;b.param=h&255;this.patterns[d]=b;if(31<b.sample||!this.samples[b.sample])b.sample=0;15==b.effect&&31<b.param&&(this.version=2);8==b.effect&&(this.version=3)}this.mixer.store(c,m);for(d=1;32>d;++d)if(b=this.samples[d])for(b.loop||4<b.repeat?(b.loopPtr=b.pointer+b.loop,b.length=b.loop+b.repeat):(b.loopPtr=this.mixer.memory.length,b.repeat=2),m=b.pointer+2,c=b.pointer;c<m;++c)this.mixer.memory[c]=
0;b=p();b.pointer=b.loopPtr=this.mixer.memory.length;b.length=b.repeat=2;this.samples[0]=b}}},process:{value:function(){var c,a,f,b,m,h=this.voices[0];if(this.tick)this.effects();else if(this.patternDelay)this.effects();else{for(f=this.track[this.trackPos]+this.patternPos;h;){c=h.channel;h.enabled=0;h.step||(c.period=h.period);b=this.patterns[f+h.index];h.step=b.step;h.effect=b.effect;h.param=b.param;b.sample&&(a=h.sample=this.samples[b.sample],h.pointer=a.pointer,h.length=a.length,h.loopPtr=h.funkWave=
a.loopPtr,h.repeat=a.repeat,h.finetune=a.finetune,c.volume=h.volume=a.volume);if(b.note){if(3664==(h.step&4080))h.finetune=37*(h.param&15);else if(3==h.effect||5==h.effect)if(b.note==h.period)h.portaPeriod=0;else{a=h.finetune;for(m=a+37;a<m&&!(b.note>=d[a]);++a);0<a&&(m=h.finetune/37>>0&8)&&a--;h.portaPeriod=d[a];h.portaDir=b.note>h.portaPeriod?0:1}else 9==h.effect&&this.moreEffects(h);for(a=0;37>a&&!(b.note>=d[a]);++a);h.period=d[h.finetune+a];3792==(h.step&4080)?(h.funkSpeed&&this.updateFunk(h),
this.extended(h)):(4>h.vibratoWave&&(h.vibratoPos=0),4>h.tremoloWave&&(h.tremoloPos=0),c.enabled=0,c.pointer=h.pointer,c.length=h.length,c.period=h.period,h.enabled=1,this.moreEffects(h))}else this.moreEffects(h);h=h.next}for(h=this.voices[0];h;)c=h.channel,h.enabled&&(c.enabled=1),c.pointer=h.loopPtr,c.length=h.repeat,h=h.next}++this.tick==this.speed&&(this.tick=0,this.patternPos+=4,this.patternDelay&&--this.patternDelay&&(this.patternPos-=4),this.patternBreak&&(this.patternBreak=0,this.patternPos=
this.breakPos,this.breakPos=0),256==this.patternPos||this.jumpFlag)&&(this.patternPos=this.breakPos,this.jumpFlag=this.breakPos=0,++this.trackPos==this.length&&(this.trackPos=0,this.mixer.complete=1))}},effects:{value:function(){for(var c,e,f,b,m,h=this.voices[0];h;){c=h.channel;h.funkSpeed&&this.updateFunk(h);if(0==(h.step&4095))c.period=h.period;else{switch(h.effect){case 0:m=this.tick%3;if(!m){c.period=h.period;h=h.next;continue}m=1==m?h.param>>4:h.param&15;e=h.finetune;for(f=e+37;e<f;++e)if(h.period>=
d[e]){c.period=d[e+m];break}break;case 1:h.period-=h.param;113>h.period&&(h.period=113);c.period=h.period;break;case 2:h.period+=h.param;856<h.period&&(h.period=856);c.period=h.period;break;case 3:case 5:5==h.effect?b=1:(h.portaSpeed=h.param,h.param=0);if(h.portaPeriod)if(h.portaDir?(h.period-=h.portaSpeed,h.period<=h.portaPeriod&&(h.period=h.portaPeriod,h.portaPeriod=0)):(h.period+=h.portaSpeed,h.period>=h.portaPeriod&&(h.period=h.portaPeriod,h.portaPeriod=0)),h.glissando){e=h.finetune;for(m=e+37;e<
m&&!(h.period>=d[e]);++e);e==m&&e--;c.period=d[e]}else c.period=h.period;break;case 4:case 6:if(6==h.effect)b=1;else if(h.param){if(m=h.param&15)h.vibratoParam=h.vibratoParam&240|m;if(m=h.param&240)h.vibratoParam=h.vibratoParam&15|m}f=h.vibratoPos>>2&31;(e=h.vibratoWave&3)?(m=255,f<<=3,1==e&&(m=127<h.vibratoPos?m-f:f)):m=a[f];m=(h.vibratoParam&15)*m>>this.vibratoDepth;c.period=127<h.vibratoPos?h.period-m:h.period+m;m=h.vibratoParam>>2&60;h.vibratoPos=h.vibratoPos+m&255;break;case 7:c.period=h.period;
if(h.param){if(m=h.param&15)h.tremoloParam=h.tremoloParam&240|m;if(m=h.param&240)h.tremoloParam=h.tremoloParam&15|m}f=h.tremoloPos>>2&31;(e=h.tremoloWave&3)?(m=255,f<<=3,1==e&&(m=127<h.tremoloPos?m-f:f)):m=a[f];m=(h.tremoloParam&15)*m>>6;c.volume=127<h.tremoloPos?h.volume-m:h.volume+m;m=h.tremoloParam>>2&60;h.tremoloPos=h.tremoloPos+m&255;break;case 10:b=1;break;case 14:this.extended(h)}b&&(b=0,m=h.param>>4,h.volume=m?h.volume+m:h.volume-(h.param&15),0>h.volume?h.volume=0:64<h.volume&&(h.volume=64),
c.volume=h.volume)}h=h.next}}},moreEffects:{value:function(c){var a=c.channel;c.funkSpeed&&this.updateFunk(c);switch(c.effect){case 9:c.param&&(c.offset=c.param);a=c.offset<<8;a>=c.length?c.length=2:(c.pointer+=a,c.length-=a);break;case 11:this.trackPos=c.param-1;this.breakPos=0;this.jumpFlag=1;break;case 12:c.volume=c.param;64<c.volume&&(c.volume=64);a.volume=c.volume;break;case 13:this.breakPos=10*(c.param>>4)+(c.param&15);this.breakPos=63<this.breakPos?0:this.breakPos<<2;this.jumpFlag=1;break;
case 14:this.extended(c);break;case 15:if(!c.param)break;32>c.param?this.speed=c.param:this.mixer.samplesTick=2.5*this.sampleRate/c.param>>0;this.tick=0}}},extended:{value:function(c){var a=c.channel,d;d=c.param&15;switch(c.param>>4){case 0:this.mixer.filter.active=d;break;case 1:if(this.tick)break;c.period-=d;113>c.period&&(c.period=113);a.period=c.period;break;case 2:if(this.tick)break;c.period+=d;856<c.period&&(c.period=856);a.period=c.period;break;case 3:c.glissando=d;break;case 4:c.vibratoWave=
d;break;case 5:c.finetune=37*d;break;case 6:if(this.tick)break;d?(c.loopCtr?c.loopCtr--:c.loopCtr=d,c.loopCtr&&(this.breakPos=c.loopPos<<2,this.patternBreak=1)):c.loopPos=this.patternPos>>2;break;case 7:c.tremoloWave=d;break;case 8:a=c.length-2;d=this.mixer.memory;for(c=c.loopPtr;c<a;)d[c]=0.5*(d[c]+d[++c]);d[++c]=0.5*(d[c]+d[0]);break;case 9:if(this.tick||!d||!c.period)break;if(this.tick%d)break;a.enabled=0;a.pointer=c.pointer;a.length=c.length;a.delay=30;a.enabled=1;a.pointer=c.loopPtr;a.length=
c.repeat;a.period=c.period;break;case 10:if(this.tick)break;c.volume+=d;64<c.volume&&(c.volume=64);a.volume=c.volume;break;case 11:if(this.tick)break;c.volume-=d;0>c.volume&&(c.volume=0);a.volume=c.volume;break;case 12:this.tick==d&&(a.volume=c.volume=0);break;case 13:if(this.tick!=d||!c.period)break;a.enabled=0;a.pointer=c.pointer;a.length=c.length;a.delay=30;a.enabled=1;a.pointer=c.loopPtr;a.length=c.repeat;a.period=c.period;break;case 14:if(this.tick||this.patternDelay)break;this.patternDelay=
++d;break;case 15:if(this.tick)break;(c.funkSpeed=d)&&this.updateFunk(c)}}},updateFunk:{value:function(c){var a=c.channel,d,b;c.funkPos+=l[c.funkSpeed];128>c.funkPos||(c.funkPos=0,1==this.version?(d=c.pointer+c.sample.realLen-c.repeat,b=c.funkWave+c.repeat,b>d&&(b=c.loopPtr,a.length=c.repeat),a.pointer=c.funkWave=b):(d=c.loopPtr+c.repeat,b=c.funkWave+1,b>=d&&(b=c.loopPtr),this.mixer.memory[b]=-this.mixer.memory[b]))}}});m.voices[0]=g(0);m.voices[0].next=m.voices[1]=g(1);m.voices[1].next=m.voices[2]=
g(2);m.voices[2].next=m.voices[3]=g(3);m.track=new Uint16Array(128);return Object.seal(m)}})();(function(){function g(d,a){return Object.create(null,{index:{value:d,writable:!0},bitFlag:{value:a,writable:!0},next:{value:null,writable:!0},channel:{value:null,writable:!0},sample:{value:null,writable:!0},trackPtr:{value:0,writable:!0},trackPos:{value:0,writable:!0},patternPos:{value:0,writable:!0},tick:{value:0,writable:!0},busy:{value:0,writable:!0},flags:{value:0,writable:!0},note:{value:0,writable:!0},
period:{value:0,writable:!0},volume:{value:0,writable:!0},portaSpeed:{value:0,writable:!0},vibratoPtr:{value:0,writable:!0},vibratoPos:{value:0,writable:!0},synthPos:{value:0,writable:!0},initialize:{value:function(){this.sample=this.channel=null;this.patternPos=this.trackPos=this.trackPtr=0;this.busy=this.tick=1;this.synthPos=this.vibratoPos=this.vibratoPtr=this.portaSpeed=this.volume=this.period=this.note=this.flags=0}}})}function p(){var d=A();Object.defineProperties(d,{relative:{value:0,writable:!0},
divider:{value:0,writable:!0},vibrato:{value:0,writable:!0},hiPos:{value:0,writable:!0},loPos:{value:0,writable:!0},wave:{value:[],writable:!0}});return Object.seal(d)}window.neoart.RHPlayer=function(d){d=B(d);Object.defineProperties(d,{id:{value:"RHPlayer"},songs:{value:[],writable:!0},samples:{value:[],writable:!0},song:{value:null,writable:!0},periods:{value:0,writable:!0},vibrato:{value:0,writable:!0},voices:{value:[],writable:!0},stream:{value:null,writable:!0},complete:{value:0,writable:!0},
variant:{value:0,writable:!0},initialize:{value:function(){var a,d,m,c=this.voices[3];this.reset();this.song=this.songs[this.playSong];this.complete=15;for(a=0;a<this.samples.length;++a)if(m=this.samples[a],m.wave.length)for(d=0;d<m.length;++d)this.mixer.memory[m.pointer+d]=m.wave[d];for(;c;)c.initialize(),c.channel=this.mixer.channels[c.index],c.trackPtr=this.song.tracks[c.index],c.trackPos=4,this.stream.position=c.trackPtr,c.patternPos=this.stream.readUint(),c=c.next}},loader:{value:function(a){var d,
m,c,e,f,b,k,h;for(a.position=44;1024>a.position;)if(f=a.readUshort(),32272==f||32288==f)f=a.readUshort(),16890==f&&(d=a.position+a.readUshort(),f=a.readUshort(),53756==f?(b=d+a.readUint(),this.mixer.loopLen=64,a.position+=2):(b=d,this.mixer.loopLen=512),c=a.position+a.readUshort(),f=a.readUbyte(),114==f&&(m=a.readUbyte()));else if(20937==f){if(a.position+=2,f=a.readUshort(),17914==f)for(h=a.position+a.readUshort(),a.position+=2;;)if(f=a.readUshort(),19450==f){e=a.position+a.readUshort();break}}else if(49404==
f)a.position+=2,f=a.readUshort(),16875==f&&(k=a.readUshort());else if(13421==f)a.position+=2,f=a.readUshort(),18938==f&&(this.vibrato=a.position+a.readUshort());else if(16960==f&&(f=a.readUshort(),17914==f)){this.periods=a.position+a.readUshort();break}if(c&&b&&m&&k){a.position=b;this.samples=[];m++;for(d=0;d<m;++d)f=p(),f.length=a.readUint(),f.relative=parseInt(3579545/a.readUshort()),f.pointer=this.mixer.store(a,f.length),this.samples[d]=f;a.position=c;for(d=0;d<m;++d)f=this.samples[d],a.position+=
4,f.loopPtr=a.readInt(),a.position+=6,f.volume=a.readUshort(),e&&(f.divider=a.readUshort(),f.vibrato=a.readUshort(),f.hiPos=a.readUshort(),f.loPos=a.readUshort(),a.position+=8);if(e){a.position=e;d=e-c>>5;c=d+3;this.variant=1;if(d>=m)for(;m<d;++m)this.samples[m]=p();for(;d<c;++d){f=p();a.position+=4;f.loopPtr=a.readInt();f.length=a.readUshort();f.relative=a.readUshort();a.position+=2;f.volume=a.readUshort();f.divider=a.readUshort();f.vibrato=a.readUshort();f.hiPos=a.readUshort();f.loPos=a.readUshort();
e=a.position;a.position=h;a.position=a.readInt();f.pointer=this.mixer.memory.length;this.mixer.memory.length+=f.length;for(m=0;m<f.length;++m)f.wave[m]=a.readByte();this.samples[d]=f;h+=4;a.position=e}}a.position=k;this.songs=[];for(f=65536;;){k=Object.create(null,{speed:{value:0,writable:!0},tracks:{value:null,writable:!0}});a.position++;k.tracks=new Uint32Array(4);k.speed=a.readUbyte();for(d=0;4>d;++d)m=a.readUint(),m<f&&(f=m),k.tracks[d]=m;this.songs.push(k);if(18>f-a.position)break}this.lastSong=
this.songs.length-1;a.length=b;for(a.position=352;512>a.position;)f=a.readUshort(),45116==f&&(f=a.readUshort(),133==f?this.variant=2:134==f?this.variant=4:135==f&&(this.variant=3));this.stream=a;this.version=1}}},process:{value:function(){for(var a,d,m,c,e=this.voices[3];e;){a=e.channel;this.stream.position=e.patternPos;m=e.sample;e.busy||(e.busy=1,0==m.loopPtr?(a.pointer=this.mixer.loopPtr,a.length=this.mixer.loopLen):0<m.loopPtr&&(a.pointer=m.pointer+m.loopPtr,a.length=m.length-m.loopPtr));if(0==
--e.tick)for(e.flags=0,d=1;d;)if(c=this.stream.readByte(),0>c)switch(c){case -121:3==this.variant&&(e.volume=this.stream.readUbyte());break;case -122:4==this.variant&&(e.volume=this.stream.readUbyte());break;case -123:1<this.variant&&(this.mixer.complete=1);break;case -124:this.stream.position=e.trackPtr+e.trackPos;c=this.stream.readUint();e.trackPos+=4;c||(this.stream.position=e.trackPtr,c=this.stream.readUint(),e.trackPos=4,this.loopSong||(this.complete&=~e.bitFlag,this.complete||(this.mixer.complete=
1)));this.stream.position=c;break;case -125:4==this.variant&&(e.flags|=4);break;case -126:e.tick=this.song.speed*this.stream.readByte();e.patternPos=this.stream.position;a.pointer=this.mixer.loopPtr;a.length=this.mixer.loopLen;d=0;break;case -127:e.portaSpeed=this.stream.readByte();e.flags|=1;break;case -128:c=this.stream.readByte(),0>c&&(c=0),e.sample=m=this.samples[c],e.vibratoPtr=this.vibrato+m.vibrato,e.vibratoPos=e.vibratoPtr}else e.tick=this.song.speed*c,e.note=this.stream.readByte(),e.patternPos=
this.stream.position,e.synthPos=m.loPos,e.vibratoPos=e.vibratoPtr,a.pointer=m.pointer,a.length=m.length,a.volume=e.volume?e.volume:m.volume,this.stream.position=this.periods+(e.note<<1),c=this.stream.readUshort()*m.relative,a.period=e.period=c>>10,a.enabled=1,e.busy=d=0;else 1!=e.tick||4==this.variant&&e.flags&4||(a.enabled=0),e.flags&1&&(a.period=e.period+=e.portaSpeed),m.divider&&(this.stream.position=e.vibratoPos,c=this.stream.readByte(),-124==c&&(this.stream.position=e.vibratoPtr,c=this.stream.readByte()),
e.vibratoPos=this.stream.position,c*=parseInt(e.period/m.divider),a.period=e.period+c);m.hiPos&&(c=0,e.flags&2?(e.synthPos--,e.synthPos<=m.loPos&&(e.flags&=-3,c=60)):(e.synthPos++,e.synthPos>m.hiPos&&(e.flags|=2,c=60)),this.mixer.memory[m.pointer+e.synthPos]=c);e=e.next}}}});d.voices[3]=g(3,8);d.voices[3].next=d.voices[2]=g(2,4);d.voices[2].next=d.voices[1]=g(1,2);d.voices[1].next=d.voices[0]=g(0,1);return Object.seal(d)}})();(function(){function g(a){return Object.create(null,{index:{value:a,writable:!0},
next:{value:null,writable:!0},channel:{value:null,writable:!0},step:{value:0,writable:!0},row:{value:0,writable:!0},sample:{value:0,writable:!0},samplePtr:{value:0,writable:!0},sampleLen:{value:0,writable:!0},note:{value:0,writable:!0},noteTimer:{value:0,writable:!0},period:{value:0,writable:!0},volume:{value:0,writable:!0},bendTo:{value:0,writable:!0},bendSpeed:{value:0,writable:!0},arpeggioCtr:{value:0,writable:!0},envelopeCtr:{value:0,writable:!0},pitchCtr:{value:0,writable:!0},pitchFallCtr:{value:0,
writable:!0},sustainCtr:{value:0,writable:!0},phaseTimer:{value:0,writable:!0},phaseSpeed:{value:0,writable:!0},wavePos:{value:0,writable:!0},waveList:{value:0,writable:!0},waveTimer:{value:0,writable:!0},waitCtr:{value:0,writable:!0},initialize:{value:function(){this.sample=this.row=this.step=0;this.samplePtr=-1;this.noteTimer=this.note=this.sampleLen=0;this.period=39321;this.waitCtr=this.waveTimer=this.waveList=this.wavePos=this.phaseSpeed=this.phaseTimer=this.sustainCtr=this.pitchFallCtr=this.pitchCtr=
this.envelopeCtr=this.arpeggioCtr=this.bendSpeed=this.bendTo=this.volume=0}}})}function p(){var a=A();Object.defineProperties(a,{waveform:{value:0,writable:!0},arpeggio:{value:null,writable:!0},attackSpeed:{value:0,writable:!0},attackMax:{value:0,writable:!0},decaySpeed:{value:0,writable:!0},decayMin:{value:0,writable:!0},sustain:{value:0,writable:!0},releaseSpeed:{value:0,writable:!0},releaseMin:{value:0,writable:!0},phaseShift:{value:0,writable:!0},phaseSpeed:{value:0,writable:!0},finetune:{value:0,
writable:!0},pitchFall:{value:0,writable:!0}});a.arpeggio=new Uint8Array(16);return Object.seal(a)}var d=[1166,408,908],a=[0,5760,5424,5120,4832,4560,4304,4064,3840,3616,3424,3232,3048,2880,2712,2560,2416,2280,2152,2032,1920,1808,1712,1616,1524,1440,1356,1280,1208,1140,1076,1016,960,904,856,808,762,720,678,640,604,570,538,508,480,452,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,0,0,0,0,0,0,0,4028,3806,3584,3394,3204,3013,2855,2696,2538,2395,2268,2141,2014,
1903,1792,1697,1602,1507,1428,1348,1269,1198,1134,1071,1007,952,896,849,801,754,714,674,635,599,567,536,504,476,448,425,401,377,357,337,310,300,284,268,252,238,224,213,201,189,179,169,159,150,142,134,0,0,0,0,0,0,0,3993,3773,3552,3364,3175,2987,2830,2672,2515,2374,2248,2122,1997,1887,1776,1682,1588,1494,1415,1336,1258,1187,1124,1061,999,944,888,841,794,747,708,668,629,594,562,531,500,472,444,421,397,374,354,334,315,297,281,266,250,236,222,211,199,187,177,167,158,149,141,133,0,0,0,0,0,0,0,3957,3739,
3521,3334,3147,2960,2804,2648,2493,2353,2228,2103,1979,1870,1761,1667,1574,1480,1402,1324,1247,1177,1114,1052,990,935,881,834,787,740,701,662,624,589,557,526,495,468,441,417,394,370,351,331,312,295,279,263,248,234,221,209,197,185,176,166,156,148,140,132,0,0,0,0,0,0,0,3921,3705,3489,3304,3119,2933,2779,2625,2470,2331,2208,2084,1961,1853,1745,1652,1560,1467,1390,1313,1235,1166,1104,1042,981,927,873,826,780,734,695,657,618,583,552,521,491,464,437,413,390,367,348,329,309,292,276,261,246,232,219,207,195,
184,174,165,155,146,138,131,0,0,0,0,0,0,0,3886,3671,3457,3274,3090,2907,2754,2601,2448,2310,2188,2065,1943,1836,1729,1637,1545,1454,1377,1301,1224,1155,1094,1033,972,918,865,819,773,727,689,651,612,578,547,517,486,459,433,410,387,364,345,326,306,289,274,259,243,230,217,205,194,182,173,163,153,145,137,130,0,0,0,0,0,0,0,3851,3638,3426,3244,3062,2880,2729,2577,2426,2289,2168,2047,1926,1819,1713,1622,1531,1440,1365,1289,1213,1145,1084,1024,963,910,857,811,766,720,683,645,607,573,542,512,482,455,429,406,
383,360,342,323,304,287,271,256,241,228,215,203,192,180,171,162,152,144,136,128,6848,6464,6096,5760,5424,5120,4832,4560,4304,4064,3840,3616,3424,3232,3048,2880,2712,2560,2416,2280,2152,2032,1920,1808,1712,1616,1524,1440,1356,1280,1208,1140,1076,1016,960,904,856,808,762,720,678,640,604,570,538,508,480,452,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127];window.neoart.S1Player=function(l){l=B(l);Object.defineProperties(l,{id:{value:"S1Player"},tracksPtr:{value:null,
writable:!0},tracks:{value:[],writable:!0},patternsPtr:{value:null,writable:!0},patterns:{value:[],writable:!0},samples:{value:[],writable:!0},waveLists:{value:null,writable:!0},speedDef:{value:0,writable:!0},patternDef:{value:0,writable:!0},mix1Speed:{value:0,writable:!0},mix2Speed:{value:0,writable:!0},mix1Dest:{value:0,writable:!0},mix2Dest:{value:0,writable:!0},mix1Source1:{value:0,writable:!0},mix1Source2:{value:0,writable:!0},mix2Source1:{value:0,writable:!0},mix2Source2:{value:0,writable:!0},
doFilter:{value:0,writable:!0},doReset:{value:0,writable:!0},voices:{value:[],writable:!0},trackPos:{value:0,writable:!0},trackEnd:{value:0,writable:!0},trackLen:{value:0,writable:!0},patternPos:{value:0,writable:!0},patternEnd:{value:0,writable:!0},patternLen:{value:0,writable:!0},mix1Ctr:{value:0,writable:!0},mix2Ctr:{value:0,writable:!0},mix1Pos:{value:0,writable:!0},mix2Pos:{value:0,writable:!0},audPtr:{value:0,writable:!0},audLen:{value:0,writable:!0},audPer:{value:0,writable:!0},audVol:{value:0,
writable:!0},initialize:{value:function(){var a,c,d=this.voices[0];this.reset();this.tick=this.speed=this.speedDef;this.trackPos=1;this.trackEnd=0;this.patternPos=-1;this.patternEnd=0;this.patternLen=this.patternDef;for(this.mix2Ctr=this.mix2Pos=this.mix1Ctr=this.mix1Pos=0;d;)d.initialize(),a=this.mixer.channels[d.index],d.channel=a,d.step=this.tracksPtr[d.index],c=this.tracks[d.step],d.row=this.patternsPtr[c.pattern],d.sample=this.patterns[d.row].sample,a.length=32,a.period=d.period,a.enabled=1,
d=d.next}},loader:{value:function(a){for(var c,e,f,b,l,h,g,n,s,q,y,H;8<a.bytesAvailable;)if(n=a.readUshort(),16890==n&&(f=a.readUshort(),n=a.readUshort(),53736==n&&(n=a.readUshort(),65492==n))){H=4076==f?4090:5222==f?5188:f;h=f+a.position-6;break}if(h&&(a.position=h,e=a.readString(32)," SID-MON BY R.v.VLIET  (c) 1988 "==e)){a.position=h-44;n=a.readUint();for(e=1;4>e;++e)this.tracksPtr[e]=(a.readUint()-n)/6>>0;a.position=h-8;n=a.readUint();l=a.readUint();l<n&&(l=a.length-h);s=l-n>>2;this.patternsPtr=
new Uint32Array(s);a.position=h+n+4;for(e=1;e<s;++e){n=a.readUint()/5>>0;if(0==n){s=e;break}this.patternsPtr[e]=n}this.patternsPtr.length=s;a.position=h-44;n=a.readUint();a.position=h-28;l=(a.readUint()-n)/6>>0;this.tracks.length=l;a.position=h+n;for(e=0;e<l;++e){n=D();n.pattern=a.readUint();n.pattern>=s&&(n.pattern=0);a.readByte();n.transpose=a.readByte();if(-99>n.transpose||99<n.transpose)n.transpose=0;this.tracks[e]=n}a.position=h-24;n=a.readUint();y=a.readUint()-n;for(e=0;32>e;++e)this.mixer.memory[e]=
0;this.mixer.store(a,y,h+n);y>>=5;a.position=h-16;n=a.readUint();l=a.readUint()-n+16;f=y+2<<4;this.waveLists=new Uint8Array(l<f?f:l);a.position=h+n;for(e=0;e<f;)this.waveLists[e++]=e>>4,this.waveLists[e++]=255,this.waveLists[e++]=255,this.waveLists[e++]=16,e+=12;for(e=16;e<l;++e)this.waveLists[e]=a.readUbyte();a.position=h-20;a.position=h+a.readUint();this.mix1Source1=a.readUint();this.mix2Source1=a.readUint();this.mix1Source2=a.readUint();this.mix2Source2=a.readUint();this.mix1Dest=a.readUint();
this.mix2Dest=a.readUint();this.patternDef=a.readUint();this.trackLen=a.readUint();this.speedDef=a.readUint();this.mix1Speed=a.readUint();this.mix2Speed=a.readUint();this.mix1Source1>y&&(this.mix1Source1=0);this.mix2Source1>y&&(this.mix2Source1=0);this.mix1Source2>y&&(this.mix1Source2=0);this.mix2Source2>y&&(this.mix2Source2=0);this.mix1Dest>y&&(this.mix1Speed=0);this.mix2Dest>y&&(this.mix2Speed=0);0==this.speedDef&&(this.speedDef=4);a.position=h-28;f=a.readUint();s=a.readUint()-f>>5;63<s&&(s=63);
l=s+1;a.position=h-4;n=a.readUint();if(1==n){a.position=1820;n=a.readUshort();if(19962!=n&&(a.position=1788,n=a.readUshort(),19962!=n)){this.version=0;return}a.position+=a.readUshort();this.samples.length=l+3;for(e=0;3>e;++e)g=p(),g.waveform=16+e,g.length=d[e],g.pointer=this.mixer.store(a,g.length),g.loop=g.loopPtr=0,g.repeat=4,g.volume=64,this.samples[l+e]=g,a.position+=g.length}else this.samples.length=l,a.position=h+n,c=a.readUint(),q=(c>>5)+15,b=a.position,c+=b;g=p();this.samples[0]=g;a.position=
h+f;for(e=1;e<l;++e){g=p();g.waveform=a.readUint();for(f=0;16>f;++f)g.arpeggio[f]=a.readUbyte();g.attackSpeed=a.readUbyte();g.attackMax=a.readUbyte();g.decaySpeed=a.readUbyte();g.decayMin=a.readUbyte();g.sustain=a.readUbyte();a.readByte();g.releaseSpeed=a.readUbyte();g.releaseMin=a.readUbyte();g.phaseShift=a.readUbyte();g.phaseSpeed=a.readUbyte();g.finetune=a.readUbyte();g.pitchFall=a.readByte();5188==H?(g.pitchFall=g.finetune,g.finetune=0):(15<g.finetune&&(g.finetune=0),g.finetune*=67);g.phaseShift>
y&&(g.phaseShift=0,g.phaseSpeed=0);if(15<g.waveform)if(15<q&&g.waveform>q)g.waveform=0;else{n=b+(g.waveform-16<<5);if(n>=a.length)continue;f=a.position;a.position=n;g.pointer=a.readUint();g.loop=a.readUint();g.length=a.readUint();g.name=a.readString(20);0==g.loop||99999==g.loop||199999==g.loop||g.loop>=g.length?(g.loop=0,g.repeat=4090==H?2:4):(g.repeat=g.length-g.loop,g.loop-=g.pointer);g.length-=g.pointer;g.length<g.loop+g.repeat&&(g.length=g.loop+g.repeat);g.pointer=this.mixer.store(a,g.length,
c+g.pointer);g.loopPtr=6>g.repeat||0==g.loop?0:g.pointer+g.loop;a.position=f}else g.waveform>y&&(g.waveform=0);this.samples[e]=g}a.position=h-12;n=a.readUint();l=(a.readUint()-n)/5>>0;this.patterns.length=l;a.position=h+n;for(e=0;e<l;++e)c=C(),Object.defineProperties(c,{speed:{value:0,writable:!0}}),c=Object.seal(c),c.note=a.readUbyte(),c.sample=a.readUbyte(),c.effect=a.readUbyte(),c.param=a.readUbyte(),c.speed=a.readUbyte(),5188==H?(0<c.note&&255>c.note&&(c.note+=469),0<c.effect&&255>c.effect&&(c.effect+=
469),59<c.sample&&(c.sample=s+(c.sample-60))):c.sample>s&&(c.sample=0),this.patterns[e]=c;4464==H||4550==H||5188==H?(4464==H&&(this.mix1Speed=this.mix2Speed=0),this.doReset=this.doFilter=0):this.doReset=this.doFilter=1;this.version=1}}},process:{value:function(){var d,c,e,f=this.mixer.memory,b,l;for(l=this.voices[0];l;){d=l.channel;this.audPtr=-1;this.audLen=this.audPer=this.audVol=0;if(0==this.tick)if(this.patternEnd&&(this.trackEnd?l.step=this.tracksPtr[l.index]:l.step++,e=this.tracks[l.step],l.row=
this.patternsPtr[e.pattern],this.doReset&&(l.noteTimer=0)),0==l.noteTimer){b=this.patterns[l.row];0==b.sample?b.note&&(l.noteTimer=b.speed,l.waitCtr&&(c=this.samples[l.sample],this.audPtr=c.pointer,this.audLen=c.length,l.samplePtr=c.loopPtr,l.sampleLen=c.repeat,l.waitCtr=1,d.enabled=0)):(c=this.samples[b.sample],l.waitCtr&&(d.enabled=l.waitCtr=0),15<c.waveform?(this.audPtr=c.pointer,this.audLen=c.length,l.samplePtr=c.loopPtr,l.sampleLen=c.repeat,l.waitCtr=1):(l.wavePos=0,l.waveList=c.waveform,e=l.waveList<<
4,this.audPtr=this.waveLists[e]<<5,this.audLen=32,l.waveTimer=this.waveLists[++e]),l.noteTimer=b.speed,l.sample=b.sample,l.envelopeCtr=l.pitchCtr=l.pitchFallCtr=0);if(b.note&&(l.noteTimer=b.speed,255!=b.note))switch(c=this.samples[l.sample],e=this.tracks[l.step],l.note=b.note+e.transpose,l.period=this.audPer=a[1+c.finetune+l.note],l.phaseSpeed=c.phaseSpeed,l.bendSpeed=l.volume=0,l.envelopeCtr=l.pitchCtr=l.pitchFallCtr=0,b.effect){case 0:if(0==b.param)break;c.attackSpeed=b.param;c.attackMax=b.param;
l.waveTimer=0;break;case 2:this.speed=b.param;l.waveTimer=0;break;case 3:this.patternLen=b.param;l.waveTimer=0;break;default:l.bendTo=b.effect+e.transpose,l.bendSpeed=b.param}l.row++}else l.noteTimer--;c=this.samples[l.sample];this.audVol=l.volume;switch(l.envelopeCtr){case 0:this.audVol+=c.attackSpeed;this.audVol>c.attackMax&&(this.audVol=c.attackMax,l.envelopeCtr+=2);break;case 2:this.audVol-=c.decaySpeed;if(this.audVol<=c.decayMin||-256>this.audVol)this.audVol=c.decayMin,l.envelopeCtr+=2,l.sustainCtr=
c.sustain;break;case 4:l.sustainCtr--;if(0==l.sustainCtr||-256==l.sustainCtr)l.envelopeCtr+=2;break;case 6:if(this.audVol-=c.releaseSpeed,this.audVol<=c.releaseMin||-256>this.audVol)this.audVol=c.releaseMin,l.envelopeCtr=8}l.volume=this.audVol;l.arpeggioCtr=++l.arpeggioCtr&15;e=c.finetune+c.arpeggio[l.arpeggioCtr]+l.note;l.period=this.audPer=a[e];l.bendSpeed&&(b=a[c.finetune+l.bendTo],e=~l.bendSpeed+1,-128>e&&(e&=255),l.pitchCtr+=e,l.period+=l.pitchCtr,0>e&&l.period<=b||0<e&&l.period>=b)&&(l.note=
l.bendTo,l.period=b,l.bendSpeed=0,l.pitchCtr=0);c.phaseShift&&(l.phaseSpeed?l.phaseSpeed--:(l.phaseTimer=++l.phaseTimer&31,e=(c.phaseShift<<5)+l.phaseTimer,l.period+=f[e]>>2));l.pitchFallCtr-=c.pitchFall;-256>l.pitchFallCtr&&(l.pitchFallCtr+=256);l.period+=l.pitchFallCtr;0==l.waitCtr&&(l.waveTimer?l.waveTimer--:16>l.wavePos&&(e=(l.waveList<<4)+l.wavePos,b=this.waveLists[e++],255==b?l.wavePos=this.waveLists[e]&254:(this.audPtr=b<<5,l.waveTimer=this.waveLists[e],l.wavePos+=2)));-1<this.audPtr&&(d.pointer=
this.audPtr);0!=this.audPer&&(d.period=l.period);0!=this.audLen&&(d.length=this.audLen);d.volume=c.volume?c.volume:this.audVol>>2;d.enabled=1;l=l.next}this.trackEnd=this.patternEnd=0;++this.tick>this.speed&&(this.tick=0,++this.patternPos==this.patternLen&&(this.patternPos=0,this.patternEnd=1,++this.trackPos==this.trackLen&&(this.trackPos=this.trackEnd=this.mixer.complete=1)));if(this.mix1Speed){if(0==this.mix1Ctr)for(this.mix1Ctr=this.mix1Speed,e=this.mix1Pos=++this.mix1Pos&31,d=(this.mix1Dest<<5)+
31,l=(this.mix1Source1<<5)+31,b=this.mix1Source2<<5,c=31;-1<c;--c)f[d--]=f[l--]+f[b+e]>>1,e=--e&31;this.mix1Ctr--}if(this.mix2Speed){if(0==this.mix2Ctr)for(this.mix2Ctr=this.mix2Speed,e=this.mix2Pos=++this.mix2Pos&31,d=(this.mix2Dest<<5)+31,l=(this.mix2Source1<<5)+31,b=this.mix2Source2<<5,c=31;-1<c;--c)f[d--]=f[l--]+f[b+e]>>1,e=--e&31;this.mix2Ctr--}this.doFilter&&(e=this.mix1Pos+32,f[e]=~f[e]+1);for(l=this.voices[0];l;)d=l.channel,1==l.waitCtr?l.waitCtr++:2==l.waitCtr&&(l.waitCtr++,d.pointer=l.samplePtr,
d.length=l.sampleLen),l=l.next}}});l.voices[0]=g(0);l.voices[0].next=l.voices[1]=g(1);l.voices[1].next=l.voices[2]=g(2);l.voices[2].next=l.voices[3]=g(3);l.tracksPtr=new Uint32Array(4);return Object.seal(l)}})();(function(){function g(a){return Object.create(null,{index:{value:a,writable:!0},next:{value:null,writable:!0},channel:{value:null,writable:!0},step:{value:null,writable:!0},row:{value:null,writable:!0},instr:{value:null,writable:!0},sample:{value:null,writable:!0},enabled:{value:0,writable:!0},
pattern:{value:0,writable:!0},instrument:{value:0,writable:!0},note:{value:0,writable:!0},period:{value:0,writable:!0},volume:{value:0,writable:!0},original:{value:0,writable:!0},adsrPos:{value:0,writable:!0},sustainCtr:{value:0,writable:!0},pitchBend:{value:0,writable:!0},pitchBendCtr:{value:0,writable:!0},noteSlideTo:{value:0,writable:!0},noteSlideSpeed:{value:0,writable:!0},waveCtr:{value:0,writable:!0},wavePos:{value:0,writable:!0},arpeggioCtr:{value:0,writable:!0},arpeggioPos:{value:0,writable:!0},
vibratoCtr:{value:0,writable:!0},vibratoPos:{value:0,writable:!0},speed:{value:0,writable:!0},initialize:{value:function(){this.sample=this.instr=this.row=this.step=null;this.speed=this.vibratoPos=this.vibratoCtr=this.arpeggioPos=this.arpeggioCtr=this.wavePos=this.waveCtr=this.noteSlideSpeed=this.noteSlideTo=this.pitchBendCtr=this.pitchBend=this.sustainCtr=this.adsrPos=this.original=this.volume=this.period=this.note=this.instrument=this.pattern=this.enabled=0}}})}function p(){return Object.create(null,
{wave:{value:0,writable:!0},waveLen:{value:0,writable:!0},waveDelay:{value:0,writable:!0},waveSpeed:{value:0,writable:!0},arpeggio:{value:0,writable:!0},arpeggioLen:{value:0,writable:!0},arpeggioDelay:{value:0,writable:!0},arpeggioSpeed:{value:0,writable:!0},vibrato:{value:0,writable:!0},vibratoLen:{value:0,writable:!0},vibratoDelay:{value:0,writable:!0},vibratoSpeed:{value:0,writable:!0},pitchBend:{value:0,writable:!0},pitchBendDelay:{value:0,writable:!0},attackMax:{value:0,writable:!0},attackSpeed:{value:0,
writable:!0},decayMin:{value:0,writable:!0},decaySpeed:{value:0,writable:!0},sustain:{value:0,writable:!0},releaseMin:{value:0,writable:!0},releaseSpeed:{value:0,writable:!0}})}var d=[0,5760,5424,5120,4832,4560,4304,4064,3840,3616,3424,3232,3048,2880,2712,2560,2416,2280,2152,2032,1920,1808,1712,1616,1524,1440,1356,1280,1208,1140,1076,1016,960,904,856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,113,107,101,
95];window.neoart.S2Player=function(a){a=B(a);Object.defineProperties(a,{id:{value:"S2Player"},tracks:{value:[],writable:!0},patterns:{value:[],writable:!0},instruments:{value:[],writable:!0},samples:{value:[],writable:!0},arpeggios:{value:null,writable:!0},vibratos:{value:null,writable:!0},waves:{value:null,writable:!0},length:{value:0,writable:!0},speedDef:{value:0,writable:!0},voices:{value:[],writable:!0},trackPos:{value:0,writable:!0},patternPos:{value:0,writable:!0},patternLen:{value:0,writable:!0},
arpeggioFx:{value:null,writable:!0},arpeggioPos:{value:0,writable:!0},initialize:{value:function(){var a=this.voices[0];this.reset();this.tick=this.speed=this.speedDef;this.patternPos=this.trackPos=0;for(this.patternLen=64;a;)a.initialize(),a.channel=this.mixer.channels[a.index],a.instr=this.instruments[0],this.arpeggioFx[a.index]=0,a=a.next}},loader:{value:function(a){var d=0,c=0,e,f,b,g=0,h,r,n;a.position=58;if("SIDMON II - THE MIDI VERSION"==a.readString(28)){a.position=2;this.length=a.readUbyte();
this.speedDef=a.readUbyte();this.samples.length=a.readUshort()>>6;a.position=14;b=a.readUint();this.tracks.length=b;for(a.position=90;c<b;++c)e=D(),Object.defineProperties(e,{soundTranspose:{value:0,writable:!0}}),e=Object.seal(e),e.pattern=a.readUbyte(),e.pattern>d&&(d=e.pattern),this.tracks[c]=e;for(c=0;c<b;++c)e=this.tracks[c],e.transpose=a.readByte();for(c=0;c<b;++c)e=this.tracks[c],e.soundTranspose=a.readByte();e=a.position;a.position=26;b=a.readUint()>>5;this.instruments.length=++b;a.position=
e;this.instruments[0]=p();for(c=0;++c<b;)e=p(),e.wave=a.readUbyte()<<4,e.waveLen=a.readUbyte(),e.waveSpeed=a.readUbyte(),e.waveDelay=a.readUbyte(),e.arpeggio=a.readUbyte()<<4,e.arpeggioLen=a.readUbyte(),e.arpeggioSpeed=a.readUbyte(),e.arpeggioDelay=a.readUbyte(),e.vibrato=a.readUbyte()<<4,e.vibratoLen=a.readUbyte(),e.vibratoSpeed=a.readUbyte(),e.vibratoDelay=a.readUbyte(),e.pitchBend=a.readByte(),e.pitchBendDelay=a.readUbyte(),a.readByte(),a.readByte(),e.attackMax=a.readUbyte(),e.attackSpeed=a.readUbyte(),
e.decayMin=a.readUbyte(),e.decaySpeed=a.readUbyte(),e.sustain=a.readUbyte(),e.releaseMin=a.readUbyte(),e.releaseSpeed=a.readUbyte(),this.instruments[c]=e,a.position+=9;e=a.position;a.position=30;b=a.readUint();this.waves=new Uint8Array(b);a.position=e;for(c=0;c<b;++c)this.waves[c]=a.readUbyte();e=a.position;a.position=34;b=a.readUint();this.arpeggios=new Int8Array(b);a.position=e;for(c=0;c<b;++c)this.arpeggios[c]=a.readByte();e=a.position;a.position=38;b=a.readUint();this.vibratos=new Int8Array(b);
a.position=e;for(c=0;c<b;++c)this.vibratos[c]=a.readByte();b=this.samples.length;for(c=e=0;c<b;++c)r=A(),Object.defineProperties(r,{negStart:{value:0,writable:!0},negLen:{value:0,writable:!0},negSpeed:{value:0,writable:!0},negDir:{value:0,writable:!0},negOffset:{value:0,writable:!0},negPos:{value:0,writable:!0},negCtr:{value:0,writable:!0},negToggle:{value:0,writable:!0}}),r=Object.seal(r),a.readUint(),r.length=a.readUshort()<<1,r.loop=a.readUshort()<<1,r.repeat=a.readUshort()<<1,r.negStart=e+(a.readUshort()<<
1),r.negLen=a.readUshort()<<1,r.negSpeed=a.readUshort(),r.negDir=a.readUshort(),r.negOffset=a.readShort(),r.negPos=a.readUint(),r.negCtr=a.readUshort(),a.position+=6,r.name=a.readString(32),r.pointer=e,r.loopPtr=e+r.loop,e+=r.length,this.samples[c]=r;r=e;b=++d;d=new Uint16Array(++d);for(c=0;c<b;++c)d[c]=a.readUshort();e=a.position;a.position=50;b=a.readUint();this.patterns=[];a.position=e;f=1;for(c=0;c<b;++c)h=C(),Object.defineProperties(h,{speed:{value:0,writable:!0}}),h=Object.seal(h),(n=a.readByte())?
0>n?h.speed=~n:112>n?(h.note=n,n=a.readByte(),c++,0>n?h.speed=~n:112>n?(h.sample=n,n=a.readByte(),c++,0>n?h.speed=~n:(h.effect=n,h.param=a.readUbyte(),c++)):(h.effect=n,h.param=a.readUbyte(),c++)):(h.effect=n,h.param=a.readUbyte(),c++):(h.effect=a.readByte(),h.param=a.readUbyte(),c+=2),this.patterns[g++]=h,e+d[f]==a.position&&(d[f++]=g);d[f]=this.patterns.length;0!=(a.position&1)&&a.position++;this.mixer.store(a,r);b=this.tracks.length;for(c=0;c<b;++c)e=this.tracks[c],e.pattern=d[e.pattern];this.length++;
this.version=2}}},process:{value:function(){var a,g,c,e,f,b=this.voices[0];this.arpeggioPos=++this.arpeggioPos&3;if(++this.tick>=this.speed){for(this.tick=0;b;)a=b.channel,b.enabled=b.note=0,this.patternPos||(b.step=this.tracks[this.trackPos+b.index*this.length],b.pattern=b.step.pattern,b.speed=0),0>--b.speed&&(b.row=c=this.patterns[b.pattern++],b.speed=c.speed,c.note&&(b.enabled=1,b.note=c.note+b.step.transpose,a.enabled=0)),b.pitchBend=0,b.note&&(b.waveCtr=b.sustainCtr=0,b.arpeggioCtr=b.arpeggioPos=
0,b.vibratoCtr=b.vibratoPos=0,b.pitchBendCtr=b.noteSlideSpeed=0,b.adsrPos=4,b.volume=0,c.sample&&(b.instrument=c.sample,b.instr=this.instruments[b.instrument+b.step.soundTranspose],b.sample=this.samples[this.waves[b.instr.wave]]),b.original=b.note+this.arpeggios[b.instr.arpeggio],a.period=b.period=d[b.original],e=b.sample,a.pointer=e.pointer,a.length=e.length,a.enabled=b.enabled,a.pointer=e.loopPtr,a.length=e.repeat),b=b.next;++this.patternPos==this.patternLen&&(this.patternPos=0,++this.trackPos==
this.length&&(this.trackPos=0,this.mixer.complete=1))}for(b=this.voices[0];b;){if(b.sample&&(e=b.sample,!e.negToggle))if(e.negToggle=1,e.negCtr)e.negCtr=--e.negCtr&31;else{e.negCtr=e.negSpeed;if(!e.negDir){b=b.next;continue}f=e.negStart+e.negPos;this.mixer.memory[f]=~this.mixer.memory[f];e.negPos+=e.negOffset;f=e.negLen-1;0>e.negPos?2==e.negDir?e.negPos=f:(e.negOffset=-e.negOffset,e.negPos+=e.negOffset):f<e.negPos&&(1==e.negDir?e.negPos=0:(e.negOffset=-e.negOffset,e.negPos+=e.negOffset))}b=b.next}for(b=
this.voices[0];b;)b.sample&&(b.sample.negToggle=0),b=b.next;for(b=this.voices[0];b;){a=b.channel;g=b.instr;switch(b.adsrPos){case 4:b.volume+=g.attackSpeed;g.attackMax<=b.volume&&(b.volume=g.attackMax,b.adsrPos--);break;case 3:g.decaySpeed?(b.volume-=g.decaySpeed,g.decayMin>=b.volume&&(b.volume=g.decayMin,b.adsrPos--)):b.adsrPos--;break;case 2:b.sustainCtr==g.sustain?b.adsrPos--:b.sustainCtr++;break;case 1:b.volume-=g.releaseSpeed,g.releaseMin>=b.volume&&(b.volume=g.releaseMin,b.adsrPos--)}a.volume=
b.volume>>2;g.waveLen&&(b.waveCtr==g.waveDelay?(b.waveCtr=g.waveDelay-g.waveSpeed,b.wavePos==g.waveLen?b.wavePos=0:b.wavePos++,b.sample=e=this.samples[this.waves[g.wave+b.wavePos]],a.pointer=e.pointer,a.length=e.length):b.waveCtr++);g.arpeggioLen&&(b.arpeggioCtr==g.arpeggioDelay?(b.arpeggioCtr=g.arpeggioDelay-g.arpeggioSpeed,b.arpeggioPos==g.arpeggioLen?b.arpeggioPos=0:b.arpeggioPos++,f=b.original+this.arpeggios[g.arpeggio+b.arpeggioPos],b.period=d[f]):b.arpeggioCtr++);c=b.row;if(this.tick)switch(c.effect){case 112:this.arpeggioFx[0]=
c.param>>4;this.arpeggioFx[2]=c.param&15;f=b.original+this.arpeggioFx[this.arpeggioPos];b.period=d[f];break;case 113:b.pitchBend=~c.param+1;break;case 114:b.pitchBend=c.param;break;case 115:if(0!=b.adsrPos)break;0!=b.instrument&&(b.volume=g.attackMax);b.volume+=c.param<<2;256<=b.volume&&(b.volume=-1);break;case 116:if(0!=b.adsrPos)break;0!=b.instrument&&(b.volume=g.attackMax);b.volume-=c.param<<2;0>b.volume&&(b.volume=0)}switch(c.effect){case 117:g.attackMax=c.param;g.attackSpeed=c.param;break;case 118:this.patternLen=
c.param;break;case 124:a.volume=c.param;b.volume=c.param<<2;255<=b.volume&&(b.volume=255);break;case 127:if(f=c.param&15)this.speed=f}g.vibratoLen&&(b.vibratoCtr==g.vibratoDelay?(b.vibratoCtr=g.vibratoDelay-g.vibratoSpeed,b.vibratoPos==g.vibratoLen?b.vibratoPos=0:b.vibratoPos++,b.period+=this.vibratos[g.vibrato+b.vibratoPos]):b.vibratoCtr++);g.pitchBend&&(b.pitchBendCtr==g.pitchBendDelay?b.pitchBend+=g.pitchBend:b.pitchBendCtr++);c.param&&c.effect&&112>c.effect&&(b.noteSlideTo=d[c.effect+b.step.transpose],
f=c.param,0>b.noteSlideTo-b.period&&(f=-f),b.noteSlideSpeed=f);b.noteSlideTo&&b.noteSlideSpeed&&(b.period+=b.noteSlideSpeed,0>b.noteSlideSpeed&&b.period<b.noteSlideTo||0<b.noteSlideSpeed&&b.period>b.noteSlideTo)&&(b.noteSlideSpeed=0,b.period=b.noteSlideTo);b.period+=b.pitchBend;95>b.period?b.period=95:5760<b.period&&(b.period=5760);a.period=b.period;b=b.next}}}});a.voices[0]=g(0);a.voices[0].next=a.voices[1]=g(1);a.voices[1].next=a.voices[2]=g(2);a.voices[2].next=a.voices[3]=g(3);a.arpeggioFx=new Uint8Array(4);
return Object.seal(a)}})();(function(){function g(d){return Object.create(null,{index:{value:d,writable:!0},next:{value:null,writable:!0},channel:{value:null,writable:!0},sample:{value:null,writable:!0},enabled:{value:0,writable:!0},period:{value:0,writable:!0},last:{value:0,writable:!0},effect:{value:0,writable:!0},param:{value:0,writable:!0},initialize:{value:function(){this.sample=this.channel=null;this.param=this.effect=this.last=this.period=this.enabled=0}}})}var p=[856,808,762,720,678,640,604,
570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,226,214,202,190,180,170,160,151,143,135,127,120,113,0,0,0];window.neoart.STPlayer=function(d){d=B(d);Object.defineProperties(d,{id:{value:"STPlayer"},standard:{value:0,writable:!0},track:{value:null,writable:!0},patterns:{value:[],writable:!0},samples:{value:[],writable:!0},length:{value:0,writable:!0},voices:{value:[],writable:!0},trackPos:{value:0,writable:!0},patternPos:{value:0,writable:!0},jumpFlag:{value:0,writable:!0},force:{set:function(a){1>
a?a=1:4<a&&(a=4);this.version=a}},ntsc:{set:function(a){this.standard=a;this.frequency(a);2>this.version&&(a=this.sampleRate/1E3*(a?20.44952532:20.637767904)/120,this.mixer.samplesTick=(240-this.tempo)*a>>0)}},initialize:{value:function(){var a=this.voices[0];this.reset();this.ntsc=this.standard;this.speed=6;for(this.jumpFlag=this.patternPos=this.trackPos=0;a;)a.initialize(),a.channel=this.mixer.channels[a.index],a.sample=this.samples[0],a=a.next}},loader:{value:function(a){var d=0,g,c,e=0,f=0,b;
if(!(1626>a.length)){this.title=a.readString(20);e+=this.isLegal(this.title);this.version=1;a.position=42;for(g=1;16>g;++g)(b=a.readUshort())?(c=A(),a.position-=24,c.name=a.readString(22),c.length=b<<1,a.position+=3,c.volume=a.readUbyte(),c.loop=a.readUshort(),c.repeat=a.readUshort()<<1,a.position+=22,c.pointer=f,f+=c.length,this.samples[g]=c,e+=this.isLegal(c.name),9999<c.length&&(this.version=3)):(this.samples[g]=null,a.position+=28);a.position=470;this.length=a.readUbyte();this.tempo=a.readUbyte();
for(g=0;128>g;++g)b=a.readUbyte()<<8,16384<b&&e--,this.track[g]=b,b>d&&(d=b);a.position=600;d+=256;this.patterns.length=d;g=a.length-f-600>>2;d>g&&(d=g);for(g=0;g<d;++g){c=C();c.note=a.readUshort();b=a.readUbyte();c.param=a.readUbyte();c.effect=b&15;c.sample=b>>4;this.patterns[g]=c;2<c.effect&&11>c.effect&&e--;c.note&&(113>c.note||856<c.note)&&e--;c.sample&&(15<c.sample||!this.samples[c.sample])&&(15<c.sample&&e--,c.sample=0);if(2<c.effect||!c.effect&&0!=c.param)this.version=2;if(11==c.effect||13==
c.effect)this.version=4}this.mixer.store(a,f);for(g=1;16>g;++g)if(c=this.samples[g])for(c.loop?(c.loopPtr=c.pointer+c.loop,c.pointer=c.loopPtr,c.length=c.repeat):(c.loopPtr=this.mixer.memory.length,c.repeat=2),f=c.pointer+4,a=c.pointer;a<f;++a)this.mixer.memory[a]=0;c=A();c.pointer=c.loopPtr=this.mixer.memory.length;c.length=c.repeat=2;this.samples[0]=c;1>e&&(this.version=0)}}},process:{value:function(){var a,d,g,c=this.voices[0];if(this.tick)for(;c;){if(c.param)if(a=c.channel,1==this.version)1==
c.effect?this.arpeggio(c):2==c.effect&&(g=c.param>>4,c.period=g?c.period+g:c.period-(c.param&15),a.period=c.period);else{switch(c.effect){case 0:this.arpeggio(c);break;case 1:c.last-=c.param&15;113>c.last&&(c.last=113);a.period=c.last;break;case 2:c.last+=c.param&15,856<c.last&&(c.last=856),a.period=c.last}if(2!=(this.version&2)){c=c.next;continue}switch(c.effect){case 12:a.volume=c.param;break;case 13:this.mixer.filter.active=0;break;case 14:this.speed=c.param&15}}c=c.next}else for(g=this.track[this.trackPos]+
this.patternPos;c;){a=c.channel;c.enabled=0;d=this.patterns[g+c.index];c.period=d.note;c.effect=d.effect;c.param=d.param;d.sample?(d=c.sample=this.samples[d.sample],a.volume=2==(this.version&2)&&12==c.effect?c.param:d.volume):d=c.sample;c.period&&(c.enabled=1,a.enabled=0,a.pointer=d.pointer,a.length=d.length,a.period=c.last=c.period);c.enabled&&(a.enabled=1);a.pointer=d.loopPtr;a.length=d.repeat;if(!(4>this.version))switch(c.effect){case 11:this.trackPos=c.param-1;this.jumpFlag^=1;break;case 12:a.volume=
c.param;break;case 13:this.jumpFlag^=1;break;case 14:this.mixer.filter.active=c.param^1;break;case 15:if(!c.param)break;this.speed=c.param&15;this.tick=0}c=c.next}++this.tick==this.speed&&(this.tick=0,this.patternPos+=4,256==this.patternPos||this.jumpFlag)&&(this.patternPos=this.jumpFlag=0,++this.trackPos==this.length&&(this.trackPos=0,this.mixer.complete=1))}},arpeggio:{value:function(a){var d=a.channel,g=0,c=this.tick%3;if(c){for(c=1==c?a.param>>4:a.param&15;a.last!=p[g];)g++;d.period=p[g+c]}else d.period=
a.last}},isLegal:{value:function(a){var d,g=0,c=a.length;if(!c)return 0;for(;g<c;++g)if((d=a.charCodeAt(g))&&(32>d||127<d))return 0;return 1}}});d.voices[0]=g(0);d.voices[0].next=d.voices[1]=g(1);d.voices[1].next=d.voices[2]=g(2);d.voices[2].next=d.voices[3]=g(3);d.track=new Uint16Array(128);return Object.seal(d)}})();(function(){function g(a){a=Object.create(null,{index:{value:a,writable:!0},next:{value:null,writable:!0},flags:{value:0,writable:!0},delay:{value:0,writable:!0},channel:{value:null,
writable:!0},patternLoop:{value:0,writable:!0},patternLoopRow:{value:0,writable:!0},playing:{value:null,writable:!0},note:{value:0,writable:!0},keyoff:{value:0,writable:!0},period:{value:0,writable:!0},finetune:{value:0,writable:!0},arpDelta:{value:0,writable:!0},vibDelta:{value:0,writable:!0},instrument:{value:null,writable:!0},autoVibratoPos:{value:0,writable:!0},autoSweep:{value:0,writable:!0},autoSweepPos:{value:0,writable:!0},sample:{value:null,writable:!0},sampleOffset:{value:0,writable:!0},
volume:{value:0,writable:!0},volEnabled:{value:0,writable:!0},volEnvelope:{value:null,writable:!0},volDelta:{value:0,writable:!0},volSlide:{value:0,writable:!0},volSlideMaster:{value:0,writable:!0},fineSlideU:{value:0,writable:!0},fineSlideD:{value:0,writable:!0},fadeEnabled:{value:0,writable:!0},fadeDelta:{value:0,writable:!0},fadeVolume:{value:0,writable:!0},panning:{value:0,writable:!0},panEnabled:{value:0,writable:!0},panEnvelope:{value:null,writable:!0},panSlide:{value:0,writable:!0},portaU:{value:0,
writable:!0},portaD:{value:0,writable:!0},finePortaU:{value:0,writable:!0},finePortaD:{value:0,writable:!0},xtraPortaU:{value:0,writable:!0},xtraPortaD:{value:0,writable:!0},portaPeriod:{value:0,writable:!0},portaSpeed:{value:0,writable:!0},glissando:{value:0,writable:!0},glissPeriod:{value:0,writable:!0},vibratoPos:{value:0,writable:!0},vibratoSpeed:{value:0,writable:!0},vibratoDepth:{value:0,writable:!0},vibratoReset:{value:0,writable:!0},tremoloPos:{value:0,writable:!0},tremoloSpeed:{value:0,writable:!0},
tremoloDepth:{value:0,writable:!0},waveControl:{value:0,writable:!0},tremorPos:{value:0,writable:!0},tremorOn:{value:0,writable:!0},tremorOff:{value:0,writable:!0},tremorVolume:{value:0,writable:!0},retrigx:{value:0,writable:!0},retrigy:{value:0,writable:!0},reset:{value:function(){this.volume=this.sample.volume;this.panning=this.sample.panning;this.finetune=this.sample.finetune>>3<<2;this.fadeDelta=this.fadeEnabled=this.volDelta=this.keyoff=0;this.fadeVolume=65536;this.autoVibratoPos=0;this.autoSweep=
1;this.vibratoReset=this.vibDelta=this.autoSweepPos=0;4>(this.waveControl&15)&&(this.vibratoPos=0);4>this.waveControl>>4&&(this.tremoloPos=0)}},autoVibrato:{value:function(){var a;this.autoVibratoPos=this.autoVibratoPos+this.playing.vibratoSpeed&255;switch(this.playing.vibratoType){case 0:a=k[this.autoVibratoPos];break;case 1:a=128>this.autoVibratoPos?-64:64;break;case 2:a=(64+(this.autoVibratoPos>>1)&127)-64;break;case 3:a=(64-(this.autoVibratoPos>>1)&127)-64}a*=this.playing.vibratoDepth;this.autoSweep&&
(this.playing.vibratoSweep?this.autoSweepPos>this.playing.vibratoSweep?(this.autoSweepPos&2&&(a*=this.autoSweepPos/this.playing.vibratoSweep),this.autoSweep=0):a*=++this.autoSweepPos/this.playing.vibratoSweep:this.autoSweep=0);this.flags|=f;return a>>6}},tonePortamento:{value:function(){this.glissPeriod||(this.glissPeriod=this.period);this.period<this.portaPeriod?(this.glissPeriod+=this.portaSpeed<<2,this.period=this.glissando?Math.round(this.glissPeriod/64)<<6:this.glissPeriod,this.period>=this.portaPeriod&&
(this.period=this.portaPeriod,this.glissPeriod=this.portaPeriod=0)):this.period>this.portaPeriod&&(this.glissPeriod-=this.portaSpeed<<2,this.period=this.glissando?Math.round(this.glissPeriod/64)<<6:this.glissPeriod,this.period<=this.portaPeriod&&(this.period=this.portaPeriod,this.glissPeriod=this.portaPeriod=0));this.flags|=f}},tremolo:{value:function(){var a=255,c=this.tremoloPos&31;switch(this.waveControl>>4&3){case 0:a=h[c];break;case 1:a=c<<3}this.volDelta=a*this.tremoloDepth>>6;31<this.tremoloPos&&
(this.volDelta=-this.volDelta);this.tremoloPos=this.tremoloPos+this.tremoloSpeed&63;this.flags|=b}},tremor:{value:function(){this.tremorPos==this.tremorOn?(this.tremorVolume=this.volume,this.volume=0):(this.tremorPos=0,this.volume=this.tremorVolume);this.flags|=b;this.tremorPos++}},vibrato:{value:function(){var a=255,c=this.vibratoPos&31;switch(this.waveControl&3){case 0:a=h[c];break;case 1:a=c<<3,31<this.vibratoPos&&(a=255-a)}this.vibDelta=a*this.vibratoDepth>>7;31<this.vibratoPos&&(this.vibDelta=
-this.vibDelta);this.vibratoPos=this.vibratoPos+this.vibratoSpeed&63;this.flags|=f}}});a.volEnvelope=d();a.panEnvelope=d();return Object.seal(a)}function p(){return Object.create(null,{points:{value:[],writable:!0},total:{value:0,writable:!0},sustain:{value:0,writable:!0},loopStart:{value:0,writable:!0},loopEnd:{value:0,writable:!0},flags:{value:0,writable:!0}})}function d(){return Object.create(null,{value:{value:0,writable:!0},position:{value:0,writable:!0},frame:{value:0,writable:!0},delta:{value:0,
writable:!0},fraction:{value:0,writable:!0},stopped:{value:0,writable:!0},reset:{value:function(){this.stopped=this.fraction=this.delta=this.frame=this.position=this.value=0}}})}function a(){var a=Object.create(null,{name:{value:"",writable:!0},samples:{value:[],writable:!0},noteSamples:{value:null,writable:!0},fadeout:{value:0,writable:!0},volData:{value:null,writable:!0},volEnabled:{value:0,writable:!0},panData:{value:null,writable:!0},panEnabled:{value:0,writable:!0},vibratoType:{value:0,writable:!0},
vibratoSweep:{value:0,writable:!0},vibratoSpeed:{value:0,writable:!0},vibratoDepth:{value:0,writable:!0}});a.noteSamples=new Uint8Array(96);a.volData=p();a.panData=p();return Object.seal(a)}function l(a,c){var b=Object.create(null,{rows:{value:[],writable:!0},length:{value:0,writable:!0},size:{value:0,writable:!0}});b.rows.length=b.size=a*c;b.length=a;return Object.seal(b)}function m(a,c){var b=Object.create(null,{frame:{value:0,writable:!0},value:{value:0,writable:!0}});b.frame=a||0;b.value=c||0;
return Object.seal(b)}function c(){return Object.create(null,{note:{value:0,writable:!0},instrument:{value:0,writable:!0},volume:{value:0,writable:!0},effect:{value:0,writable:!0},param:{value:0,writable:!0}})}function e(){var a=K();Object.defineProperties(a,{finetune:{value:0,writable:!0},panning:{value:0,writable:!0},relative:{value:0,writable:!0}});return Object.seal(a)}var f=1,b=2,k=[0,-2,-3,-5,-6,-8,-9,-11,-12,-14,-16,-17,-19,-20,-22,-23,-24,-26,-27,-29,-30,-32,-33,-34,-36,-37,-38,-39,-41,-42,
-43,-44,-45,-46,-47,-48,-49,-50,-51,-52,-53,-54,-55,-56,-56,-57,-58,-59,-59,-60,-60,-61,-61,-62,-62,-62,-63,-63,-63,-64,-64,-64,-64,-64,-64,-64,-64,-64,-64,-64,-63,-63,-63,-62,-62,-62,-61,-61,-60,-60,-59,-59,-58,-57,-56,-56,-55,-54,-53,-52,-51,-50,-49,-48,-47,-46,-45,-44,-43,-42,-41,-39,-38,-37,-36,-34,-33,-32,-30,-29,-27,-26,-24,-23,-22,-20,-19,-17,-16,-14,-12,-11,-9,-8,-6,-5,-3,-2,0,2,3,5,6,8,9,11,12,14,16,17,19,20,22,23,24,26,27,29,30,32,33,34,36,37,38,39,41,42,43,44,45,46,47,48,49,50,51,52,53,
54,55,56,56,57,58,59,59,60,60,61,61,62,62,62,63,63,63,64,64,64,64,64,64,64,64,64,64,64,63,63,63,62,62,62,61,61,60,60,59,59,58,57,56,56,55,54,53,52,51,50,49,48,47,46,45,44,43,42,41,39,38,37,36,34,33,32,30,29,27,26,24,23,22,20,19,17,16,14,12,11,9,8,6,5,3,2],h=[0,24,49,74,97,120,141,161,180,197,212,224,235,244,250,253,255,253,250,244,235,224,212,197,180,161,141,120,97,74,49,24],r=[0,0.04417,0.062489,0.076523,0.088371,0.098821,0.108239,0.116927,0.124977,0.132572,0.139741,0.146576,0.153077,0.159335,0.16535,
0.171152,0.176772,0.18221,0.187496,0.19263,0.197643,0.202503,0.207273,0.211951,0.216477,0.220943,0.225348,0.229631,0.233854,0.237985,0.242056,0.246066,0.249985,0.253873,0.25767,0.261437,0.265144,0.268819,0.272404,0.275989,0.279482,0.282976,0.286409,0.289781,0.293153,0.296464,0.299714,0.302965,0.306185,0.309344,0.312473,0.315602,0.318671,0.321708,0.324746,0.327754,0.3307,0.333647,0.336563,0.339449,0.342305,0.345161,0.347986,0.350781,0.353545,0.356279,0.359013,0.361717,0.364421,0.367094,0.369737,0.37238,
0.374992,0.377574,0.380157,0.382708,0.38526,0.387782,0.390303,0.392794,0.395285,0.397746,0.400176,0.402606,0.405037,0.407437,0.409836,0.412206,0.414576,0.416915,0.419254,0.421563,0.423841,0.42618,0.428458,0.430737,0.432985,0.435263,0.437481,0.439729,0.441916,0.444134,0.446321,0.448508,0.450665,0.452852,0.455009,0.457136,0.459262,0.461389,0.463485,0.465611,0.467708,0.469773,0.471839,0.473935,0.47597,0.478036,0.480072,0.482077,0.484112,0.486117,0.488122,0.490127,0.492101,0.494106,0.496051,0.498025,
0.5,0.501944,0.503888,0.505802,0.507746,0.50966,0.511574,0.513488,0.515371,0.517255,0.519138,0.521022,0.522905,0.524758,0.526611,0.528465,0.530318,0.53214,0.533993,0.535816,0.537639,0.539462,0.541254,0.543046,0.544839,0.546631,0.548423,0.550216,0.551978,0.553739,0.555501,0.557263,0.558995,0.560757,0.562489,0.56422,0.565952,0.567683,0.569384,0.571116,0.572817,0.574518,0.57622,0.57789,0.579592,0.581262,0.582964,0.584634,0.586305,0.587946,0.589617,0.591257,0.592928,0.594568,0.596209,0.597849,0.599459,
0.6011,0.60271,0.60435,0.60596,0.60757,0.60915,0.61076,0.61237,0.61395,0.61556,0.617139,0.618719,0.620268,0.621848,0.623428,0.624977,0.626557,0.628106,0.629655,0.631205,0.632754,0.634303,0.635822,0.637372,0.63889,0.64044,0.641959,0.643478,0.644966,0.646485,0.648004,0.649523,0.651012,0.6525,0.653989,0.655477,0.656966,0.658454,0.659943,0.661431,0.66289,0.664378,0.665836,0.667294,0.668783,0.670241,0.671699,0.673127,0.674585,0.676043,0.677471,0.678929,0.680357,0.681785,0.683213,0.684641,0.686068,0.687496,
0.688894,0.690321,0.691749,0.693147,0.694574,0.695972,0.697369,0.698767,0.700164,0.701561,0.702928,0.704326,0.705723,0.70711],n=[0,0.005863,0.013701,0.021569,0.029406,0.037244,0.045082,0.052919,0.060757,0.068625,0.076463,0.0843,0.092138,0.099976,0.107844,0.115681,0.123519,0.131357,0.139194,0.147032,0.1549,0.162738,0.170575,0.178413,0.186251,0.194119,0.201956,0.209794,0.217632,0.225469,0.233307,0.241175,0.249013,0.25685,0.264688,0.272526,0.280394,0.288231,0.296069,0.303907,0.311744,0.319582,0.32745,
0.335288,0.343125,0.350963,0.3588,0.366669,0.374506,0.382344,0.390182,0.398019,0.405857,0.413725,0.421563,0.4294,0.437238,0.445076,0.452944,0.460781,0.468619,0.476457,0.484294,0.492132,0.5],s=[29024,27392,25856,24384,23040,21696,20480,19328,18240,17216,16256,15360,14512,13696,12928,12192,11520,10848,10240,9664,9120,8608,8128,7680,7256,6848,6464,6096,5760,5424,5120,4832,4560,4304,4064,3840,3628,3424,3232,3048,2880,2712,2560,2416,2280,2152,2032,1920,1814,1712,1616,1524,1440,1356,1280,1208,1140,1076,
1016,960,907,856,808,762,720,678,640,604,570,538,508,480,453,428,404,381,360,339,320,302,285,269,254,240,227,214,202,190,180,169,160,151,142,134,127,120,113,107,101,95,90,85,80,75,71,67,63,60,57,53,50,48,45,42,40,38,36,34,32,30,28];window.neoart.F2Player=function(d){d=F(d);Object.defineProperties(d,{id:{value:"F2Player"},patterns:{value:[],writable:!0},instruments:{value:[],writable:!0},voices:{value:[],writable:!0},linear:{value:0,writable:!0},complete:{value:0,writable:!0},order:{value:0,writable:!0},
position:{value:0,writable:!0},nextOrder:{value:0,writable:!0},nextPosition:{value:0,writable:!0},pattern:{value:null,writable:!0},patternDelay:{value:0,writable:!0},patternOffset:{value:0,writable:!0},timer:{value:0,writable:!0},initialize:{value:function(){var a=0,c;this.reset();this.timer=this.speed;this.position=this.order=0;this.nextPosition=this.nextOrder=-1;this.complete=this.patternOffset=this.patternDelay=0;this.master=64;for(this.voices.length=this.channels;a<this.channels;++a)c=g(a),c.channel=
this.mixer.channels[a],c.playing=this.instruments[0],c.sample=c.playing.samples[0],this.voices[a]=c,a&&(this.voices[a-1].next=c)}},loader:{value:function(b){var d,f,h,g,k,n,q,L=22,r,s;if(!(360>b.length)){b.position=17;this.title=b.readString(20);b.position++;f=b.readString(20);if("FastTracker v2.00   "==f||"FastTracker v 2.00  "==f)this.version=1;else if("Sk@le Tracker"==f)this.version=L=2;else if("MadTracker 2.0"==f)this.version=3;else if("MilkyTracker        "==f)this.version=4;else if("DigiBooster Pro 2.18"==
f)this.version=5;else if(-1!=f.indexOf("OpenMPT"))this.version=6;else return;b.readUshort();d=b.readUint();this.length=b.readUshort();this.restart=b.readUshort();this.channels=b.readUshort();s=r=b.readUshort();this.instruments=[];this.instruments.length=b.readUshort()+1;this.linear=b.readUshort();this.speed=b.readUshort();this.tempo=b.readUshort();this.track=new Uint8Array(this.length);for(f=0;f<this.length;++f)h=b.readUbyte(),h>=s&&(r=h+1),this.track[f]=h;this.patterns=[];this.patterns.length=r;
if(r!=s){g=l(64,this.channels);h=g.size;for(f=0;f<h;++f)g.rows[f]=c();this.patterns[--r]=g}b.position=q=d+60;n=s;for(f=0;f<n;++f){d=b.readUint();b.position++;g=l(b.readUshort(),this.channels);r=g.size;s=b.readUshort();b.position=q+d;k=b.position+s;if(s)for(h=0;h<r;++h)d=c(),s=b.readUbyte(),s&128?(s&1&&(d.note=b.readUbyte()),s&2&&(d.instrument=b.readUbyte()),s&4&&(d.volume=b.readUbyte()),s&8&&(d.effect=b.readUbyte()),s&16&&(d.param=b.readUbyte())):(d.note=s,d.instrument=b.readUbyte(),d.volume=b.readUbyte(),
d.effect=b.readUbyte(),d.param=b.readUbyte()),97!=d.note&&96<d.note&&(d.note=0),g.rows[h]=d;else for(h=0;h<r;++h)g.rows[h]=c();this.patterns[f]=g;q=b.position;q!=k&&(q=b.position=k)}k=b.position;n=this.instruments.length;for(f=1;f<n;++f){h=b.readUint();if(b.position+h>=b.length)break;g=a();g.name=b.readString(22);b.position++;s=b.readUshort();16<s&&(s=16);d=b.readUint();2==L&&64!=d&&(d=64);if(s){g.samples=[];g.samples.length=s;for(h=0;96>h;++h)g.noteSamples[h]=b.readUbyte();for(h=0;12>h;++h)g.volData.points[h]=
m(b.readUshort(),b.readUshort());for(h=0;12>h;++h)g.panData.points[h]=m(b.readUshort(),b.readUshort());g.volData.total=b.readUbyte();g.panData.total=b.readUbyte();g.volData.sustain=b.readUbyte();g.volData.loopStart=b.readUbyte();g.volData.loopEnd=b.readUbyte();g.panData.sustain=b.readUbyte();g.panData.loopStart=b.readUbyte();g.panData.loopEnd=b.readUbyte();g.volData.flags=b.readUbyte();g.panData.flags=b.readUbyte();g.volData.flags&1&&(g.volEnabled=1);g.panData.flags&1&&(g.panEnabled=1);g.vibratoType=
b.readUbyte();g.vibratoSweep=b.readUbyte();g.vibratoDepth=b.readUbyte();g.vibratoSpeed=b.readUbyte();g.fadeout=b.readUshort()<<1;b.position+=L;q=b.position;this.instruments[f]=g;for(h=0;h<s;++h)k=e(),k.length=b.readUint(),k.loopStart=b.readUint(),k.loopLen=b.readUint(),k.volume=b.readUbyte(),k.finetune=b.readByte(),k.loopMode=b.readUbyte(),k.panning=b.readUbyte(),k.relative=b.readByte(),b.position++,k.name=b.readString(22),g.samples[h]=k,b.position=q+=d;for(h=0;h<s;++h)k=g.samples[h],k.length&&(q=
b.position+k.length,k.loopMode&16&&(k.bits=16,k.loopMode^=16,k.length>>=1,k.loopStart>>=1,k.loopLen>>=1),k.loopLen||(k.loopMode=0),k.store(b),k.loopMode&&(k.length=k.loopStart+k.loopLen),b.position=q)}else b.position=k+h;k=b.position;if(k>=b.length)break}g=a();g.volData=p();g.panData=p();g.samples=[];for(f=0;12>f;++f)g.volData.points[f]=m(),g.panData.points[f]=m();k=e();k.length=220;k.data=new Float32Array(220);for(f=0;220>f;++f)k.data[f]=0;g.samples[0]=k;this.instruments[0]=g}}},process:{value:function(){var a,
c,d,e,h,g,l,m,k=this.voices[0];if(this.tick)for(;k;){g=this.pattern.rows[this.position+k.index];if(k.delay)if((g.param&15)==this.tick)k.flags=k.delay,k.delay=0;else{k=k.next;continue}if(g.volume)switch(c=g.volume>>4,d=g.volume&15,c){case 6:k.volume-=d;0>k.volume&&(k.volume=0);k.flags|=b;break;case 7:k.volume+=d;64<k.volume&&(k.volume=64);k.flags|=b;break;case 11:k.vibrato();break;case 13:k.panning-=d;0>k.panning&&(k.panning=0);k.flags|=4;break;case 14:k.panning+=d;255<k.panning&&(k.panning=255);k.flags|=
4;break;case 15:k.portaPeriod&&k.tonePortamento()}c=g.param>>4;d=g.param&15;switch(g.effect){case 0:if(!g.param)break;m=(this.tick-this.timer)%3;0>m&&(m+=3);2==this.tick&&18==this.timer&&(m=0);m?1==m?this.linear?k.arpDelta=-(d<<6):(m=this.amiga(k.note+d,k.finetune),k.arpDelta=m-k.period):this.linear?k.arpDelta=-(c<<6):(m=this.amiga(k.note+c,k.finetune),k.arpDelta=m-k.period):k.arpDelta=0;k.flags|=f;break;case 1:k.period-=k.portaU;0>k.period&&(k.period=0);k.flags|=f;break;case 2:k.period+=k.portaD;
9212<k.period&&(k.period=9212);k.flags|=f;break;case 3:k.portaPeriod&&k.tonePortamento();break;case 4:c&&(k.vibratoSpeed=c);d&&(k.vibratoDepth=d<<2);k.vibrato();break;case 5:h=1;k.portaPeriod&&k.tonePortamento();break;case 6:h=1;k.vibrato();break;case 7:k.tremolo();break;case 10:h=1;break;case 14:switch(c){case 9:0==this.tick%d&&(k.volEnvelope.reset(),k.panEnvelope.reset(),k.flags=k.flags|b|12);break;case 12:this.tick==d&&(k.volume=0,k.flags|=b)}break;case 17:c=k.volSlideMaster>>4;d=k.volSlideMaster&
15;c?(this.master+=c,64<this.master&&(this.master=64),k.flags|=b):d&&(this.master-=d,0>this.master&&(this.master=0),k.flags|=b);break;case 20:this.tick==g.param&&(k.fadeEnabled=1,k.keyoff=1);break;case 24:c=k.panSlide>>4;d=k.panSlide&15;c?(k.panning+=c,255<k.panning&&(k.panning=255),k.flags|=4):d&&(k.panning-=d,0>k.panning&&(k.panning=0),k.flags|=4);break;case 27:a=this.tick;g.volume||a++;if(a%k.retrigy)break;(!g.volume||80<g.volume)&&k.retrigx&&this.retrig(k);k.flags|=8;break;case 29:k.tremor()}h&&
(c=k.volSlide>>4,d=k.volSlide&15,h=0,c?(k.volume+=c,k.flags|=b):d&&(k.volume-=d,k.flags|=b));k=k.next}else for(0<=this.nextOrder&&(this.order=this.nextOrder),0<=this.nextPosition&&(this.position=this.nextPosition),this.nextOrder=this.nextPosition=-1,this.pattern=this.patterns[this.track[this.order]];k;){g=this.pattern.rows[this.position+k.index];a=g.volume>>4;h=3==g.effect||5==g.effect||15==a;c=g.param>>4;k.keyoff=0;k.arpDelta&&(k.arpDelta=0,k.flags|=f);if(g.instrument)k.instrument=g.instrument<this.instruments.length?
this.instruments[g.instrument]:null,k.volEnvelope.reset(),k.panEnvelope.reset(),k.flags=k.flags|b|36;else if(97==g.note||20==g.effect&&!g.param)k.fadeEnabled=1,k.keyoff=1;g.note&&97!=g.note?k.instrument?(d=k.instrument,m=g.note-1,l=d.samples[d.noteSamples[m]],m+=l.relative,0<=m&&118>=m&&(h||(k.note=m,k.sample=l,g.instrument?(k.volEnabled=d.volEnabled,k.panEnabled=d.panEnabled,k.flags|=15):k.flags=k.flags|f|8),g.instrument?(k.reset(),k.fadeDelta=d.fadeout):k.finetune=l.finetune>>3<<2,14==g.effect&&
5==c&&(k.finetune=(g.param&15)-8<<3),m=this.linear?(120-m<<6)-k.finetune:this.amiga(m,k.finetune),h?k.portaPeriod=m:(k.period=m,k.glissPeriod=0))):(k.volume=0,k.flags=b|32):k.vibratoReset&&4!=g.effect&&6!=g.effect&&(k.vibDelta=0,k.vibratoReset=0,k.flags|=f);if(g.volume)if(16<=g.volume&&80>=g.volume)k.volume=g.volume-16,k.flags=k.flags|b|32;else switch(d=g.volume&15,a){case 6:k.volume-=d;0>k.volume&&(k.volume=0);k.flags|=b;break;case 7:k.volume+=d;64<k.volume&&(k.volume=64);k.flags|=b;break;case 10:d&&
(k.vibratoSpeed=d);break;case 11:d&&(k.vibratoDepth=d<<2);break;case 12:k.panning=d<<4;k.flags|=4;break;case 15:d&&(k.portaSpeed=d<<4)}if(g.effect)switch(d=g.param&15,g.effect){case 1:g.param&&(k.portaU=g.param<<2);break;case 2:g.param&&(k.portaD=g.param<<2);break;case 3:g.param&&15!=a&&(k.portaSpeed=g.param);break;case 4:k.vibratoReset=1;break;case 5:g.param&&(k.volSlide=g.param);break;case 6:g.param&&(k.volSlide=g.param);k.vibratoReset=1;break;case 7:c&&(k.tremoloSpeed=c);d&&(k.tremoloDepth=d);
break;case 8:k.panning=g.param;k.flags|=4;break;case 9:g.param&&(k.sampleOffset=g.param<<8);k.sampleOffset>=k.sample.length&&(k.volume=0,k.sampleOffset=0,k.flags&=~(f|8),k.flags=k.flags|b|32);break;case 10:g.param&&(k.volSlide=g.param);break;case 11:this.nextOrder=g.param;this.nextOrder>=this.length?this.complete=1:this.nextPosition=0;e=1;this.patternOffset=0;break;case 12:k.volume=g.param;k.flags=k.flags|b|32;break;case 13:this.nextPosition=(10*c+d)*this.channels;this.patternOffset=0;e||(this.nextOrder=
this.order+1,this.nextOrder>=this.length&&(this.complete=1,this.nextPosition=-1));break;case 14:switch(c){case 1:d&&(k.finePortaU=d<<2);k.period-=k.finePortaU;k.flags|=f;break;case 2:d&&(k.finePortaD=d<<2);k.period+=k.finePortaD;k.flags|=f;break;case 3:k.glissando=d;break;case 4:k.waveControl=k.waveControl&240|d;break;case 6:d?(k.patternLoop?k.patternLoop--:k.patternLoop=d,k.patternLoop&&(this.nextPosition=k.patternLoopRow)):k.patternLoopRow=this.patternOffset=this.position;break;case 7:k.waveControl=
k.waveControl&15|d<<4;break;case 10:d&&(k.fineSlideU=d);k.volume+=k.fineSlideU;k.flags|=b;break;case 11:d&&(k.fineSlideD=d);k.volume-=k.fineSlideD;k.flags|=b;break;case 13:k.delay=k.flags;k.flags=0;break;case 14:this.patternDelay=d*this.timer}break;case 15:if(!g.param)break;32>g.param?this.timer=g.param:this.mixer.samplesTick=2.5*this.sampleRate/g.param>>0;break;case 16:this.master=g.param;64<this.master&&(this.master=64);k.flags|=b;break;case 17:g.param&&(k.volSlideMaster=g.param);break;case 21:if(!k.instrument||
!k.instrument.volEnabled)break;d=k.instrument;m=g.param;c=d.volData.total;for(a=0;a<c&&!(m<d.volData.points[a].frame);a++);k.volEnvelope.position=--a;c--;d.volData.flags&4&&a==d.volData.loopEnd&&(a=k.volEnvelope.position=d.volData.loopStart,m=d.volData.points[a].frame,k.volEnvelope.frame=m);a>=c?(k.volEnvelope.value=d.volData.points[c].value,k.volEnvelope.stopped=1):(k.volEnvelope.stopped=0,k.volEnvelope.frame=m,m>d.volData.points[a].frame&&k.volEnvelope.position++,c=d.volData.points[a],a=d.volData.points[++a],
m=a.frame-c.frame,k.volEnvelope.delta=(m?(a.value-c.value<<8)/m>>0:0)||0,k.volEnvelope.fraction=c.value<<8);break;case 24:g.param&&(k.panSlide=g.param);break;case 27:c&&(k.retrigx=c);d&&(k.retrigy=d);if(!g.volume&&k.retrigy){a=this.tick+1;if(a%k.retrigy)break;80<g.volume&&k.retrigx&&this.retrig(k)}break;case 29:g.param&&(k.tremorOn=++c,k.tremorOff=++d+c);break;case 33:1==c?(d&&(k.xtraPortaU=d),k.period-=k.xtraPortaU,k.flags|=f):2==c&&(d&&(k.xtraPortaD=d),k.period+=k.xtraPortaD,k.flags|=f)}k=k.next}++this.tick>=
this.timer+this.patternDelay&&(this.patternDelay=this.tick=0,0>this.nextPosition&&(this.nextPosition=this.position+this.channels,this.nextPosition>=this.pattern.size||this.complete))&&(this.nextOrder=this.order+1,this.nextPosition=this.patternOffset,this.nextOrder>=this.length&&(this.nextOrder=this.restart,this.mixer.complete=1))}},fast:{value:function(){for(var a,c,d,e,g,h=this.voices[0],k;h;)a=h.channel,d=h.flags,h.flags=0,d&8&&(a.index=h.sampleOffset,a.pointer=-1,a.dir=0,a.fraction=0,a.sample=
h.sample,a.length=h.sample.length,a.enabled=a.sample.data?1:0,h.playing=h.instrument,h.sampleOffset=0),e=h.playing,c=e.vibratoSpeed?h.autoVibrato():0,k=h.volume+h.volDelta,e.volEnabled?(h.volEnabled&&!h.volEnvelope.stopped&&this.envelope(h,h.volEnvelope,e.volData),k=k*h.volEnvelope.value>>6,d|=b,h.fadeEnabled&&(h.fadeVolume-=h.fadeDelta,0>h.fadeVolume?(k=0,h.fadeVolume=0,h.fadeEnabled=0,h.volEnvelope.value=0,h.volEnvelope.stopped=1,h.panEnvelope.stopped=1):k=k*h.fadeVolume>>16)):h.keyoff&&(k=0,d|=
b),g=h.panning,e.panEnabled&&(h.panEnabled&&!h.panEnvelope.stopped&&this.envelope(h,h.panEnvelope,e.panData),g=h.panEnvelope.value<<2,d|=4,0>g?g=0:255<g&&(g=255)),d&b&&(0>k?k=0:64<k&&(k=64),a.volume=n[k*this.master>>6],a.lvol=a.volume*a.lpan,a.rvol=a.volume*a.rpan),d&4&&(a.panning=g,a.lpan=r[256-g],a.rpan=r[g],a.lvol=a.volume*a.lpan,a.rvol=a.volume*a.rpan),d&f&&(c+=h.period+h.arpDelta+h.vibDelta,a.speed=this.linear?(548077568*Math.pow(2,(4608-c)/768)/this.sampleRate>>0)/65536:(14317456/c*65536/this.sampleRate>>
0)/65536,a.delta=a.speed>>0,a.speed-=a.delta),h=h.next}},accurate:{value:function(){for(var a,c,d,e,g,h,k,l=this.voices[0];l;)a=l.channel,d=l.flags,l.flags=0,d&8&&(a.sample&&(d|=32,a.mixCounter=220,a.oldSample=null,a.oldPointer=-1,a.enabled&&(a.oldDir=a.dir,a.oldFraction=a.fraction,a.oldSpeed=a.speed,a.oldSample=a.sample,a.oldPointer=a.pointer,a.oldLength=a.length,a.lmixRampD=a.lvol,a.lmixDeltaD=a.lvol/220,a.rmixRampD=a.rvol,a.rmixDeltaD=a.rvol/220)),a.dir=1,a.fraction=0,a.sample=l.sample,a.pointer=
l.sampleOffset,a.length=l.sample.length,a.enabled=a.sample.data?1:0,l.playing=l.instrument,l.sampleOffset=0),e=l.playing,c=e.vibratoSpeed?l.autoVibrato():0,g=l.volume+l.volDelta,e.volEnabled?(l.volEnabled&&!l.volEnvelope.stopped&&this.envelope(l,l.volEnvelope,e.volData),g=g*l.volEnvelope.value>>6,d|=b,l.fadeEnabled&&(l.fadeVolume-=l.fadeDelta,0>l.fadeVolume?(g=0,l.fadeVolume=0,l.fadeEnabled=0,l.volEnvelope.value=0,l.volEnvelope.stopped=1,l.panEnvelope.stopped=1):g=g*l.fadeVolume>>16)):l.keyoff&&(g=
0,d|=b),h=l.panning,e.panEnabled&&(l.panEnabled&&!l.panEnvelope.stopped&&this.envelope(l,l.panEnvelope,e.panData),h=l.panEnvelope.value<<2,d|=4,0>h?h=0:255<h&&(h=255)),a.enabled?(d&b&&(0>g?g=0:64<g&&(g=64),g=n[g*this.master>>6],e=g*r[256-h],k=g*r[h],g==a.volume||a.mixCounter?(a.lvol=e,a.rvol=k):(a.volCounter=d&32?220:this.mixer.samplesTick,a.lvolDelta=(e-a.lvol)/a.volCounter,a.rvolDelta=(k-a.rvol)/a.volCounter),a.volume=g),d&4&&(g=r[256-h],e=r[h],h==a.panning||a.mixCounter||a.volCounter?(a.lpan=g,
a.rpan=e):(a.panCounter=this.mixer.samplesTick,a.lpanDelta=(g-a.lpan)/a.panCounter,a.rpanDelta=(e-a.rpan)/a.panCounter),a.panning=h),d&f&&(c+=l.period+l.arpDelta+l.vibDelta,a.speed=this.linear?(548077568*Math.pow(2,(4608-c)/768)/this.sampleRate>>0)/65536:(14317456/c*65536/this.sampleRate>>0)/65536),a.mixCounter&&(a.lmixRampU=0,a.lmixDeltaU=a.lvol/220,a.rmixRampU=0,a.rmixDeltaU=a.rvol/220)):(a.volCounter=0,a.panCounter=0),l=l.next}},envelope:{value:function(a,b,c){var d=b.position,e=c.points[d];if(b.frame==
e.frame){c.flags&4&&d==c.loopEnd&&(d=b.position=c.loopStart,e=c.points[d],b.frame=e.frame);if(d==c.total-1){b.value=e.value;b.stopped=1;return}if(c.flags&2&&d==c.sustain&&!a.fadeEnabled){b.value=e.value;return}b.position++;a=c.points[b.position];b.delta=(a.value-e.value<<8)/(a.frame-e.frame)>>0||0;b.fraction=e.value<<8}else b.fraction+=b.delta;b.value=b.fraction>>8;b.frame++}},amiga:{value:function(a,b){var c=0,d=s[++a];0>b?c=(s[--a]-d)/64:0<b&&(c=(d-s[++a])/64);return d-c*b>>0}},retrig:{value:function(a){switch(a.retrigx){case 1:a.volume--;
break;case 2:a.volume++;break;case 3:a.volume-=4;break;case 4:a.volume-=8;break;case 5:a.volume-=16;break;case 6:a.volume=(a.volume<<1)/3;break;case 7:a.volume>>=1;break;case 8:a.volume=a.sample.volume;break;case 9:a.volume++;break;case 10:a.volume+=2;break;case 11:a.volume+=4;break;case 12:a.volume+=8;break;case 13:a.volume+=16;break;case 14:a.volume=3*a.volume>>1;break;case 15:a.volume<<=1}0>a.volume?a.volume=0:64<a.volume&&(a.volume=64);a.flags|=b}}});return Object.seal(d)}})()})();